"use strict";(self.webpackChunktasky_tasker=self.webpackChunktasky_tasker||[]).push([[902],{8902:(F,h,s)=>{s.r(h),s.d(h,{AppointListModule:()=>D});var f=s(6895),_=s(9132),l=s(5861),t=s(4650),g=s(5377),v=s(7009),x=s(8826),A=s(8391),y=s(9496),Z=s(2419),m=s(7392),b=s(3646);function T(a,c){if(1&a){const i=t.EpF();t.TgZ(0,"div",12)(1,"div",13),t.NdJ("click",function(){t.CHM(i);const n=t.oxw(2).index,o=t.oxw();return t.KtG(o.onGet2Model(n))}),t.TgZ(2,"div",14),t._uU(3),t.qZA()(),t.TgZ(4,"mat-icon",15),t.NdJ("click",function(){t.CHM(i);const n=t.oxw(2).index,o=t.oxw();return t.KtG(o.onEditAppoint(n))}),t._uU(5,"edit"),t.qZA(),t.TgZ(6,"mat-icon",15),t.NdJ("click",function(){t.CHM(i);const n=t.oxw(2).index,o=t.oxw();return t.KtG(o.onDelAppoint(n))}),t._uU(7,"delete_otuline"),t.qZA(),t.TgZ(8,"mat-icon",15),t.NdJ("click",function(){t.CHM(i);const n=t.oxw(2).index,o=t.oxw();return t.KtG(o.onDoneAppoint(n))}),t._uU(9,"done"),t.qZA(),t.TgZ(10,"mat-icon",15),t.NdJ("click",function(){t.CHM(i);const n=t.oxw(2).$implicit,o=t.oxw();return t.KtG(o.onAddGoogleCalendar(n))}),t._uU(11,"calendar_month"),t.qZA(),t._uU(12," \xa0 "),t.TgZ(13,"mat-icon",15),t.NdJ("click",function(){t.CHM(i);const n=t.oxw(2).$implicit,o=t.oxw();return t.KtG(o.onchangefull(n))}),t._uU(14),t.qZA()()}if(2&a){const i=t.oxw(2).$implicit,e=t.oxw();t.xp6(3),t.hij("",i.pollgrp_model_name," >"),t.xp6(11),t.Oqu(e.getAppIcon(i))}}function k(a,c){1&a&&(t.TgZ(0,"div",16),t._uU(1," FINALIZADO "),t.qZA())}function C(a,c){if(1&a){const i=t.EpF();t.TgZ(0,"div",5)(1,"div",6)(2,"div",7),t._uU(3),t.ALo(4,"date"),t.qZA(),t.YNc(5,T,15,2,"div",8),t.YNc(6,k,2,0,"div",9),t.qZA(),t.TgZ(7,"div",10),t.NdJ("click",function(){t.CHM(i);const n=t.oxw().$implicit,o=t.oxw();return t.KtG(o.buildHtml2Pdf(n.pollresult_id))}),t._uU(8),t.qZA(),t.TgZ(9,"div",11),t._uU(10),t.qZA()()}if(2&a){const i=t.oxw().$implicit;t.xp6(3),t.Oqu(t.xi3(4,5,i.datetime,"MMM dd, yyyy hh:mm a")),t.xp6(2),t.Q6J("ngIf",!0!==i.ended),t.xp6(1),t.Q6J("ngIf",!0===i.ended),t.xp6(2),t.Oqu(i.costumer),t.xp6(2),t.Oqu(i.task)}}function S(a,c){if(1&a&&(t.TgZ(0,"div",17)(1,"div")(2,"strong"),t._uU(3,"Contacto:"),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div")(6,"strong"),t._uU(7,"Correo:"),t.qZA(),t._uU(8),t.qZA(),t.TgZ(9,"div")(10,"strong"),t._uU(11,"Tel\xe9fono:"),t.qZA(),t._uU(12),t.qZA()()),2&a){const i=t.oxw().$implicit;t.xp6(4),t.hij(" ",i.contact,""),t.xp6(4),t.hij(" ",i.email,""),t.xp6(4),t.hij(" ",i.phone,"")}}function w(a,c){if(1&a&&(t.TgZ(0,"div"),t.YNc(1,C,11,8,"div",3),t.YNc(2,S,13,3,"div",4),t.qZA()),2&a){const i=c.$implicit,e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.appointVisible(i)),t.xp6(1),t.Q6J("ngIf",i.full)}}const L=[{path:"",component:(()=>{class a{constructor(i,e,n,o,r,p){this.sharedvar=i,this.snkBar=e,this.dtb=n,this.dg=o,this.htm2pdf=r,this.nvg=p,this.appointStatus={ended:!1,date:!0,date_ini:(new Date).getTime(),date_end:(new Date).getTime()},i.staff.appoint&&(i.staff.appoint=i.staff.appoint.sort(function(d,u){return d.datetime-u.datetime}))}ngOnInit(){if(!this.sharedvar.staff.appoint)return;let i=new Date,e=0;for(;e<this.sharedvar.staff.appoint.length;)i>new Date(this.sharedvar.staff.appoint[e].datetime)?this.sharedvar.staff.appoint.splice(e,1):e++;this.dtb.updateStaffAsync(this.sharedvar.staff)}getClicked(i){2===i.index&&this.filterDialog()}filterDialog(){var i=this;if(!1===this.appointStatus.date){const o=this.sharedvar.dateTime2StartEnd(this.appointStatus.date_ini,this.appointStatus.date_end);this.appointStatus.date_ini=o.date_ini,this.appointStatus.date_end=o.date_end}this.dg.aDefault({schema:{controls:[{name:"ended",label:"Incluir finalizados",type:"checkbox",validators:{}},{name:"date",label:"Filtar por fecha",type:"checkbox",validators:{}},{name:"date_ini",label:"Fecha inicio:",type:"date",validators:{}},{name:"date_end",label:"Fecha final:",type:"date",validators:{}}]},title:"Filtros",value:this.appointStatus,dgwidth:250,dgheigth:400}).subscribe(function(){var o=(0,l.Z)(function*(r){if(r){i.appointStatus.ended=!0===r.ended;let p=0,d=99999999999999;if(i.appointStatus.date=r.date,!0===r.date){const u=i.sharedvar.dateTime2StartEnd(r.date_ini,r.date_end);p=u.date_ini,d=u.date_end}i.appointStatus.date_ini=p,i.appointStatus.date_end=d}});return function(r){return o.apply(this,arguments)}}())}appointVisible(i){let e=!1===i.ended||!0===this.appointStatus.ended&&!0===i.ended;return e=e&&this.appointStatus.date_end>i.datetime&&this.appointStatus.date_ini<i.datetime,e}onchangefull(i){i.full=!i.full}onAddGoogleCalendar(i){alert(`Agregar a google calendar ${i.costumer}`)}getAppIcon(i){return i.full?"expand_less":"expand_more"}onDelAppoint(i){!this.sharedvar.staff.appoint||0===this.sharedvar.staff.appoint.length||this.snkBar.open("Eliminar item de la agenda?.","Ok",{duration:5e3}).onAction().subscribe(e=>{this.sharedvar.staff.appoint?.splice(i,1),this.dtb.updateStaffAsync(this.sharedvar.staff)})}onDoneAppoint(i){this.sharedvar.staff.appoint&&this.sharedvar.staff.appoint[i]&&this.snkBar.open("Finalizar agenda?.","Ok",{duration:5e3}).onAction().subscribe(e=>{this.sharedvar.staff.appoint&&(this.sharedvar.staff.appoint[i].ended=!0,this.sharedvar.staff.appoint[i].full=!1,this.dtb.updateStaffAsync(this.sharedvar.staff))})}onGet2Model(i){var e=this;return(0,l.Z)(function*(){if(!e.sharedvar.staff.appoint||!e.sharedvar.staff.appoint[i])return;const n=e.sharedvar.staff.appoint[i].pollgrp_id||"0";e.snkBar.open(`Ejecutar Actividad: ${e.sharedvar.staff.appoint[i].pollgrp_model_name}?.`,"Ok",{duration:5e3}).onAction().subscribe(function(){var o=(0,l.Z)(function*(r){yield e.dtb.onPollPartialSelected(n),e.nvg.onRouteDetail(`${e.sharedvar.pollExecSelected.name}/${e.sharedvar.pollExecSelected.model_name}`,"","poll",!0)});return function(r){return o.apply(this,arguments)}}())})()}onEditAppoint(i){var e=this;if(!this.sharedvar.staff.appoint||!this.sharedvar.staff.appoint[i])return;let o="Editar agenda: ";this.sharedvar.staff.appoint&&this.sharedvar.staff.appoint[i].costumer&&(o+=this.sharedvar.staff.appoint[i].costumer),this.dg.aDefault({schema:{controls:[{name:"datetime",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}},{name:"task",label:"Actividad/Compromiso:",type:"textarea",totalRows:4,style:"w-full",validators:{required:!0}}]},value:this.sharedvar.staff.appoint[i],title:o,dgwidth:400,dgheigth:400}).subscribe(function(){var p=(0,l.Z)(function*(d){d&&e.sharedvar.staff.appoint&&(e.sharedvar.staff.appoint[i].datetime=d.datetime,e.sharedvar.staff.appoint[i].task=d.task,e.dtb.updateStaffAsync(e.sharedvar.staff))});return function(d){return p.apply(this,arguments)}}())}buildHtml2Pdf(i){var e=this;return(0,l.Z)(function*(){if(void 0===i)return;const n=yield e.dtb.getPollResultAsync(i);e.htm2pdf.buildHtml2Pdf(n,null)})()}static#t=this.\u0275fac=function(e){return new(e||a)(t.Y36(g.D),t.Y36(v.ux),t.Y36(x.k),t.Y36(A.x),t.Y36(y.Q),t.Y36(Z.$))};static#i=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-appoint-list"]],decls:3,vars:2,consts:[[3,"buttons","onClicked"],[1,"overflow-auto","p-2","gap-y-2"],[4,"ngFor","ngForOf"],["class","h-24 items-center border-b border-gray-300",4,"ngIf"],["class","ml-1 p-1 bg-gray-100 text-xs text-gray-400 border-b border-gray-300",4,"ngIf"],[1,"h-24","items-center","border-b","border-gray-300"],[1,"flex","flex-row","mt-1","gap-1","text-xs","text-sky-600"],[1,"flex-1"],["class","flex",4,"ngIf"],["class","text-violet-500 pr-2 font-medium",4,"ngIf"],[3,"click"],[1,"ml-2","h-16","text-sm","text-gray-500","overflow-hidden"],[1,"flex"],[1,"border","border-sky-600","rounded-md","hover:text-violet-500","hover:border-violet-500",3,"click"],[1,"mt-1","px-1"],[1,"hover:text-violet-500",3,"click"],[1,"text-violet-500","pr-2","font-medium"],[1,"ml-1","p-1","bg-gray-100","text-xs","text-gray-400","border-b","border-gray-300"]],template:function(e,n){1&e&&(t.TgZ(0,"app-header",0),t.NdJ("onClicked",function(r){return n.getClicked(r)}),t.qZA(),t.TgZ(1,"div",1),t.YNc(2,w,3,2,"div",2),t.qZA()),2&e&&(t.Q6J("buttons","11100000"),t.xp6(2),t.Q6J("ngForOf",n.sharedvar.staff.appoint))},dependencies:[f.sg,f.O5,m.Hw,b.G,f.uU]})}return a})()}];let U=(()=>{class a{static#t=this.\u0275fac=function(e){return new(e||a)};static#i=this.\u0275mod=t.oAB({type:a});static#e=this.\u0275inj=t.cJS({imports:[_.Bz.forChild(L),_.Bz]})}return a})();var J=s(8471);let D=(()=>{class a{static#t=this.\u0275fac=function(e){return new(e||a)};static#i=this.\u0275mod=t.oAB({type:a});static#e=this.\u0275inj=t.cJS({imports:[f.ez,U,m.Ps,J.O,v.ZX]})}return a})()}}]);