"use strict";(self.webpackChunktasky_tasker=self.webpackChunktasky_tasker||[]).push([[739],{7739:($,u,o)=>{o.r(u),o.d(u,{AppointListModule:()=>F});var p=o(214),h=o(6870),c=o(3241),t=o(6637),_=o(1238),m=o(6090),x=o(9104),A=o(3832),w=o(5715),Z=o(106),v=o(6213),g=o(1833),T=o(2767),y=o(4565);function b(a,l){if(1&a){const e=t.EpF();t.TgZ(0,"div")(1,"div",22)(2,"div")(3,"strong"),t._uU(4,"Contacto:"),t.qZA(),t._uU(5),t.qZA(),t.TgZ(6,"div")(7,"strong"),t._uU(8,"Correo:"),t.qZA(),t._uU(9),t.qZA(),t.TgZ(10,"div")(11,"strong"),t._uU(12,"Telefono:"),t.qZA(),t._uU(13),t.qZA()(),t.TgZ(14,"div",23)(15,"div",24),t._uU(16),t.qZA(),t.TgZ(17,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2).$implicit,s=t.oxw(2);return t.KtG(s.onAddGoogleCalendar(n))}),t._uU(18,"calendar_month"),t.qZA()()()}if(2&a){const e=t.oxw(2).$implicit,i=t.oxw(2);t.xp6(5),t.hij(" ",e.contact,""),t.xp6(4),t.hij(" ",e.email,""),t.xp6(4),t.hij(" ",e.phone,""),t.xp6(3),t.Oqu(i.getOwner(e))}}function S(a,l){if(1&a){const e=t.EpF();t.TgZ(0,"div",9)(1,"div",10)(2,"div",11),t._UZ(3,"img",12),t.TgZ(4,"div",13)(5,"div",14),t._uU(6),t.TgZ(7,"span",15),t._uU(8),t.ALo(9,"date"),t.qZA()(),t.TgZ(10,"div",16),t._uU(11),t.qZA()()(),t.YNc(12,b,19,4,"div",17),t.qZA(),t.TgZ(13,"div",18)(14,"button",19),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,s=t.oxw(2);return t.KtG(s.onchangefull(n))}),t.TgZ(15,"span"),t._uU(16,"Detalle"),t.qZA(),t._uU(17," \xa0 "),t.TgZ(18,"mat-icon",20),t._uU(19),t.qZA()(),t._uU(20," \xa0 "),t.TgZ(21,"button",21),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().index,s=t.oxw(2);return t.KtG(s.onDoneAppoint(n))}),t._uU(22," Seleccionar "),t.TgZ(23,"mat-icon"),t._uU(24,"east"),t.qZA()()()()}if(2&a){const e=t.oxw().$implicit,i=t.oxw(2);t.xp6(3),t.Q6J("src","../assets/images/favicon.png",t.LSH),t.xp6(3),t.hij(" ",e.pollgrp_model_name," "),t.xp6(2),t.Oqu(t.xi3(9,6,e.datetime,"MMM dd, yyyy hh:mm a")),t.xp6(3),t.hij("Agendado por: ",i.getOwner(e)," "),t.xp6(1),t.Q6J("ngIf",e.full),t.xp6(7),t.Oqu(i.getIcon(e))}}function C(a,l){if(1&a&&(t.TgZ(0,"div"),t.YNc(1,S,25,9,"div",8),t.qZA()),2&a){const e=l.$implicit,i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",i.appointVisible(e))}}function k(a,l){if(1&a&&(t.TgZ(0,"div",6),t.YNc(1,C,2,1,"div",7),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.sharedvar.staff.appoint)}}function L(a,l){if(1&a&&(t.TgZ(0,"div",26),t._UZ(1,"app-map",27),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.Q6J("edit",!1)("markerlist",e.dataList)}}const U=[{path:"",component:(()=>{class a{constructor(e,i,n,s,r,d){this.sharedvar=e,this.snkBar=i,this.dtb=n,this.dg=s,this.htm2pdf=r,this.nvg=d,this.datafilterText="",this.switchview=!0,this.appointStatus={active:!0,date_ini:(new Date).getTime(),date_end:(new Date).getTime()},e.staff.appoint&&(e.staff.appoint=e.staff.appoint.sort(function(f,J){return f.datetime-J.datetime}))}ngOnInit(){const e=this.sharedvar.dateTime2StartEnd(this.appointStatus.date_ini,this.appointStatus.date_end);this.appointStatus.active=!0,this.appointStatus.date_ini=e.date_ini,this.appointStatus.date_end=e.date_end,this.getText2Show()}getClicked(e){2===e.index&&this.filterDialog(),6===e.index&&this.getSwitched()}getSwitched(){if(this.dataList=[],this.switchview=!this.switchview,!1===this.switchview&&this.sharedvar.staff.appoint){let e=0;this.sharedvar.staff.appoint.forEach(i=>{this.appointVisible(i)&&(this.dataList.push({_id:`${this.sharedvar.staff._id}:${e}`,date_ini:i.datetime,date_end:i.dateend,geoLocStart:i.geoLoc,tasker_id:this.sharedvar.staff._id||"",tasker_name:this.sharedvar.staff.names+" "+(this.sharedvar.staff.lastnames||""),activity_id:i.pollgrp_id||"",activity_name:i.pollgrp_model_name||"No asignada",costumer_name:i.crm_costum_name||"",crm_products:[]}),e++)})}this.dataList.sort((e,i)=>Number(i.date_ini)-Number(e.date_ini))}filterDialog(){var e=this;this.dg.aDefault({schema:{controls:[{name:"active",label:"Pendientes",type:"checkbox",validators:{}},{name:"date_ini",label:"Fecha inicio:",type:"date",validators:{}},{name:"date_end",label:"Fecha final:",type:"date",validators:{}}]},title:"Filtros",value:this.appointStatus,dgwidth:250,dgheigth:350}).subscribe(function(){var s=(0,c.Z)(function*(r){if(r){const d=e.sharedvar.dateTime2StartEnd(r.date_ini,r.date_end);e.appointStatus.date_ini=d.date_ini,e.appointStatus.date_end=d.date_end,e.appointStatus.active=r.active,e.getText2Show()}});return function(r){return s.apply(this,arguments)}}())}getText2Show(){this.datafilterText=!0===this.appointStatus.active?"Activas":`\n      Fechas: ${this.sharedvar.formatNumber2Date(this.appointStatus.date_ini,"/")} - \n      ${this.sharedvar.formatNumber2Date(this.appointStatus.date_end,"/")}\n      `}appointVisible(e){if("appoint"!==e.type)return!1;let i=!0;return i=!0===this.appointStatus.active?!1===e.ended:!1===e.ended&&this.appointStatus.date_ini<e.datetime&&e.datetime<this.appointStatus.date_end,i}onchangefull(e){e.full=!e.full}getOwner(e){return e.owner!=this.sharedvar.staff._id?"Administraci\xf3n":""}onAddGoogleCalendar(e){alert(`Agregar a google calendar ${e.crm_costum_name}`)}getIcon(e){return e.full?"expand_less":"expand_more"}onDoneAppoint(e){if(!this.sharedvar.staff.appoint||!this.sharedvar.staff.appoint[e])return;const i=this.sharedvar.staff.appoint[e].pollgrp_model_name;i&&i.length>0?this.onGet2Model(e):this.done(e)}done(e){this.snkBar.open("Finalizar agenda?.","Ok",{duration:5e3}).onAction().subscribe(i=>{this.sharedvar.staff.appoint&&(this.sharedvar.staff.appoint[e].ended=!0,this.sharedvar.staff.appoint[e].full=!1,this.dtb.updateStaffAsync(this.sharedvar.staff))})}onGet2Model(e){var i=this;return(0,c.Z)(function*(){if(!i.sharedvar.staff.appoint||!i.sharedvar.staff.appoint[e])return;const n=i.sharedvar.staff.appoint[e];if(i.sharedvar.pollExecListLocal.length>0)return void i.snkBar.open("Tiene actividades pendientes, intente m\xe1s tarde","Ok",{duration:5e3});const s=(new Date).getTime();if(n.datetime>s)return void i.snkBar.open("No es posible ejecutar agenda futura","Ok",{duration:5e3});const r=n.pollgrp_id||"0";i.snkBar.open(`Ejecutar Actividad: ${n.pollgrp_model_name}?.`,"Ok",{duration:5e3}).onAction().subscribe(function(){var d=(0,c.Z)(function*(f){n.ended=!0,n.full=!1,i.sharedvar.staff.appoint&&(i.sharedvar.staff.appoint[e]=n),i.dtb.updateStaffAsync(i.sharedvar.staff),yield i.dtb.onPollPartial2FullSelected(r,n.defa_values),i.nvg.onRouteDetail(`${i.sharedvar.pollExecSelected.name}/${i.sharedvar.pollExecSelected.model_name}`,"","poll",!0)});return function(f){return d.apply(this,arguments)}}())})()}buildHtml2Pdf(e){var i=this;return(0,c.Z)(function*(){void 0!==e&&i.htm2pdf.buildHtml2Pdf(e,null)})()}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(_.D),t.Y36(m.ux),t.Y36(x.k),t.Y36(A.x),t.Y36(w.Q),t.Y36(Z.$))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-appoint-list"]],decls:7,vars:4,consts:[[1,"flex","flex-col","h-full"],[3,"buttons","onClicked"],[1,"flex","flex-row","justify-center","content-center","text-violet-400","h-7","border-b","border-violet-500"],[1,"mt-1"],["class","overflow-auto p-2 flex flex-wrap justify-center gap-2",4,"ngIf"],["class","flex-1 m-2 h-screen overflow-scroll",4,"ngIf"],[1,"overflow-auto","p-2","flex","flex-wrap","justify-center","gap-2"],[4,"ngFor","ngForOf"],["class","border border-violet-200 rounded-md bg-yellow-50",4,"ngIf"],[1,"border","border-violet-200","rounded-md","bg-yellow-50"],[1,"flex","flex-col","min-h-12","w-[22rem]","p-1"],[1,"flex","flex-row"],["alt","logo",1,"object-fill","h-12","w-12","rounded-full",3,"src"],[1,"flex-1","flex","flex-col","items-start","px-2"],[1,"font-medium","text-lg","h-6","w-[18rem]","leading-tight","overflow-hidden"],[1,"ml-4","pb-4","text-xs","text-violet-500"],[1,"font-medium","text-gray-900","h-6","w-[18rem]","overflow-hidden"],[4,"ngIf"],[1,"w-[22rem]","flex","justify-end","pr-1","bg-white","p-1"],["mat-stroked-button","",3,"click"],["color","primary"],["mat-stroked-button","","color","primary",3,"click"],[1,"ml-2","p-1","bg-gray-100","text-xs","text-gray-400"],[1,"flex","my-1","text-xs","text-violet-500"],[1,"grow","mt-1","font-medium","text-red-900"],[1,"hover:text-violet-600",3,"click"],[1,"flex-1","m-2","h-screen","overflow-scroll"],[3,"edit","markerlist"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"app-header",1),t.NdJ("onClicked",function(r){return n.getClicked(r)}),t.qZA(),t.TgZ(2,"div",2)(3,"span",3),t._uU(4),t.qZA()(),t.YNc(5,k,2,1,"div",4),t.YNc(6,L,2,2,"div",5),t.qZA()),2&i&&(t.xp6(1),t.Q6J("buttons","11100010"),t.xp6(3),t.Oqu(n.datafilterText),t.xp6(1),t.Q6J("ngIf",!0===n.switchview),t.xp6(1),t.Q6J("ngIf",!1===n.switchview))},dependencies:[p.sg,p.O5,v.Hw,g.lW,T.G,y.G,p.uU]})}return a})()}];let O=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275mod=t.oAB({type:a});static#i=this.\u0275inj=t.cJS({imports:[h.Bz.forChild(U),h.Bz]})}return a})();var N=o(1569),j=o(814);let F=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275mod=t.oAB({type:a});static#i=this.\u0275inj=t.cJS({imports:[p.ez,O,v.Ps,g.ot,N.O,m.ZX,j.R]})}return a})()}}]);