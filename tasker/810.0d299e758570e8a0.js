"use strict";(self.webpackChunktasky_tasker=self.webpackChunktasky_tasker||[]).push([[810],{9810:(y,x,c)=>{c.r(x),c.d(x,{PollModule:()=>ue});var u=c(6895),d=c(9132),r=c(5861),S=c(6599);class k extends Error{constructor(){super("Request was cancelled"),this.name="CancelError"}get isCanceled(){return!0}}class w extends Error{constructor(m){super("Could not get the public IP address",m),this.name="IpNotFoundError"}}const b={timeout:5e3},h={v4:["https://ipv4.icanhazip.com/","https://api.ipify.org/"],v6:["https://ipv6.icanhazip.com/","https://api6.ipify.org/"]},J=(a,m,e)=>{const l=new XMLHttpRequest;let s;const o=new Promise((i,n)=>{s=n,l.addEventListener("error",n,{once:!0}),l.addEventListener("timeout",n,{once:!0}),l.addEventListener("load",()=>{const f=l.responseText.trim();f&&S[e](f)?i(f):n()},{once:!0}),l.open("GET",a),l.timeout=m.timeout,l.send()});return o.cancel=()=>{l.abort(),s(new k)},o},$=(a,m)=>{let e;const l=(0,r.Z)(function*(){const s=[...h[a],...m.fallbackUrls??[]];let o;for(const i of s)try{return e=J(i,m,a),yield e}catch(n){if(o=n,n instanceof k)throw n}throw new w({cause:o})})();return l.cancel=()=>{e.cancel()},l},B={v4:a=>$("v4",{...b,...a}),v6:a=>$("v6",{...b,...a})};function E(){return(E=(0,r.Z)(function*(a){if(a={timeout:5e3,ipVersion:4,...a},!navigator?.onLine)return!1;const m=4===a.ipVersion?"v4":"v6";try{return yield B[m](a),!0}catch{return!1}})).apply(this,arguments)}var t=c(4650),D=c(8826),T=c(7009),M=c(3028),Z=c(5412),L=c(4859),A=c(7392),_=c(8255),C=c(4006);function I(a,m){if(1&a){const e=t.EpF();t.TgZ(0,"div",15)(1,"input",16),t.NdJ("change",function(){t.CHM(e);const s=t.oxw(2);return t.KtG(s.onChekAll())}),t.qZA()()}if(2&a){const e=t.oxw(2);t.xp6(1),t.Q6J("checked",e.chekAll)}}function G(a,m){if(1&a){const e=t.EpF();t.TgZ(0,"div",11),t.YNc(1,I,2,1,"div",12),t.TgZ(2,"mat-icon",13),t._uU(3),t.qZA(),t.TgZ(4,"input",14),t.NdJ("ngModelChange",function(s){t.CHM(e);const o=t.oxw();return t.KtG(o.filtertext=s)})("change",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onViewSelected(!1))}),t.qZA()()}if(2&a){const e=t.oxw(),l=t.MAs(15);t.xp6(1),t.Q6J("ngIf",e.multiSelect),t.xp6(1),t.Q6J("matMenuTriggerFor",l),t.xp6(1),t.Oqu(e.getView()),t.xp6(1),t.Q6J("ngModel",e.filtertext)}}function V(a,m){if(1&a){const e=t.EpF();t.TgZ(0,"div",19)(1,"input",20),t.NdJ("ngModelChange",function(s){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.selected=s)})("change",function(){t.CHM(e);const s=t.oxw().$implicit,o=t.oxw();return t.KtG(o.onSelected(s))}),t.qZA(),t.TgZ(2,"label",21),t._uU(3),t.qZA()()}if(2&a){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",e.selected),t.xp6(2),t.Oqu(e.name)}}function Y(a,m){if(1&a&&(t.TgZ(0,"div",17),t.YNc(1,V,4,2,"div",18),t.qZA()),2&a){const e=m.$implicit,l=t.oxw();t.xp6(1),t.Q6J("ngIf",l.getViewFilter(e))}}function q(a,m){if(1&a){const e=t.EpF();t.TgZ(0,"div",22)(1,"button",7),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onNew())}),t._uU(2," Nuevo\xa0 "),t.TgZ(3,"mat-icon"),t._uU(4,"add"),t.qZA()()()}}let Q=(()=>{class a{constructor(e,l){this.dialogRef=e,this.data=l,this.filtertext="",this.selectedOptions=[],this.chekAll=!1,this.viewSelected=!1,this.multiSelect=!1,e.disableClose=!0,this.multiSelect=l.multiSelect||!1}onNew(){this.dialogRef.close({new:!0})}onChekAll(){this.chekAll=!this.chekAll,this.data.valuelst?.forEach(e=>{e.selected=this.chekAll})}getViewFilter(e){if(this.viewSelected)return e.selected||!1;const l=this.filtertext.toUpperCase();return!!(0===l.length||e&&e.name&&e.name.toUpperCase().includes(l))}onSelected(e){this.multiSelect||(this.selectedOptions=[e],this.dialogRef.close(this.selectedOptions))}onSave(){this.selectedOptions=[],this.data.valuelst?.forEach(e=>{e.selected&&this.selectedOptions.push(e)}),this.dialogRef.close(this.selectedOptions)}onDismiss(){this.dialogRef.close()}getView(){return this.viewSelected?"done":"visibility"}onViewSelected(e){this.viewSelected=e}static#e=this.\u0275fac=function(l){return new(l||a)(t.Y36(Z.so),t.Y36(Z.WI))};static#t=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-select-dialog"]],decls:24,vars:4,consts:[[1,"flex","flex-col","h-full"],[1,"h-12","p-3","text-2xl","bg-violet-600","text-white"],["class","h-10 w-full flex flex-row items-center border-b border-violet-500",4,"ngIf"],[1,"flex-1","overflow-auto","mt-2"],["class","flex flex-column",4,"ngFor","ngForOf"],[1,"flex","p-3","justify-end","border-t","border-violet-500"],["class","flex-1","fxFlex","",4,"ngIf"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary","cdkFocusInitia","",3,"click"],["selectView","matMenu"],["mat-menu-item","",3,"click"],[1,"h-10","w-full","flex","flex-row","items-center","border-b","border-violet-500"],["class","w-6 ml-2 mt-2",4,"ngIf"],[1,"bg-gray-200","rounded-sm",3,"matMenuTriggerFor"],["type","search","placeholder","Filtrar...",1,"flex-1","ml-2","h-8","z-20","text-gray-900","outline-none","border-b","border-gray-200","focus:outline-none","focus:outline-none",3,"ngModel","ngModelChange","change"],[1,"w-6","ml-2","mt-2"],["type","checkbox",1,"w-4","h-4","focus:border-blue-500",3,"checked","change"],[1,"flex","flex-column"],["class","flex flex-row h-8 ml-2",4,"ngIf"],[1,"flex","flex-row","h-8","ml-2"],["id","itemsel","type","checkbox",1,"w-4","h-4","text-violet-500","bg-gray-100","border-gray-300","rounded","dark:focus:ring-violet-500","dark:ring-offset-gray-800","focus:ring-2","dark:bg-gray-700","dark:border-gray-600",3,"ngModel","ngModelChange","change"],["for","itemsel",1,"ml-4","h-4","w-72","text-sm","text-gray-900","overflow-hidden"],["fxFlex","",1,"flex-1"]],template:function(l,s){1&l&&(t.TgZ(0,"div",0)(1,"h1",1),t._uU(2),t.qZA(),t.YNc(3,G,5,4,"div",2),t.TgZ(4,"div",3),t.YNc(5,Y,2,1,"div",4),t.qZA(),t.TgZ(6,"div",5),t.YNc(7,q,5,0,"div",6),t.TgZ(8,"button",7),t.NdJ("click",function(){return s.onDismiss()}),t.TgZ(9,"mat-icon"),t._uU(10,"close"),t.qZA()(),t.TgZ(11,"button",8),t.NdJ("click",function(){return s.onSave()}),t.TgZ(12,"mat-icon"),t._uU(13,"done"),t.qZA()()(),t.TgZ(14,"mat-menu",null,9)(16,"button",10),t.NdJ("click",function(){return s.onViewSelected(!0)}),t.TgZ(17,"mat-icon"),t._uU(18,"done"),t.qZA(),t._uU(19," Ver seleccionados "),t.qZA(),t.TgZ(20,"button",10),t.NdJ("click",function(){return s.onViewSelected(!1)}),t.TgZ(21,"mat-icon"),t._uU(22,"visibility"),t.qZA(),t._uU(23," Ver Todo "),t.qZA()()()),2&l&&(t.xp6(2),t.Oqu(s.data.title),t.xp6(1),t.Q6J("ngIf",s.data.viewfilter),t.xp6(2),t.Q6J("ngForOf",s.data.valuelst),t.xp6(2),t.Q6J("ngIf",s.data.viewAdd))},dependencies:[u.sg,u.O5,L.lW,A.Hw,_.VK,_.OP,_.p6,C.Fj,C.Wl,C.JJ,C.On]})}return a})(),F=(()=>{class a{constructor(e){this.dialog=e}aSelectDefault(e){let l=window.innerHeight-20;return e.dgheigth=e.dgheigth||l,l=l>600?600:l,this.dialogRef=this.dialog.open(Q,{panelClass:"custom-dialog-container",height:l.toString()+"px",width:"350px",data:e}),this.dialogRef.afterClosed()}static#e=this.\u0275fac=function(l){return new(l||a)(t.LFG(Z.uw))};static#t=this.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var z=c(2419),O=c(5377),H=c(9055),j=c(9496);let K=(()=>{class a{constructor(){this.recognition=new webkitSpeechRecognition,this.isRecording=!1,this.text="",this.tempWords=""}init(){this.recognition.interimResults=!0,this.recognition.lang="es-CO",this.recognition.addEventListener("result",e=>{const l=Array.from(e.results).map(s=>s[0]).map(s=>s.transcript).join("");this.tempWords=l,console.log(this.tempWords)})}voiceRecogition(e){return this.text=e,this.isRecording?this.stop():this.start(),this.text}start(){this.isRecording||(this.isRecording=!0,this.recognition.start(),console.log("Speech recognition started"),this.recognition.addEventListener("end",e=>{this.isRecording?(this.wordConcat(),this.recognition.start()):(this.recognition.stop(),console.log("End speech recognition"))}))}stop(){this.isRecording&&(this.isRecording=!1,this.wordConcat(),this.recognition.stop(),console.log("End speech recognition"))}wordConcat(){this.text=this.text+" "+this.tempWords+".",this.tempWords=""}static#e=this.\u0275fac=function(l){return new(l||a)};static#t=this.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var W=c(3905);let X=(()=>{class a{constructor(e,l,s,o,i){this.sharedvar=e,this.dtb=l,this.snkBar=s,this.dg=o,this.ds=i,this.schemaAppoint={controls:[{name:"datetime",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}},{name:"dateend",label:"Fecha y hora final sugerida:",type:"datetime-local",sideBtn:"more_time",validators:{required:!0}},{name:"notes",label:"Notas:",type:"textarea",totalRows:4,style:"w-full",validators:{required:!0}},{name:"costumer",label:"Cliente",type:"text",sideBtn:"people",style:"w-full",validators:{}},{name:"contact",label:"Contacto",type:"text",style:"w-full",validators:{}},{name:"address",label:"Direcci\xf3n",type:"text",style:"w-full",validators:{}},{name:"geoLoc",label:"Geolocalizaci\xf3n",type:"text",style:"w-full",sideBtn:"room",validators:{}}]}}onDelAppoint(e){if(this.sharedvar.staff.appoint&&0!==this.sharedvar.staff.appoint.length){if(this.sharedvar.staff.appoint[e].owner!==this.sharedvar.staff._id)return void this.snkBar.open("No est\xe1 permitido eliminar \xe9ste item?.","Ok",{duration:5e3});this.snkBar.open("Eliminar item de la agenda?.","Ok",{duration:5e3}).onAction().subscribe(l=>{this.sharedvar.staff.appoint?.splice(e,1),this.dtb.updateStaffAsync(this.sharedvar.staff)})}}onAddEditAppoint(e){var l=this;return(0,r.Z)(function*(){const s=l.sharedvar.staff,o=[];let n="No seleccionado";e||(e={datetime:l.sharedvar.dateNow(),dateend:l.sharedvar.dateNow(),ended:!1,owner:s._id||""});const f=l.schemaAppoint.controls?.findIndex(g=>"costumer"===g.name),v=l.schemaAppoint.controls?.findIndex(g=>"contact"===g.name);f&&f>=0&&l.schemaAppoint.controls&&(l.sharedvar.selPollResult.crm_costum_id?(l.selectedCostumer=yield l.dtb.getCMRCostumAsync(l.sharedvar.selPollResult.crm_costum_id),e.address=l.selectedCostumer?.address,n=l.selectedCostumer&&l.selectedCostumer.name?l.selectedCostumer.name:n,l.selectedCostumer.linkup_1&&o.push({key:l.selectedCostumer.linkup_1,value:l.selectedCostumer.linkup_1}),l.selectedCostumer.linkup_2&&o.push({key:l.selectedCostumer.linkup_2,value:l.selectedCostumer.linkup_2}),e.costumer=n,l.schemaAppoint.controls[f].disabled=!0):l.schemaAppoint.controls[f].disabled=!1),v&&v>=0&&l.schemaAppoint.controls&&(o.length>0?(l.schemaAppoint.controls[v].type="select",l.schemaAppoint.controls[v].selectOptions=o):l.schemaAppoint.controls[v].type="text");let P={schema:l.schemaAppoint,title:"Agenda",value:e,dgwidth:400,function:[{name:"dateend",self:l,function:l.addTime}]};const p=yield(0,W.z)(l.dg.aDefault(P));return p?e.owner!==s._id?(l.snkBar.open("No est\xe1 autorizado para edita \xe9ste item?.","Ok",{duration:5e3}),null):(0===p.dateend&&(p.dateend=p.datetime+l.sharedvar.addMinutes(30)),delete p._btnEvent_,delete p._btnclick_,delete p._propName_,delete p._valid_,delete p.staff,l.dg.updatePropResult(e,p),l.selectedCostumer&&(e.contact===l.selectedCostumer.linkup_1?(e.email=l.selectedCostumer.email_1,e.phone=l.selectedCostumer.phone_1):(e.email=l.selectedCostumer.email_2,e.phone=l.selectedCostumer.phone_2)),e):null})()}addTime(e,l,s){return(0,r.Z)(function*(){if(l)return l.dateend=Number(l.dateend)+e.sharedvar.addMinutes(15),{schema:null,value:l}})()}onFilter(e){}static#e=this.\u0275fac=function(l){return new(l||a)(t.LFG(O.D),t.LFG(D.k),t.LFG(T.ux),t.LFG(M.x),t.LFG(F))};static#t=this.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var ee=c(3646),te=c(2395);const le=["editControlTrigger"];function se(a,m){if(1&a){const e=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onBack())}),t.TgZ(1,"mat-icon"),t._uU(2,"arrow_back"),t.qZA()()}}function oe(a,m){if(1&a){const e=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onEndPoll())}),t._uU(1," Finalizar"),t.TgZ(2,"mat-icon"),t._uU(3,"done"),t.qZA()()}}function ae(a,m){if(1&a){const e=t.EpF();t.TgZ(0,"button",17),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onDelete())}),t.TgZ(1,"mat-icon"),t._uU(2,"delete"),t.qZA()()}}function ie(a,m){if(1&a){const e=t.EpF();t.TgZ(0,"button",14),t.NdJ("click",function(){const o=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.visiteByAvailTitle(o))}),t._uU(1),t.qZA()}if(2&a){const e=m.$implicit,l=t.oxw();t.xp6(1),t.hij(" ",l.getAvailPollTitle(e)," ")}}const ne=[{path:"",component:(()=>{class a{constructor(e,l,s,o,i,n,f,v,P,p){this.dtb=e,this.snkBar=l,this.dg=s,this.ds=o,this.nvg=i,this.sharedvar=n,this.notifServ=f,this.htm2pdf=v,this.service=P,this.staffServ=p,this.lchat=!1,this.goto=[],this.visitePollList=[],this.reset=0,this.commands="",this.service.init()}ngOnInit(){var e=this;return(0,r.Z)(function*(){e.sharedvar.pollExecSelected.pollList.length>0?(e.selectedPoll=e.sharedvar.pollExecSelected.pollList[0],e.goto.push(e.selectedPoll.id),e.availablePolls(e.selectedPoll.title,e.selectedPoll.id)):(e.snkBar.open("Listado de actividades vac\xedo.","Ok",{duration:5e3}),e.nvg.onRouteBack());const l=e.dtb.getLocalPollResult(e.sharedvar.pollExecSelected.pollResult_id).subscribe(s=>{l&&l.unsubscribe(),e.sharedvar.selPollResult=s,e.sharedvar.selPollResult.status<2&&e.OnStartPoll(),e.subscribeChatEvent(),e.sharedvar.pollExecSelected.done&&e.onEndPoll()})})()}OnStartPoll(){var e=this;return(0,r.Z)(function*(){e.sharedvar.selPollResult.status=2,e.sharedvar.selPollResult.date_ini=1e4*Math.trunc(Number(Date.now())/1e4),e.sharedvar.pollExecSelected.onStart&&(e.sharedvar.pollExecSelected.onStart.sendMail2&&e.sharedvar.pollExecSelected.onStart.sendMail2.length>0&&e.dtb.notifMail(e.sharedvar.selPollResult,e.sharedvar.pollExecSelected.onStart.sendMail2,"","start"),e.sharedvar.pollExecSelected.onStart.geoLoc&&(e.sharedvar.selPollResult.geoLocStart=yield e.getLocalization())),e.dtb.addUpdateLocalList(e.sharedvar.pollExecSelected,e.sharedvar.selPollResult),e.dtb.updatePartialAsync(e.sharedvar.selPollResult,"status")})()}OnEndPoll(){var e=this;return(0,r.Z)(function*(){e.sharedvar.selPollResult.date_end=1e4*Math.trunc(Number(Date.now())/1e4),e.sharedvar.selPollResult.staff_picture="",e.sharedvar.pollExecSelected.onEnd&&e.sharedvar.pollExecSelected.onEnd.geoLoc&&(e.sharedvar.selPollResult.geoLocEnd=yield e.getLocalization())})()}availablePolls(e,l){this.visitePollList.find(s=>s===`${e}:${l}`)||this.visitePollList.push(`${e}:${l}`)}getAvailPollTitle(e){return e.split(":")[0]}visiteByAvailTitle(e){const l=e.split(":")[1];if(this.goto[this.goto.length-1]===l)return;const s=this.sharedvar.pollExecSelected.pollList.find(o=>o.id===l);s&&(this.goto.push(l),this.selectedPoll=s,this.reset++)}subscribeChatEvent(){var l,e=this;this.chatSub=this.notifServ.dtb_notification().subscribe({next:(l=(0,r.Z)(function*(s){"chat"===s.collection&&s.field_id&&s.field_id===e.sharedvar.selPollResult._id&&e.getChatState()}),function(o){return l.apply(this,arguments)}),complete:()=>{console.log()}}),this.getChatState()}getChatState(){var e=this;return(0,r.Z)(function*(){const l=yield e.dtb.getChat(e.sharedvar.selPollResult._id);e.sharedvar.selPollResult.status_date=Date.now(),e.sharedvar.selPollResult.chats=l;const s=l.length-1;return s>=0&&"W"===l[s].type?(e.snkBar.open(`Mensaje: ${e.sharedvar.selPollResult.chats[s].msg}.`,"Ok",{duration:3e3}),e.lchat=!0):e.lchat=!1,s})()}ngOnDestroy(){this.subs&&this.subs.unsubscribe()}getClicked(e){switch(e.index){case 4:let l=document.getElementById("spanTrigger");l&&(l.style.display="",l.style.position="absolute",l.style.left=e.pageX+5+"px",l.style.top=e.pageY+5+"px",this.editControlTrigger.openMenu());break;case 5:this.updateResultParcial();break;case 7:this.commands="question_mark"===this.commands?"":"question_mark"}}chatExec(e){const s={title:0===e?"Administrador":"IA "+this.selectedPoll.title,dgwidth:400,value:this.sharedvar.selPollResult.chats,function:[{name:"chat",self:this,function:this.adminChat}],tags:{chat:e.toString(),ai:"1",who:"T"}};this.dg.aChat(s)}adminChat(e,l,s){e.sharedvar.selPollResult.chats=l,e.dtb.updatePartialAsync(e.sharedvar.selPollResult,"chats")}onGetData(e){var l=this;return(0,r.Z)(function*(){const s=e._btnclick_,o=e._propName_;if(o&&l.selectedPoll.schema.controls){const i=l.selectedPoll.schema.controls.find(n=>n.name===o);if(i&&i.tags)if(s)switch(i.tags.type){case"goto":l.getGoto(o,i,e);break;case"geolocation":e[o]=yield l.getLocalization(),i.sideBtn="done",l.reset++;break;case"picture":l.getPicture(e,i,o);break;case"draw":l.getDraw(e,i,o);break;case"appoint":l.getAppoint(e,o);break;case"costumer":l.getCostumer(e,o);break;case"product":l.getProduct(e,o);break;case"duplicate":const n=l.findDupPollList(l.selectedPoll,o);i.avalue=n,e[o]=n,n&&l.getGoto(o,i,e);break;case"text":case"textarea":e[o]=l.service.voiceRecogition(e[o]),l.reset++}else e._command_&&e._command_===l.commands&&i.tags.help?l.snkBar.open(i.tags.help,"Listo",{duration:1e4}):(e._btnclick_2_||"duplicate"===i.tags.type)&&l.getGoto(o,i,e)}l.updateLocalList(e)})()}onGetValid(e){this.selectedPoll.values._valid_!==e&&this.updateLocalList({_valid_:e})}getGoto(e,l,s){const o=this.sharedvar.pollExecSelected.pollList.find(i=>i.id===l.avalue);if(o&&l.avalue&&l.avalue.length>0)this.goto.push(l.avalue),this.sharedvar.selPollResult.metaValues[e]=s.urlrute||l.avalue,this.reset++,setTimeout(()=>{delete s._valid_,this.updateLocalList(s),this.selectedPoll=o,this.availablePolls(this.selectedPoll.title,this.selectedPoll.id),this.reset++},100);else if(l.selectOptions){const i=l.selectOptions.findIndex(n=>n.key===l.avalue);i>=0&&l.selectOptions.splice(i,1)}}getLocalization(){var e=this;return(0,r.Z)(function*(){const s=yield e.getPosition();return s.lng=Math.trunc(1e4*s.lng)/1e4,s.lat=Math.trunc(1e4*s.lat)/1e4,e.snkBar.open("Ubicaci\xf3n ingresada.","Ok",{duration:3e3}),s})()}updateLocalList(e){!this.selectedPoll.values||!e||(e._btnEvent_="",e._propName_="",this.selectedPoll.values=this.dg.updatePropResult(this.selectedPoll.values,e),this.dtb.addUpdateLocalList(this.sharedvar.pollExecSelected,this.sharedvar.selPollResult))}onBack(){var e=this;this.selectedPoll.values&&!1===this.selectedPoll.values._valid_?this.snkBar.open("Hay campos sin llenar. \xbfSalir de todos modos?","Si",{duration:3e3}).onAction().subscribe((0,r.Z)(function*(){e.onBackProcess()})):this.onBackProcess()}onBackProcess(){if(this.goto.length>1){const e=this.sharedvar.pollExecSelected.pollList.find(l=>l.id===this.goto[this.goto.length-2]);e&&(this.selectedPoll=e,this.goto.splice(this.goto.length-1,1))}}onDelete(){var e=this;this.snkBar.open("\xbfBorrar \xe9ste grupo?","Ok",{duration:3e3}).onAction().subscribe((0,r.Z)(function*(){if(e.goto.length>1){const l=e.sharedvar.pollExecSelected.pollList.find(o=>o.id===e.goto[e.goto.length-2]),s=e.sharedvar.pollExecSelected.pollList.findIndex(o=>o.id===e.goto[e.goto.length-1]);s>=0&&e.sharedvar.pollExecSelected.pollList.splice(s,1),l&&(e.selectedPoll=l,e.goto.splice(e.goto.length-1,1))}}))}onEndPoll(){var e=this;return(0,r.Z)(function*(){const l=e.isValid();""===l?e.selectedPoll.allowEnd&&e.snkBar.open("\xbfFinalizar?","Ok",{duration:5e3}).onAction().subscribe((0,r.Z)(function*(){e.sharedvar.selPollResult=e.onResultDone(e.sharedvar.selPollResult),e.sharedvar.selPollResult?(e.sharedvar.selPollResult.ended=!0,e.sharedvar.selPollResult.status=3,e.sharedvar.selPollResult.status_date=Date.now(),(yield function U(a){return E.apply(this,arguments)}())?window.location.hostname.includes("tasky-danilo-prod.up.railway.app")||window.location.hostname.includes("localhost")?yield e.exportResultDataDevelop():yield e.exportResultData():(e.snkBar.open("No fue posible exportar la informaci\xf3n. Por favor sincronice cuando est\xe9 linea.","Ok",{duration:3e3}),e.sharedvar.pollExecSelected.done=!0,e.dtb.addUpdateLocalList(e.sharedvar.pollExecSelected,e.sharedvar.selPollResult)),e.nvg.onRouteBack()):e.snkBar.open("Existen campos sin llenar.","Ok",{duration:3e3})})):e.snkBar.open(`Debe llenar campos requeridos en "${l}".`,"Ok",{duration:3e3})})()}isValid(){let e="",l=!0,s=[];for(const o of this.visitePollList){s=o.split(":");const i=this.sharedvar.pollExecSelected.pollList.find(n=>n.id===s[1]);if(i&&(l=i.values._valid_&&l,!l)){e=i.title;break}}return""!==e&&this.visiteByAvailTitle(s.join(":")),e}updateResultParcial(){var e=this;return(0,r.Z)(function*(){const l=JSON.parse(JSON.stringify(e.sharedvar.pollExecSelected)),s=JSON.parse(JSON.stringify(e.sharedvar.selPollResult));e.dtb.promiseMetaData(l,s).then(function(){var o=(0,r.Z)(function*(i){s.date_end=1e4*Math.trunc(Number(Date.now())/1e4),s.values={},s.values_type={},l.pollList.forEach(n=>{e.updatePollPropResult(s.values,s.values_type,n)}),yield e.dtb.CreateUpdatePollResult(s),e.snkBar.open("Encuesta parcial enviada.","Listo",{duration:5e3})});return function(i){return o.apply(this,arguments)}}())})()}exportResultData(e=0,l=0){var s=this;return(0,r.Z)(function*(){s.dtb.promiseMetaData(s.sharedvar.pollExecSelected,s.sharedvar.selPollResult).then(function(){var o=(0,r.Z)(function*(i){i&&(s.sharedvar.selPollResult.values={},s.sharedvar.selPollResult.values_type={},s.sharedvar.pollExecSelected.pollList.forEach(n=>{s.updatePollPropResult(s.sharedvar.selPollResult.values,s.sharedvar.selPollResult.values_type,n)}),yield s.OnEndPoll(),s.sharedvar.selPollResult.metaValues=[],e>0&&l>0&&(s.sharedvar.selPollResult.date_ini=e,s.sharedvar.selPollResult.date_end=l),s.sharedvar.selPollResult=yield s.dtb.CreateUpdatePollResult(s.sharedvar.selPollResult),yield s.dtb.updateStaffAsync(s.sharedvar.staff),console.log(s.sharedvar.selPollResult),s.sharedvar.pollExecSelected&&s.sharedvar.pollExecSelected.onEnd?.sendMail2&&s.sharedvar.pollExecSelected.onEnd.sendMail2.length>0&&s.htm2pdf.buildHtml2Pdf(s.sharedvar.selPollResult,s.sharedvar.pollExecSelected.onEnd.sendMail2),s.dtb.delFromLocalList(s.sharedvar.pollExecSelected),s.snkBar.open('Encuesta finalizada. Siga el reporte de sus encuestas en "Estado de mi Cuenta".',"Ok",{duration:5e3}))});return function(i){return o.apply(this,arguments)}}())})()}exportResultDataDevelop(){var e=this;return(0,r.Z)(function*(){const l=e.sharedvar.dateNow(),s=l+e.sharedvar.addMinutes(30);e.dg.aDefault({title:"Horario acomodado",schema:{controls:[{name:"date_ini",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}},{name:"date_end",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}}]},value:{date_ini:l,date_end:s},dgwidth:400,dgheigth:360}).subscribe(n=>{n&&e.exportResultData(n.date_ini,n.date_end)})})()}updatePollPropResult(e,l,s){return s.schema.controls?.forEach(o=>{if(s.values._btnEvent_="",s.values._propName_="",s.values._valid_="",s.values._btnclick_="",o.tags&&!0===o.tags.dtbase&&s.values[o.name]&&s.values[o.name].toString().length>0){let i=o.tags.type;switch(o.tags.type){case"draw":i="picture";break;case"product":case"multiselect":i="array";break;case"textarea":case"costumer":case"duplicate":case"goto":case"header":i="text"}e[o.name]=s.values[o.name],l[o.name]=i}}),e}geoloc(){var e=this;return(0,r.Z)(function*(){yield e.getPosition().then(s=>{s.lng=Math.trunc(100*s.lng)/100,s.lat=Math.trunc(100*s.lat)/100})})()}getPosition(){return new Promise((e,l)=>{navigator.geolocation.getCurrentPosition(s=>{e({lng:s.coords.longitude,lat:s.coords.latitude})},s=>{l(s)})})}getPicture(e,l,s){this.dg.aCamera({title:"C\xe1mara",value:{img:e,name:"pepito"}}).subscribe(n=>{n&&n.urlrute&&n.urlrute.length>0&&(e[s]=`${l.label} \u2714\ufe0f`,this.sharedvar.selPollResult.metaValues[s]=n.urlrute,this.updateLocalList(e),this.reset++)})}getDraw(e,l,s){this.dg.aDraw({title:"Dibujar",value:{img:this.sharedvar.selPollResult.metaValues[s]?this.sharedvar.selPollResult.metaValues[s]:l.avalue,name:"pepito"}}).subscribe(n=>{n&&n.urlrute&&n.urlrute.length>0&&(e[s]=`${l.label} \u2714\ufe0f`,this.sharedvar.selPollResult.metaValues[s]=n.urlrute,this.updateLocalList(e),this.reset++)})}getAppoint(e,l,s="appoint"){var o=this;return(0,r.Z)(function*(){const i=yield o.staffServ.onAddEditAppoint(o.sharedvar.selPollResult.metaValues[l]||null);if(i){const n=`${o.sharedvar.formatNumber2DateTime(i.datetime,"/")} - ${i.notes||""}`;e[l]=n,o.sharedvar.selPollResult.metaValues[l]=i,o.updateLocalList(e),o.reset++}})()}getCostumer(e,l){const s=this.sharedvar.pollExecSelected.costumerList;s&&s.length>0&&this.onSelCtrlList(s,"Seleccione Cliente",e,l,"costumer",!1)}getProduct(e,l){const s=this.sharedvar.pollExecSelected.productList;s&&s.length>0&&this.onSelCtrlList(s,"Seleccione Producto",e,l,"product",!0)}onSelCtrlList(e,l,s,o,i,n){var f=this;return(0,r.Z)(function*(){const v=[];e.forEach(p=>{if(p){const g=p.split(":"),N=f.sharedvar.selPollResult.crm_prod_id?.findIndex(pe=>pe===g[0]);v.push({selected:!!(N&&N>=0),myid:g[0],name:g[1]})}});const P={title:l,viewfilter:!0,viewAdd:!1,multiSelect:n,valuelst:v};return yield f.ds.aSelectDefault(P).subscribe(p=>{p&&("product"===i?(f.sharedvar.selPollResult.crm_prod_id=[],s[o]="",p.forEach(g=>{s[o]+=g.name+",\n"})):(f.sharedvar.selPollResult.crm_costum_id=p[0].myid,f.sharedvar.selPollResult.crm_costum_name=p[0].name,s[o]=p[0].name),f.updateLocalList(s),f.reset++)})})()}onResultDone(e){let l={...e};return this.sharedvar.pollExecSelected.pollList.forEach(s=>{l.values={...l.values,...s.values}}),l.values&&(l.values._btnEvent_="",l.values._valid_=!0),l}findDupPollList(e,l){const s=e.schema.controls?.find(n=>n.name==l);if(!s)return;const o=s.tags||{},i=this.sharedvar.pollExecSelected.pollList.find(n=>n.id===o.dupactivity);if(i){const n=JSON.parse(JSON.stringify(i));return n.title=`${i.title} ${i.dupTotal}`,i.dupTotal++,n.totalDup=0,n.id=this.dtb.getSerialKey(3,4,"_"),n.duplicated=!0,this.updatePollNames(n),s.selectOptions?.push({key:n.id,value:n.title}),this.sharedvar.pollExecSelected.pollList.push(n),this.dtb.addUpdateLocalList(this.sharedvar.pollExecSelected,this.sharedvar.selPollResult),this.reset++,n.id}}updatePollNames(e){e.schema.controls?.forEach(l=>{l.name=this.getUniqueName(l.name,this.sharedvar.pollExecSelected.pollList)})}getUniqueName(e,l){let s=0;for(let o=0;o<l.length;o++){const i=l[o].schema.controls||[];for(let n=0;n<i.length;n++)if(i[n].name===`${e}_${s}`){s++,o=-1;break}}return`${e}_${s}`}static#e=this.\u0275fac=function(l){return new(l||a)(t.Y36(D.k),t.Y36(T.ux),t.Y36(M.x),t.Y36(F),t.Y36(z.$),t.Y36(O.D),t.Y36(H.$),t.Y36(j.Q),t.Y36(K),t.Y36(X))};static#t=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-poll"]],viewQuery:function(l,s){if(1&l&&t.Gf(le,5),2&l){let o;t.iGM(o=t.CRH())&&(s.editControlTrigger=o.first)}},decls:30,vars:15,consts:[[1,"flex","flex-col","max-h-screen"],[3,"buttons","lchat","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"flex","align-middle","justify-center","h-8","border-b","border-violet-500","font-medium","text-lg","p-1","mb-1","text-violet-900"],[3,"matMenuTriggerFor"],[1,"grow","pt-3","mx-1","overflow-y-auto","overflow-x-hidden"],[3,"reset","jsonFormData","values","commands","result","valid"],[1,"h-12","flex","flex-row","items-center","justify-center","border-t","border-violet-500"],["color","primary","mat-raised-button","",3,"click",4,"ngIf"],["color","warn","mat-raised-button","",3,"click",4,"ngIf"],["visitedmenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["chatmenu","matMenu"],["mat-menu-item","",3,"click"],["color","primary"],["color","primary","mat-raised-button","",3,"click"],["color","warn","mat-raised-button","",3,"click"]],template:function(l,s){if(1&l&&(t.TgZ(0,"div",0)(1,"app-header",1),t.NdJ("onClicked",function(i){return s.getClicked(i)}),t.qZA(),t._UZ(2,"span",2,3),t.TgZ(4,"div",4)(5,"span",5),t._uU(6),t.qZA(),t.TgZ(7,"mat-icon",5),t._uU(8,"arrow_drop_down"),t.qZA()(),t.TgZ(9,"div",6)(10,"app-dynamic-form",7),t.NdJ("result",function(i){return s.onGetData(i)})("valid",function(i){return s.onGetValid(i)}),t.qZA()(),t.TgZ(11,"div",8),t.YNc(12,se,3,0,"button",9),t._uU(13," \xa0 "),t.YNc(14,oe,4,0,"button",9),t._uU(15," \xa0 "),t.YNc(16,ae,3,0,"button",10),t.qZA()(),t.TgZ(17,"mat-menu",null,11),t.YNc(19,ie,2,1,"button",12),t.qZA(),t.TgZ(20,"mat-menu",null,13)(22,"button",14),t.NdJ("click",function(){return s.chatExec(0)}),t.TgZ(23,"mat-icon",15),t._uU(24,"forum"),t.qZA(),t._uU(25," Administrador "),t.qZA(),t.TgZ(26,"button",14),t.NdJ("click",function(){return s.chatExec(1)}),t.TgZ(27,"mat-icon",15),t._uU(28,"auto_awesome"),t.qZA(),t._uU(29),t.qZA()()),2&l){const o=t.MAs(18),i=t.MAs(21);t.xp6(1),t.Q6J("buttons","00001101")("lchat",s.lchat),t.xp6(1),t.Q6J("matMenuTriggerFor",i),t.xp6(3),t.Q6J("matMenuTriggerFor",o),t.xp6(1),t.Oqu(s.selectedPoll.title),t.xp6(1),t.Q6J("matMenuTriggerFor",o),t.xp6(3),t.Q6J("reset",s.reset)("jsonFormData",s.selectedPoll.schema)("values",s.selectedPoll.values)("commands",s.commands),t.xp6(2),t.Q6J("ngIf",s.goto.length>1),t.xp6(2),t.Q6J("ngIf",s.selectedPoll.allowEnd),t.xp6(2),t.Q6J("ngIf",s.selectedPoll.duplicated),t.xp6(3),t.Q6J("ngForOf",s.visitePollList),t.xp6(10),t.hij(" AI ",s.selectedPoll.title," ")}},dependencies:[u.sg,u.O5,ee.G,te.r,_.VK,_.OP,_.p6,L.lW,A.Hw]})}return a})()}];let re=(()=>{class a{static#e=this.\u0275fac=function(l){return new(l||a)};static#t=this.\u0275mod=t.oAB({type:a});static#l=this.\u0275inj=t.cJS({imports:[d.Bz.forChild(ne),d.Bz]})}return a})();var ce=c(8471),de=c(6842);let ue=(()=>{class a{static#e=this.\u0275fac=function(l){return new(l||a)};static#t=this.\u0275mod=t.oAB({type:a});static#l=this.\u0275inj=t.cJS({imports:[u.ez,re,ce.O,de.N,_.Tx,L.ot,A.Ps,T.ZX]})}return a})()},4066:y=>{const x="[a-fA-F\\d:]",c=h=>h&&h.includeBoundaries?`(?:(?<=\\s|^)(?=${x})|(?<=${x})(?=\\s|$))`:"",u="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",d="[a-fA-F\\d]{1,4}",r=`\n(?:\n(?:${d}:){7}(?:${d}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${d}:){6}(?:${u}|:${d}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${d}:){5}(?::${u}|(?::${d}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${d}:){4}(?:(?::${d}){0,1}:${u}|(?::${d}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${d}:){3}(?:(?::${d}){0,2}:${u}|(?::${d}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${d}:){2}(?:(?::${d}){0,3}:${u}|(?::${d}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${d}:){1}(?:(?::${d}){0,4}:${u}|(?::${d}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${d}){0,5}:${u}|(?::${d}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),S=new RegExp(`(?:^${u}$)|(?:^${r}$)`),k=new RegExp(`^${u}$`),w=new RegExp(`^${r}$`),b=h=>h&&h.exact?S:new RegExp(`(?:${c(h)}${u}${c(h)})|(?:${c(h)}${r}${c(h)})`,"g");b.v4=h=>h&&h.exact?k:new RegExp(`${c(h)}${u}${c(h)}`,"g"),b.v6=h=>h&&h.exact?w:new RegExp(`${c(h)}${r}${c(h)}`,"g"),y.exports=b},6599:(y,x,c)=>{const u=c(4066),d=r=>u({exact:!0}).test(r);d.v4=r=>u.v4({exact:!0}).test(r),d.v6=r=>u.v6({exact:!0}).test(r),d.version=r=>d(r)?d.v4(r)?4:6:void 0,y.exports=d}}]);