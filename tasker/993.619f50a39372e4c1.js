"use strict";(self.webpackChunktasky_tasker=self.webpackChunktasky_tasker||[]).push([[993],{7993:(S,P,c)=>{c.r(P),c.d(P,{PollModule:()=>ce});var p=c(6895),u=c(9132),d=c(5861),w=c(6599);class y extends Error{constructor(){super("Request was cancelled"),this.name="CancelError"}get isCanceled(){return!0}}class E extends Error{constructor(f){super("Could not get the public IP address",f),this.name="IpNotFoundError"}}const k={timeout:5e3},v={v4:["https://ipv4.icanhazip.com/","https://api.ipify.org/"],v6:["https://ipv6.icanhazip.com/","https://api6.ipify.org/"]},O=(a,f,e)=>{const o=new XMLHttpRequest;let l;const s=new Promise((n,i)=>{l=i,o.addEventListener("error",i,{once:!0}),o.addEventListener("timeout",i,{once:!0}),o.addEventListener("load",()=>{const h=o.responseText.trim();h&&w[e](h)?n(h):i()},{once:!0}),o.open("GET",a),o.timeout=f.timeout,o.send()});return s.cancel=()=>{o.abort(),l(new y)},s},D=(a,f)=>{let e;const o=(0,d.Z)(function*(){const l=[...v[a],...f.fallbackUrls??[]];let s;for(const n of l)try{return e=O(n,f,a),yield e}catch(i){if(s=i,i instanceof y)throw i}throw new E({cause:s})})();return o.cancel=()=>{e.cancel()},o},J={v4:a=>D("v4",{...k,...a}),v6:a=>D("v6",{...k,...a})};function T(){return(T=(0,d.Z)(function*(a){if(a={timeout:5e3,ipVersion:4,...a},!navigator?.onLine)return!1;const f=4===a.ipVersion?"v4":"v6";try{return yield J[f](a),!0}catch{return!1}})).apply(this,arguments)}var t=c(4650),U=c(8826),M=c(7009),B=c(8391),Z=c(5412),L=c(4859),$=c(7392),g=c(8255),C=c(4006);function I(a,f){if(1&a){const e=t.EpF();t.TgZ(0,"div",15)(1,"input",16),t.NdJ("change",function(){t.CHM(e);const l=t.oxw(2);return t.KtG(l.onChekAll())}),t.qZA()()}if(2&a){const e=t.oxw(2);t.xp6(1),t.Q6J("checked",e.chekAll)}}function V(a,f){if(1&a){const e=t.EpF();t.TgZ(0,"div",11),t.YNc(1,I,2,1,"div",12),t.TgZ(2,"mat-icon",13),t._uU(3),t.qZA(),t.TgZ(4,"input",14),t.NdJ("ngModelChange",function(l){t.CHM(e);const s=t.oxw();return t.KtG(s.filtertext=l)})("change",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.onViewSelected(!1))}),t.qZA()()}if(2&a){const e=t.oxw(),o=t.MAs(15);t.xp6(1),t.Q6J("ngIf",e.multiSelect),t.xp6(1),t.Q6J("matMenuTriggerFor",o),t.xp6(1),t.Oqu(e.getView()),t.xp6(1),t.Q6J("ngModel",e.filtertext)}}function G(a,f){if(1&a){const e=t.EpF();t.TgZ(0,"div",19)(1,"input",20),t.NdJ("ngModelChange",function(l){t.CHM(e);const s=t.oxw().$implicit;return t.KtG(s.selected=l)})("change",function(){t.CHM(e);const l=t.oxw().$implicit,s=t.oxw();return t.KtG(s.onSelected(l))}),t.qZA(),t.TgZ(2,"label",21),t._uU(3),t.qZA()()}if(2&a){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",e.selected),t.xp6(2),t.Oqu(e.name)}}function H(a,f){if(1&a&&(t.TgZ(0,"div",17),t.YNc(1,G,4,2,"div",18),t.qZA()),2&a){const e=f.$implicit,o=t.oxw();t.xp6(1),t.Q6J("ngIf",o.getViewFilter(e))}}function Y(a,f){if(1&a){const e=t.EpF();t.TgZ(0,"div",22)(1,"button",7),t.NdJ("click",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.onNew())}),t._uU(2," Nuevo\xa0 "),t.TgZ(3,"mat-icon"),t._uU(4,"add"),t.qZA()()()}}let q=(()=>{class a{constructor(e,o){this.dialogRef=e,this.data=o,this.filtertext="",this.selectedOptions=[],this.chekAll=!1,this.viewSelected=!1,this.multiSelect=!1,e.disableClose=!0,this.multiSelect=o.multiSelect||!1}onNew(){this.dialogRef.close({new:!0})}onChekAll(){this.chekAll=!this.chekAll,this.data.valuelst?.forEach(e=>{e.selected=this.chekAll})}getViewFilter(e){if(this.viewSelected)return e.selected||!1;const o=this.filtertext.toUpperCase();return!!(0===o.length||e&&e.name&&e.name.toUpperCase().includes(o))}onSelected(e){this.multiSelect||(this.selectedOptions=[e],this.dialogRef.close(this.selectedOptions))}onSave(){this.selectedOptions=[],this.data.valuelst?.forEach(e=>{e.selected&&this.selectedOptions.push(e)}),this.dialogRef.close(this.selectedOptions)}onDismiss(){this.dialogRef.close()}getView(){return this.viewSelected?"done":"visibility"}onViewSelected(e){this.viewSelected=e}static#e=this.\u0275fac=function(o){return new(o||a)(t.Y36(Z.so),t.Y36(Z.WI))};static#t=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-select-dialog"]],decls:24,vars:4,consts:[[1,"flex","flex-col","h-full"],[1,"h-12","p-3","text-2xl","bg-violet-600","text-white"],["class","h-10 w-full flex flex-row items-center border-b border-violet-500",4,"ngIf"],[1,"flex-1","overflow-auto","mt-2"],["class","flex flex-column",4,"ngFor","ngForOf"],[1,"flex","p-3","justify-end","border-t","border-violet-500"],["class","flex-1","fxFlex","",4,"ngIf"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary","cdkFocusInitia","",3,"click"],["selectView","matMenu"],["mat-menu-item","",3,"click"],[1,"h-10","w-full","flex","flex-row","items-center","border-b","border-violet-500"],["class","w-6 ml-2 mt-2",4,"ngIf"],[1,"bg-gray-200","rounded-sm",3,"matMenuTriggerFor"],["type","search","placeholder","Filtrar...",1,"flex-1","ml-2","h-8","z-20","text-gray-900","outline-none","border-b","border-gray-200","focus:outline-none","focus:outline-none",3,"ngModel","ngModelChange","change"],[1,"w-6","ml-2","mt-2"],["type","checkbox",1,"w-4","h-4","focus:border-blue-500",3,"checked","change"],[1,"flex","flex-column"],["class","flex flex-row h-8 ml-2",4,"ngIf"],[1,"flex","flex-row","h-8","ml-2"],["id","itemsel","type","checkbox",1,"w-4","h-4","text-violet-500","bg-gray-100","border-gray-300","rounded","dark:focus:ring-violet-500","dark:ring-offset-gray-800","focus:ring-2","dark:bg-gray-700","dark:border-gray-600",3,"ngModel","ngModelChange","change"],["for","itemsel",1,"ml-4","h-4","w-72","text-sm","text-gray-900","overflow-hidden"],["fxFlex","",1,"flex-1"]],template:function(o,l){1&o&&(t.TgZ(0,"div",0)(1,"h1",1),t._uU(2),t.qZA(),t.YNc(3,V,5,4,"div",2),t.TgZ(4,"div",3),t.YNc(5,H,2,1,"div",4),t.qZA(),t.TgZ(6,"div",5),t.YNc(7,Y,5,0,"div",6),t.TgZ(8,"button",7),t.NdJ("click",function(){return l.onDismiss()}),t.TgZ(9,"mat-icon"),t._uU(10,"close"),t.qZA()(),t.TgZ(11,"button",8),t.NdJ("click",function(){return l.onSave()}),t.TgZ(12,"mat-icon"),t._uU(13,"done"),t.qZA()()(),t.TgZ(14,"mat-menu",null,9)(16,"button",10),t.NdJ("click",function(){return l.onViewSelected(!0)}),t.TgZ(17,"mat-icon"),t._uU(18,"done"),t.qZA(),t._uU(19," Ver seleccionados "),t.qZA(),t.TgZ(20,"button",10),t.NdJ("click",function(){return l.onViewSelected(!1)}),t.TgZ(21,"mat-icon"),t._uU(22,"visibility"),t.qZA(),t._uU(23," Ver Todo "),t.qZA()()()),2&o&&(t.xp6(2),t.Oqu(l.data.title),t.xp6(1),t.Q6J("ngIf",l.data.viewfilter),t.xp6(2),t.Q6J("ngForOf",l.data.valuelst),t.xp6(2),t.Q6J("ngIf",l.data.viewAdd))},dependencies:[p.sg,p.O5,L.lW,$.Hw,g.VK,g.OP,g.p6,C.Fj,C.Wl,C.JJ,C.On]})}return a})(),Q=(()=>{class a{constructor(e){this.dialog=e}aSelectDefault(e){let o=window.innerHeight-20;return e.dgheigth=e.dgheigth||o,o=o>600?600:o,this.dialogRef=this.dialog.open(q,{panelClass:"custom-dialog-container",height:o.toString()+"px",width:"350px",data:e}),this.dialogRef.afterClosed()}static#e=this.\u0275fac=function(o){return new(o||a)(t.LFG(Z.uw))};static#t=this.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var z=c(2419),K=c(5377),j=c(1316),W=c(9496),X=c(3646),ee=c(2395);function te(a,f){if(1&a){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.onBack())}),t.TgZ(1,"mat-icon"),t._uU(2,"arrow_back"),t.qZA()()}}function le(a,f){if(1&a){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.onEndPoll())}),t._uU(1," Finalizar"),t.TgZ(2,"mat-icon"),t._uU(3,"done"),t.qZA()()}}function oe(a,f){if(1&a){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const l=t.oxw();return t.KtG(l.onDelete())}),t.TgZ(1,"mat-icon"),t._uU(2,"delete"),t.qZA()()}}function se(a,f){if(1&a){const e=t.EpF();t.TgZ(0,"button",13),t.NdJ("click",function(){const s=t.CHM(e).$implicit,n=t.oxw();return t.KtG(n.visiteByAvailTitle(s))}),t._uU(1),t.qZA()}if(2&a){const e=f.$implicit,o=t.oxw();t.xp6(1),t.hij(" ",o.getAvailPollTitle(e)," ")}}const ae=[{path:"",component:(()=>{class a{constructor(e,o,l,s,n,i,h,_){this.dtb=e,this.snkBar=o,this.dg=l,this.ds=s,this.nvg=n,this.sharedvar=i,this.notifServ=h,this.htm2pdf=_,this.lchat=!1,this.goto=[],this.visitePollList=[],this.reset=0}ngOnInit(){var e=this;return(0,d.Z)(function*(){e.sharedvar.pollExecSelected.pollList.length>0?(e.selectedPoll=e.sharedvar.pollExecSelected.pollList[0],e.goto.push(e.selectedPoll.id),e.availablePolls(e.selectedPoll.title,e.selectedPoll.id)):(e.snkBar.open("Listado de actividades vac\xedo.","Ok",{duration:5e3}),e.nvg.onRouteBack());const o=e.dtb.getLocalPollResult(e.sharedvar.pollExecSelected.pollResult_id).subscribe(l=>{o&&o.unsubscribe(),e.sharedvar.selPollResult=l,e.sharedvar.selPollResult.status<2&&e.OnStartPoll(),e.subscribeChatEvent(),e.sharedvar.pollExecSelected.done&&e.onEndPoll()})})()}OnStartPoll(){var e=this;return(0,d.Z)(function*(){e.sharedvar.selPollResult.status=2,e.sharedvar.selPollResult.date_ini=1e4*Math.trunc(Number(Date.now())/1e4),e.sharedvar.pollExecSelected.onStart&&(e.sharedvar.pollExecSelected.onStart.sendMail2&&e.sharedvar.pollExecSelected.onStart.sendMail2.length>0&&e.dtb.notifMail(e.sharedvar.selPollResult,e.sharedvar.pollExecSelected.onStart.sendMail2,"","start"),e.sharedvar.pollExecSelected.onStart.geoLoc&&(e.sharedvar.selPollResult.geoLocStart=yield e.getLocalization())),e.dtb.addUpdateLocalList(e.sharedvar.pollExecSelected,e.sharedvar.selPollResult),e.dtb.updatePartialAsync(e.sharedvar.selPollResult,"status")})()}OnEndPoll(){var e=this;return(0,d.Z)(function*(){e.sharedvar.selPollResult.date_end=1e4*Math.trunc(Number(Date.now())/1e4),e.sharedvar.selPollResult.staff_picture="",e.sharedvar.pollExecSelected.onEnd&&e.sharedvar.pollExecSelected.onEnd.geoLoc&&(e.sharedvar.selPollResult.geoLocEnd=yield e.getLocalization())})()}availablePolls(e,o){this.visitePollList.find(l=>l===`${e}:${o}`)||this.visitePollList.push(`${e}:${o}`)}getAvailPollTitle(e){return e.split(":")[0]}visiteByAvailTitle(e){const o=e.split(":")[1];if(this.goto[this.goto.length-1]===o)return;const l=this.sharedvar.pollExecSelected.pollList.find(s=>s.id===o);l&&(this.goto.push(o),this.selectedPoll=l,this.reset++)}subscribeChatEvent(){var o,e=this;this.chatSub=this.notifServ.dtb_notification().subscribe({next:(o=(0,d.Z)(function*(l){"chat"===l.collection&&l.field_id&&l.field_id===e.sharedvar.selPollResult._id&&e.getChatState()}),function(s){return o.apply(this,arguments)}),complete:()=>{console.log()}}),this.getChatState()}getChatState(){var e=this;return(0,d.Z)(function*(){const o=yield e.dtb.getChat(e.sharedvar.selPollResult._id);e.sharedvar.selPollResult.status_date=Date.now(),e.sharedvar.selPollResult.chats=o;const l=o.length-1;return l>=0&&"W"===o[l].type?(e.snkBar.open(`Mensaje: ${e.sharedvar.selPollResult.chats[l].msg}.`,"Ok",{duration:3e3}),e.lchat=!0):e.lchat=!1,l})()}ngOnDestroy(){this.subs&&this.subs.unsubscribe()}getClicked(e){switch(e.index){case 4:this.dg.aChat({title:"Chat",dgwidth:400,value:this.sharedvar.selPollResult});break;case 5:this.getAppoint(null,"_note_","note")}}onGetData(e){var o=this;return(0,d.Z)(function*(){const l=e._btnclick_,s=e._propName_;if(s&&o.selectedPoll.schema.controls){const n=o.selectedPoll.schema.controls.find(i=>i.name===s);if(n&&n.tags)if(l)switch(n.tags.type){case"goto":o.getGoto(s,n,e);break;case"geolocation":e[s]=yield o.getLocalization(),n.sideBtn="done",o.reset++;break;case"picture":o.getPicture(e,n,s);break;case"draw":o.getDraw(e,n,s);break;case"appoint":o.getAppoint(e,s);break;case"costumer":o.getCostumer(e,s);break;case"product":o.getProduct(e,s);break;case"duplicate":const i=o.findDupPollList(o.selectedPoll,s);n.avalue=i,e[s]=i,i&&o.getGoto(s,n,e)}else(e._btnclick_2_||"duplicate"===n.tags.type)&&o.getGoto(s,n,e)}o.updateLocalList(e)})()}onGetValid(e){this.selectedPoll.values._valid_!==e&&this.updateLocalList({_valid_:e})}getGoto(e,o,l){const s=this.sharedvar.pollExecSelected.pollList.find(n=>n.id===o.avalue);if(s&&o.avalue&&o.avalue.length>0)this.goto.push(o.avalue),this.sharedvar.selPollResult.metaValues[e]=l.urlrute||o.avalue,this.reset++,setTimeout(()=>{delete l._valid_,this.updateLocalList(l),this.selectedPoll=s,this.availablePolls(this.selectedPoll.title,this.selectedPoll.id),this.reset++},100);else if(o.selectOptions){const n=o.selectOptions.findIndex(i=>i.key===o.avalue);n>=0&&o.selectOptions.splice(n,1)}}getLocalization(){var e=this;return(0,d.Z)(function*(){const l=yield e.getPosition();return l.lng=Math.trunc(1e4*l.lng)/1e4,l.lat=Math.trunc(1e4*l.lat)/1e4,e.snkBar.open("Ubicaci\xf3n ingresada.","Ok",{duration:3e3}),l})()}updateLocalList(e){!this.selectedPoll.values||!e||(e._btnEvent_="",e._propName_="",this.selectedPoll.values=this.dg.updatePropResult(this.selectedPoll.values,e),this.dtb.addUpdateLocalList(this.sharedvar.pollExecSelected,this.sharedvar.selPollResult))}updateValues2Save(e,o){o._btnEvent_="",o._propName_="",this.dg.updatePropResult(e,o)}onBack(){var e=this;this.selectedPoll.values&&!1===this.selectedPoll.values._valid_?this.snkBar.open("Hay campos sin llenar. \xbfSalir de todos modos?","Si",{duration:3e3}).onAction().subscribe((0,d.Z)(function*(){e.onBackProcess()})):this.onBackProcess()}onBackProcess(){if(this.goto.length>1){const e=this.sharedvar.pollExecSelected.pollList.find(o=>o.id===this.goto[this.goto.length-2]);e&&(this.selectedPoll=e,this.goto.splice(this.goto.length-1,1))}}onDelete(){var e=this;this.snkBar.open("\xbfBorrar \xe9ste grupo?","Ok",{duration:3e3}).onAction().subscribe((0,d.Z)(function*(){if(e.goto.length>1){const o=e.sharedvar.pollExecSelected.pollList.find(s=>s.id===e.goto[e.goto.length-2]),l=e.sharedvar.pollExecSelected.pollList.findIndex(s=>s.id===e.goto[e.goto.length-1]);l>=0&&e.sharedvar.pollExecSelected.pollList.splice(l,1),o&&(e.selectedPoll=o,e.goto.splice(e.goto.length-1,1))}}))}onEndPoll(){var e=this;return(0,d.Z)(function*(){const o=e.isValid();""===o?e.selectedPoll.allowEnd&&e.snkBar.open("\xbfFinalizar?","Ok",{duration:5e3}).onAction().subscribe((0,d.Z)(function*(){e.sharedvar.selPollResult=e.onResultDone(e.sharedvar.selPollResult),e.sharedvar.selPollResult?(e.sharedvar.selPollResult.ended=!0,e.sharedvar.selPollResult.status=3,e.sharedvar.selPollResult.status_date=Date.now(),(yield function N(a){return T.apply(this,arguments)}())?"tasky-danilo-prod.up.railway.app/tasker"===window.location.hostname||"localhost"===window.location.hostname?yield e.exportResultDataDevelop():yield e.exportResultData():(e.snkBar.open("No fue posible exportar la informaci\xf3n. Por favor sincronice cuando est\xe9 linea.","Ok",{duration:3e3}),e.sharedvar.pollExecSelected.done=!0,e.dtb.addUpdateLocalList(e.sharedvar.pollExecSelected,e.sharedvar.selPollResult)),e.nvg.onRouteBack()):e.snkBar.open("Existen campos sin llenar.","Ok",{duration:3e3})})):e.snkBar.open(`Debe llenar campos requeridos en "${o}".`,"Ok",{duration:3e3})})()}isValid(){let e="",o=!0,l=[];for(const s of this.visitePollList){l=s.split(":");const n=this.sharedvar.pollExecSelected.pollList.find(i=>i.id===l[1]);if(n&&(o=n.values._valid_&&o,!o)){e=n.title;break}}return""!==e&&this.visiteByAvailTitle(l.join(":")),e}exportResultData(e=0,o=0){var l=this;return(0,d.Z)(function*(){l.dtb.promiseMetaData(l.sharedvar.pollExecSelected,l.sharedvar.selPollResult).then(function(){var s=(0,d.Z)(function*(n){n&&(l.sharedvar.selPollResult.values={},l.sharedvar.selPollResult.values_type={},l.sharedvar.pollExecSelected.pollList.forEach(i=>{l.updatePollPropResult(l.sharedvar.selPollResult.values,l.sharedvar.selPollResult.values_type,i)}),yield l.OnEndPoll(),l.sharedvar.selPollResult.metaValues=[],e>0&&o>0&&(l.sharedvar.selPollResult.date_ini=e,l.sharedvar.selPollResult.date_end=o),l.sharedvar.selPollResult=yield l.dtb.CreateUpdatePollResult(l.sharedvar.selPollResult),yield l.dtb.updateStaffAsync(l.sharedvar.staff),console.log(l.sharedvar.selPollResult),l.sharedvar.pollExecSelected&&l.sharedvar.pollExecSelected.onEnd?.sendMail2&&l.sharedvar.pollExecSelected.onEnd.sendMail2.length>0&&l.htm2pdf.buildHtml2Pdf(l.sharedvar.selPollResult,l.sharedvar.pollExecSelected.onEnd.sendMail2),l.dtb.delFromLocalList(l.sharedvar.pollExecSelected),l.snkBar.open('Encuesta finalizada. Siga el reporte de sus encuestas en "Estado de mi Cuenta".',"Ok",{duration:5e3}))});return function(n){return s.apply(this,arguments)}}())})()}exportResultDataDevelop(){var e=this;return(0,d.Z)(function*(){const o=new Date;o.setHours(o.getHours(),o.getMinutes(),0,0),e.dg.aDefault({title:"Horario acomodado",schema:{controls:[{name:"date_ini",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}},{name:"date_end",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}}]},value:{date_ini:o,date_end:o},dgwidth:400,dgheigth:360}).subscribe(i=>{i&&e.exportResultData(i.date_ini,i.date_end)})})()}updatePollPropResult(e,o,l){return l.schema.controls?.forEach(s=>{if(l.values._btnEvent_="",l.values._propName_="",l.values._valid_="",l.values._btnclick_="",s.tags&&!0===s.tags.dtbase&&l.values[s.name]&&l.values[s.name].toString().length>0){let n=s.tags.type;switch(s.tags.type){case"draw":n="picture";break;case"product":case"multiselect":n="array";break;case"textarea":case"costumer":case"duplicate":case"goto":case"header":n="text"}e[s.name]=l.values[s.name],o[s.name]=n}}),e}geoloc(){var e=this;return(0,d.Z)(function*(){yield e.getPosition().then(l=>{l.lng=Math.trunc(100*l.lng)/100,l.lat=Math.trunc(100*l.lat)/100})})()}getPosition(){return new Promise((e,o)=>{navigator.geolocation.getCurrentPosition(l=>{e({lng:l.coords.longitude,lat:l.coords.latitude})},l=>{o(l)})})}getPicture(e,o,l){this.dg.aCamera({title:"C\xe1mara",value:{img:e,name:"pepito"}}).subscribe(i=>{i&&i.urlrute&&i.urlrute.length>0&&(e[l]=`${o.label} \u2714\ufe0f`,this.sharedvar.selPollResult.metaValues[l]=i.urlrute,this.updateLocalList(e),this.reset++)})}getDraw(e,o,l){this.dg.aDraw({title:"Dibujar",value:{img:this.sharedvar.selPollResult.metaValues[l]?this.sharedvar.selPollResult.metaValues[l]:o.avalue,name:"pepito"}}).subscribe(i=>{i&&i.urlrute&&i.urlrute.length>0&&(e[l]=`${o.label} \u2714\ufe0f`,this.sharedvar.selPollResult.metaValues[l]=i.urlrute,this.updateLocalList(e),this.reset++)})}getAppoint(e,o,l="appoint"){var s=this;return(0,d.Z)(function*(){let n="No seleccionado",i={name:"contact",label:"Contacto",type:"text",style:"w-full",validators:{}};const h={};if(s.sharedvar.selPollResult.crm_costum_id){const r=yield s.dtb.getCMRCostumAsync(s.sharedvar.selPollResult.crm_costum_id);n=r&&r.name?r.name:n;const b=[];r?.linkup_1&&(h[r.linkup_1]={email:r.email_1||"none",phone:r.phone_1||"none"},b.push({key:r.linkup_1,value:r.linkup_1})),r?.linkup_2&&(h[r.linkup_2]={email:r.email_2||"one",phone:r.phone_2||"nonde"},b.push({key:r?.linkup_2,value:r?.linkup_2})),i.type="select",i.selectOptions=b}const _=new Date;_.setSeconds(0),s.dg.aDefault({title:"Appoint"===l?"Agenda":"Nota",schema:{controls:[{name:"datetime",label:"Fecha y hora:",type:"datetime-local",default:_,disabled:"note"===l,validators:{required:!0}},{name:"costumer",label:"Cliente",type:"text",default:n,validators:{required:!0}},i,{name:"task",label:"Actividad/Compromiso:",type:"textarea",totalRows:4,style:"w-full",validators:{required:!0}}]},value:s.sharedvar.selPollResult.metaValues[o],dgwidth:400,dgheigth:615}).subscribe(r=>{if(r&&r.datetime){const b=h[r.contact]&&h[r.contact].phone?h[r.contact].phone:"phone",A=h[r.contact]&&h[r.contact].email?h[r.contact].email:"email",de=`${s.sharedvar.formatNumber2DateTime(r.datetime,"/")} - ${r.task||""}`;if(r.appoint_type=l,r.phone=b,r.email=A,r.pollresult_id=s.sharedvar.selPollResult._id,"appoint"!==l)return r;e[o]=de,s.sharedvar.selPollResult.metaValues[o]=r,s.updateLocalList(e),s.reset++}})})()}getCostumer(e,o){const l=this.sharedvar.pollExecSelected.costumerList;l&&l.length>0&&this.onSelCtrlList(l,"Seleccione Cliente",e,o,"costumer",!1)}getProduct(e,o){const l=this.sharedvar.pollExecSelected.productList;l&&l.length>0&&this.onSelCtrlList(l,"Seleccione Producto",e,o,"product",!0)}onSelCtrlList(e,o,l,s,n,i){var h=this;return(0,d.Z)(function*(){const _=[];e.forEach(m=>{if(m){const x=m.split(":"),r=h.sharedvar.selPollResult.crm_prod_id?.findIndex(A=>A===x[0]);_.push({selected:!!(r&&r>=0),myid:x[0],name:x[1]})}});const F={title:o,viewfilter:!0,viewAdd:!1,multiSelect:i,valuelst:_};return yield h.ds.aSelectDefault(F).subscribe(m=>{m&&("product"===n?(h.sharedvar.selPollResult.crm_prod_id=[],l[s]="",m.forEach(x=>{l[s]+=x.name+",\n"})):(h.sharedvar.selPollResult.crm_costum_id=m[0].myid,h.sharedvar.selPollResult.crm_costum_name=m[0].name,l[s]=m[0].name),h.updateLocalList(l),h.reset++)})})()}onResultDone(e){let o={...e};return this.sharedvar.pollExecSelected.pollList.forEach(l=>{o.values={...o.values,...l.values}}),o.values&&(o.values._btnEvent_="",o.values._valid_=!0),o}findDupPollList(e,o){const l=e.schema.controls?.find(i=>i.name==o);if(!l)return;const s=l.tags||{},n=this.sharedvar.pollExecSelected.pollList.find(i=>i.id===s.dupactivity);if(n){const i=JSON.parse(JSON.stringify(n));return i.title=`${n.title} ${n.dupTotal}`,n.dupTotal++,i.totalDup=0,i.id=this.dtb.getSerialKey(3,4,"_"),i.duplicated=!0,this.updatePollNames(i),l.selectOptions?.push({key:i.id,value:i.title}),this.sharedvar.pollExecSelected.pollList.push(i),this.dtb.addUpdateLocalList(this.sharedvar.pollExecSelected,this.sharedvar.selPollResult),this.reset++,i.id}}updatePollNames(e){e.schema.controls?.forEach(o=>{o.name=this.getUniqueName(o.name,this.sharedvar.pollExecSelected.pollList)})}getUniqueName(e,o){let l=0;for(let s=0;s<o.length;s++){const n=o[s].schema.controls||[];for(let i=0;i<n.length;i++)if(n[i].name===`${e}_${l}`){l++,s=-1;break}}return`${e}_${l}`}static#e=this.\u0275fac=function(o){return new(o||a)(t.Y36(U.k),t.Y36(M.ux),t.Y36(B.x),t.Y36(Q),t.Y36(z.$),t.Y36(K.D),t.Y36(j.$),t.Y36(W.Q))};static#t=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-poll"]],decls:18,vars:12,consts:[[1,"flex","flex-col","max-h-screen"],[3,"buttons","lchat","onClicked"],[1,"flex","align-middle","justify-center","h-8","border-b","border-violet-500","font-medium","text-lg","p-1","mb-1","text-violet-900"],[3,"matMenuTriggerFor"],[1,"grow","pt-3","mx-1","overflow-y-auto","overflow-x-hidden"],[3,"reset","jsonFormData","values","result","valid"],[1,"h-12","flex","flex-row","items-center","justify-center","border-t","border-violet-500"],["color","primary","mat-raised-button","",3,"click",4,"ngIf"],["color","warn","mat-raised-button","",3,"click",4,"ngIf"],["visitedmenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["color","primary","mat-raised-button","",3,"click"],["color","warn","mat-raised-button","",3,"click"],["mat-menu-item","",3,"click"]],template:function(o,l){if(1&o&&(t.TgZ(0,"div",0)(1,"app-header",1),t.NdJ("onClicked",function(n){return l.getClicked(n)}),t.qZA(),t.TgZ(2,"div",2)(3,"span",3),t._uU(4),t.qZA(),t.TgZ(5,"mat-icon",3),t._uU(6,"arrow_drop_down"),t.qZA()(),t.TgZ(7,"div",4)(8,"app-dynamic-form",5),t.NdJ("result",function(n){return l.onGetData(n)})("valid",function(n){return l.onGetValid(n)}),t.qZA()(),t.TgZ(9,"div",6),t.YNc(10,te,3,0,"button",7),t._uU(11," \xa0 "),t.YNc(12,le,4,0,"button",7),t._uU(13," \xa0 "),t.YNc(14,oe,3,0,"button",8),t.qZA()(),t.TgZ(15,"mat-menu",null,9),t.YNc(17,se,2,1,"button",10),t.qZA()),2&o){const s=t.MAs(16);t.xp6(1),t.Q6J("buttons","0000110")("lchat",l.lchat),t.xp6(2),t.Q6J("matMenuTriggerFor",s),t.xp6(1),t.Oqu(l.selectedPoll.title),t.xp6(1),t.Q6J("matMenuTriggerFor",s),t.xp6(3),t.Q6J("reset",l.reset)("jsonFormData",l.selectedPoll.schema)("values",l.selectedPoll.values),t.xp6(2),t.Q6J("ngIf",l.goto.length>1),t.xp6(2),t.Q6J("ngIf",l.selectedPoll.allowEnd),t.xp6(2),t.Q6J("ngIf",l.selectedPoll.duplicated),t.xp6(3),t.Q6J("ngForOf",l.visitePollList)}},dependencies:[p.sg,p.O5,X.G,ee.r,g.VK,g.OP,g.p6,L.lW,$.Hw]})}return a})()}];let ne=(()=>{class a{static#e=this.\u0275fac=function(o){return new(o||a)};static#t=this.\u0275mod=t.oAB({type:a});static#l=this.\u0275inj=t.cJS({imports:[u.Bz.forChild(ae),u.Bz]})}return a})();var ie=c(8471),re=c(6842);let ce=(()=>{class a{static#e=this.\u0275fac=function(o){return new(o||a)};static#t=this.\u0275mod=t.oAB({type:a});static#l=this.\u0275inj=t.cJS({imports:[p.ez,ne,ie.O,re.N,g.Tx,L.ot,$.Ps,M.ZX]})}return a})()},4066:S=>{const P="[a-fA-F\\d:]",c=v=>v&&v.includeBoundaries?`(?:(?<=\\s|^)(?=${P})|(?<=${P})(?=\\s|$))`:"",p="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",u="[a-fA-F\\d]{1,4}",d=`\n(?:\n(?:${u}:){7}(?:${u}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${u}:){6}(?:${p}|:${u}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${u}:){5}(?::${p}|(?::${u}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${u}:){4}(?:(?::${u}){0,1}:${p}|(?::${u}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${u}:){3}(?:(?::${u}){0,2}:${p}|(?::${u}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${u}:){2}(?:(?::${u}){0,3}:${p}|(?::${u}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${u}:){1}(?:(?::${u}){0,4}:${p}|(?::${u}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${u}){0,5}:${p}|(?::${u}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),w=new RegExp(`(?:^${p}$)|(?:^${d}$)`),y=new RegExp(`^${p}$`),E=new RegExp(`^${d}$`),k=v=>v&&v.exact?w:new RegExp(`(?:${c(v)}${p}${c(v)})|(?:${c(v)}${d}${c(v)})`,"g");k.v4=v=>v&&v.exact?y:new RegExp(`${c(v)}${p}${c(v)}`,"g"),k.v6=v=>v&&v.exact?E:new RegExp(`${c(v)}${d}${c(v)}`,"g"),S.exports=k},6599:(S,P,c)=>{const p=c(4066),u=d=>p({exact:!0}).test(d);u.v4=d=>p.v4({exact:!0}).test(d),u.v6=d=>p.v6({exact:!0}).test(d),u.version=d=>u(d)?u.v4(d)?4:6:void 0,S.exports=u}}]);