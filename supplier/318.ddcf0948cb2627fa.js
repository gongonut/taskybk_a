"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[318],{4223:(q,v,o)=>{o.r(v),o.d(v,{ActivityReportModule:()=>z});var u=o(7087),p=o(3759),g=o(3241),t=o(2283),_=o(4758),A=o(6806),Z=o(6510),C=o(1682),F=o(3620),k=o(3578),b=o(9347),x=o(8464);function D(i,m){if(1&i&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&i){const e=m.$implicit;t.xp6(1),t.Oqu(e)}}function M(i,m){if(1&i&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&i){const e=m.$implicit,a=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.Oqu(n.getCols(e,a))}}function w(i,m){if(1&i&&(t.TgZ(0,"tr"),t.YNc(1,M,2,1,"td",2),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.headerTitle)}}let T=(()=>{class i{constructor(e){this.sharedvar=e,this.data=[],this.headerTitle=[]}ngOnChanges(e){this.buildTable()}buildTable(){this.headerTitle=[];for(let e of this.header.keys())this.headerTitle.push(e)}getCols(e,a){switch(this.header.get(e)){case"datetime-local":return this.sharedvar.formatNumber2DateTime(a[e],"/");case"date":return this.sharedvar.formatNumber2Date(a[e],"/")}return a[e]}static#t=this.\u0275fac=function(a){return new(a||i)(t.Y36(_.D))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-table"]],inputs:{data:"data",header:"header"},features:[t.TTD],decls:6,vars:2,consts:[[1,"block","h-72","w-96","table-auto","border-separate"],[1,"px-6","py-2","text-sm","border-b","border-gray-500","text-gray-500","sticky","top-0","bg-white"],[4,"ngFor","ngForOf"],[1,"text-xs"]],template:function(a,n){1&a&&(t.TgZ(0,"table",0)(1,"thead",1)(2,"tr"),t.YNc(3,D,2,1,"th",2),t.qZA()(),t.TgZ(4,"tbody",3),t.YNc(5,w,2,1,"tr",2),t.qZA()()),2&a&&(t.xp6(3),t.Q6J("ngForOf",n.headerTitle),t.xp6(2),t.Q6J("ngForOf",n.data))},dependencies:[u.sg]})}return i})();const B=["editControlTrigger"];function E(i,m){1&i&&(t.TgZ(0,"mat-icon"),t._uU(1,"Porcentajes"),t.qZA())}const L=[{path:"",component:(()=>{class i{constructor(e,a,n,s,r){this.sharedvar=e,this.dtb=a,this.dg=n,this.data2excel=s,this.ds=r,this.header=new Map,this.yAxis="_id",this.xAxis="_id",this.eList=[],this.chunk="D"}ngOnInit(){var e=this;return(0,g.Z)(function*(){const a=new Date,n=a.setHours(0,0,0,0),s=a.setHours(23,59,59,999);e.localFilter={crm:"F",staff__id:[],pollGrpData:[],costumers:[],products:[],products_name_sel:[],date_ini:n,date_end:s}})()}getTitleText(){return"header titulo"}getClicked(e){switch(e.index){case 1:this.filterDialog();break;case 3:let a=document.getElementById("spanTrigger");a&&(a.style.display="",a.style.position="absolute",a.style.left=e.pageX+5+"px",a.style.top=e.pageY+5+"px",this.editControlTrigger.openMenu())}}filterDialog(){var e=this;return(0,g.Z)(function*(){e.sharedvar.wait=!0;let a=[],n=[];(yield e.dtb.getStaffByFilterAsync({queryType:3,active:!0,stars:0,rol:"K"})).forEach(c=>{a.push({key:c._id,value:`${c.names||c.email} ${c.lastnames||""}`})}),(yield e.dtb.getPollGrpActiveAsync()).forEach(c=>{"index"!==c.id&&n.push({key:c._id,value:c.name})}),e.dg.aDefault({schema:{controls:[{name:"pollGrpData",label:"Modelo:",type:"select",style:"w-full",validators:{required:!0},selectOptions:n},{name:"staff__id",label:"Taskers:",type:"multiselect",style:"w-full",placeholder:"Asignados a \xe9sta modelo",validators:{},selectOptions:a},{name:"date_ini",label:"Fecha inicio:",type:"date",validators:{}},{name:"date_end",label:"Fecha final:",type:"date",validators:{}}]},title:"Filtros",dgheigth:500,dgwidth:550,value:e.localFilter}).subscribe(function(){var c=(0,g.Z)(function*(l){if(e.sharedvar.wait=!1,l){if(l.alldates)l.date_ini=0,l.date_end=0;else{let f=new Date(l.date_ini);l.date_ini=f.setHours(0,0,0,0),f=new Date(l.date_end),f.setHours(23,59,59,999)}e.localFilter={crm:"F",staff__id:l.staff__id,pollGrpData:l.pollGrpData,costumers:l.costumers,products:l.products,date_ini:l.date_ini,date_end:l.date_end,products_name_sel:[]},yield e.dtb.getPollGrpAnaliticAsync(e.localFilter).then(f=>{e.dataList=f.data,e.header=new Map(Object.entries(f.header))})}});return function(l){return c.apply(this,arguments)}}())})()}getXYAxis(e){var a=this;if(0===this.header.size)return;const n=[];for(let r of this.header.keys())"E"===e&&"array"===this.header.get(r)||n.push({selected:!1,myid:r,name:r});"EL".includes(e)&&n.forEach(r=>{r.selected=this.eList.findIndex(d=>r.name===d)>=0}),this.ds.aSelectDefault({title:`Seleccione campos del eje ${e} de la gr\xe1fica`,dgheigth:450,viewfilter:!0,viewAdd:!1,multiSelect:"E"===e||"L"===e,valuelst:n}).subscribe(function(){var r=(0,g.Z)(function*(d){if(d)switch(e){case"L":case"E":a.eList=[],d.forEach(h=>{h&&h.name&&a.eList.push(h.name)}),"L"===e&&a.onExportexcel();break;case"X":a.xAxis=d[0].name||"_id";break;case"Y":a.yAxis=d[0].name||"_id"}});return function(d){return r.apply(this,arguments)}}())}setChunk(){}onExportexcel(){const e=`Reporte Actividad fechas ${this.sharedvar.formatNumber2Date(this.localFilter.date_ini||0,"-")} - \n    ${this.sharedvar.formatNumber2Date(this.localFilter.date_end||0,"-")}`,a={};this.eList.forEach(n=>{a[n]=this.header.get(n)}),this.data2excel.excelExport(this.dataList,e,"Actividad",a,Array.from(this.header.keys()))}static#t=this.\u0275fac=function(a){return new(a||i)(t.Y36(_.D),t.Y36(A.k),t.Y36(Z.x),t.Y36(C.Z),t.Y36(F.n))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-activity-report"]],viewQuery:function(a,n){if(1&a&&t.Gf(B,5),2&a){let s;t.iGM(s=t.CRH())&&(n.editControlTrigger=s.first)}},decls:38,vars:8,consts:[[1,"flex","flex-col","max-h-screen"],[3,"buttons","nav_menu","bar_text","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"flex-1","m-2","bg-gray-100","overflow-scroll"],[1,"border","border-gray-200","rounded-sm","shadow-lg"],[1,"h-96",3,"data","header"],["controlEdit","matMenu"],["mat-menu-item","",3,"click"],["color","primary"],[4,"ngIf"],[1,"mt-1","text-violet-500","text-lg","font-medium"],["mat-menu-item",""],[1,"ml-1","mt-1","text-violet-500","text-lg","font-medium"],[1,"ml-3"]],template:function(a,n){if(1&a&&(t.TgZ(0,"div",0)(1,"app-header",1),t.NdJ("onClicked",function(r){return n.getClicked(r)}),t.qZA(),t._UZ(2,"span",2,3),t.TgZ(4,"div",4)(5,"div",5),t._UZ(6,"app-table",6),t.qZA()()(),t.TgZ(7,"mat-menu",null,7)(9,"button",8),t.NdJ("click",function(){return n.getXYAxis("X")}),t.TgZ(10,"mat-icon",9),t._uU(11,"trending_up"),t.qZA(),t._uU(12),t.qZA(),t.TgZ(13,"button",8),t.NdJ("click",function(){return n.getXYAxis("E")}),t.TgZ(14,"mat-icon",9),t._uU(15,"trending_up"),t.qZA(),t._uU(16," Elementos de la gr\xe1fica "),t.qZA(),t.TgZ(17,"button",8),t.NdJ("click",function(){return n.setChunk()}),t.YNc(18,E,2,0,"mat-icon",10),t._uU(19," trozos del eje X "),t.qZA(),t._UZ(20,"hr"),t.TgZ(21,"h2",11)(22,"mat-icon"),t._uU(23,"trending_up"),t.qZA(),t._uU(24,"\xa0Inteligencia Artificial "),t.qZA(),t.TgZ(25,"div")(26,"button",12),t._uU(27," An\xe1lisis con soporte de IA "),t.qZA()(),t._UZ(28,"hr"),t.TgZ(29,"h2",13)(30,"mat-icon"),t._uU(31,"file_download"),t.qZA(),t._uU(32,"\xa0Exportar"),t.qZA(),t.TgZ(33,"div",14)(34,"button",8),t.NdJ("click",function(){return n.getXYAxis("L")}),t._uU(35," Exportar Informe a Excel. "),t.qZA(),t.TgZ(36,"button",12),t._uU(37," Enviar Informe a Google Spread Sheet "),t.qZA()()()),2&a){const s=t.MAs(8);t.xp6(1),t.Q6J("buttons","11010")("nav_menu",!1)("bar_text",n.getTitleText()),t.xp6(1),t.Q6J("matMenuTriggerFor",s),t.xp6(4),t.Q6J("data",n.dataList)("header",n.header),t.xp6(6),t.hij(" Categor\xedas: ",n.xAxis," "),t.xp6(6),t.Q6J("ngIf","D"===n.chunk)}},dependencies:[u.O5,k.G,b.VK,b.OP,b.p6,x.Hw,T]})}return i})()}];let O=(()=>{class i{static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275mod=t.oAB({type:i});static#a=this.\u0275inj=t.cJS({imports:[p.Bz.forChild(L),p.Bz]})}return i})();var J=o(769),U=o(1359),y=o(3279);const R=["chart"];function G(i,m){if(1&i&&(t.TgZ(0,"div",1),t._UZ(1,"apx-chart",2),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("series",e.chartOptions.series)("chart",e.chartOptions.chart)("xaxis",e.chartOptions.xaxis)("fill",e.chartOptions.fill)("dataLabels",e.chartOptions.dataLabels)("title",e.chartOptions.title)("yaxis",e.chartOptions.yaxis)}}const Y=[{path:"",component:(()=>{class i{constructor(){this.data=[],this.prod_list=[],this.pivot=0,this.bartype=0,this.chunk="M",this.onSelect=new t.vpe,this.chartOptions={series:[{name:"Bubble1",data:this.generateData(new Date("11 Feb 2017 GMT").getTime(),20,{min:10,max:60})},{name:"Bubble2",data:this.generateData(new Date("11 Feb 2017 GMT").getTime(),20,{min:10,max:60})},{name:"Bubble3",data:this.generateData(new Date("11 Feb 2017 GMT").getTime(),20,{min:10,max:60})},{name:"Bubble4",data:this.generateData(new Date("11 Feb 2017 GMT").getTime(),20,{min:10,max:60})}],chart:{height:350,type:"bubble"},dataLabels:{enabled:!1},fill:{opacity:.8},title:{text:"Simple Bubble Chart"},xaxis:{tickAmount:12,type:"category"},yaxis:{max:70}}}generateData(e,a,n){for(var s=0,r=[];s<a;){var d=Math.floor(750*Math.random())+1,h=Math.floor(Math.random()*(n.max-n.min+1))+n.min,c=Math.floor(61*Math.random())+15;r.push([d,h,c]),s++}return r}static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-bubble"]],viewQuery:function(a,n){if(1&a&&t.Gf(R,5),2&a){let s;t.iGM(s=t.CRH())&&(n.chart=s.first)}},inputs:{data:"data",prod_list:"prod_list",pivot:"pivot",bartype:"bartype",chunk:"chunk"},outputs:{onSelect:"onSelect"},decls:1,vars:1,consts:[["id","chart",4,"ngIf"],["id","chart"],[3,"series","chart","xaxis","fill","dataLabels","title","yaxis"]],template:function(a,n){1&a&&t.YNc(0,G,2,7,"div",0),2&a&&t.Q6J("ngIf",n.data&&n.data.length>0)},dependencies:[u.O5,y.x]})}return i})()}];let S=(()=>{class i{static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275mod=t.oAB({type:i});static#a=this.\u0275inj=t.cJS({imports:[p.Bz.forChild(Y),p.Bz]})}return i})(),N=(()=>{class i{static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275mod=t.oAB({type:i});static#a=this.\u0275inj=t.cJS({imports:[u.ez,S,y.X]})}return i})();const X=[{path:"",component:T}];let Q=(()=>{class i{static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275mod=t.oAB({type:i});static#a=this.\u0275inj=t.cJS({imports:[p.Bz.forChild(X),p.Bz]})}return i})(),j=(()=>{class i{static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275mod=t.oAB({type:i});static#a=this.\u0275inj=t.cJS({imports:[u.ez,Q]})}return i})(),z=(()=>{class i{static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275mod=t.oAB({type:i});static#a=this.\u0275inj=t.cJS({imports:[u.ez,O,J.O,U.ZX,y.X,b.Tx,x.Ps,N,j]})}return i})()}}]);