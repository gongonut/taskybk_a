"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[817],{5817:($,f,a)=>{a.r(f),a.d(f,{ProductModule:()=>V});var g=a(4070),v=a(8137),Z=a(7774),x=a(4370),_=a(4156),C=a(781),u=a(3241),t=a(6339),b=a(6789),E=a(3016),T=a(1618),k=a(626),w=a(1781),P=a(3792),A=a(7254),R=a(5888),L=a(5180),U=a(9869),I=a(1030),h=a(4620);const F=["editControlTrigger"],M=["excelUpload"],N=["imagesUpload"];function S(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"mat-chip-option",33),t.NdJ("removed",function(){const n=t.CHM(e).index,r=t.oxw(3);return t.KtG(r.removeCateg(n))})("click",function(){const n=t.CHM(e).$implicit,r=t.oxw(3);return t.KtG(r.editSelectCateg(n))}),t._uU(1),t.TgZ(2,"button",34)(3,"mat-icon"),t._uU(4,"cancel"),t.qZA()()()}if(2&s){const e=l.$implicit;t.xp6(1),t.hij(" ",e.value," ")}}function J(s,l){if(1&s&&(t.TgZ(0,"div",43),t._uU(1),t.qZA()),2&s){const e=l.$implicit;t.xp6(1),t.hij(" ",e.title," ")}}function O(s,l){if(1&s&&(t.TgZ(0,"div",43),t._uU(1),t.qZA()),2&s){const e=l.$implicit;t.xp6(1),t.hij(" ",e.title," ")}}function G(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"div",40)(2,"app-dynamic-form",41),t.NdJ("result",function(o){t.CHM(e);const n=t.oxw().index,r=t.oxw(4);return t.KtG(r.onGetProdEditCharData(o,n))}),t.qZA(),t.TgZ(3,"div",7),t._uU(4,"Sub productos"),t.qZA(),t.YNc(5,J,2,1,"div",42),t.TgZ(6,"div",7),t._uU(7,"Carrusel de Im\xe1genes"),t.qZA(),t.YNc(8,O,2,1,"div",42),t.qZA()()}if(2&s){const e=t.oxw().$implicit,i=t.oxw(4);t.xp6(2),t.Q6J("jsonFormData",i.prodEditCharDataSchema)("values",i.prodEditCharData)("reset",i.prodDataReset),t.xp6(3),t.Q6J("ngForOf",e.data),t.xp6(3),t.Q6J("ngForOf",e.data)}}function q(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"div",37)(2,"div",38),t.NdJ("click",function(){const n=t.CHM(e).index,r=t.oxw(4);return t.KtG(r.expandElements(n))}),t._uU(3),t.qZA(),t.TgZ(4,"mat-icon",21),t.NdJ("click",function(){const n=t.CHM(e).index,r=t.oxw(4);return t.KtG(r.restartElements(n))}),t._uU(5,"restart_alt"),t.qZA(),t.TgZ(6,"mat-icon",21),t.NdJ("click",function(){const n=t.CHM(e).index,r=t.oxw(4);return t.KtG(r.expandElements(n))}),t._uU(7,"expand_more"),t.qZA()(),t.YNc(8,G,9,5,"div",39),t.qZA()}if(2&s){const e=l.$implicit,i=l.index,o=t.oxw(4);t.xp6(3),t.Oqu(e.header),t.xp6(5),t.Q6J("ngIf",o.getElementVisible(i))}}function D(s,l){if(1&s&&(t.TgZ(0,"div",35),t.YNc(1,q,9,2,"div",36),t.qZA()),2&s){const e=t.oxw(3);t.xp6(1),t.Q6J("ngForOf",e.category2show.characterList)}}function j(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",25)(1,"div",26)(2,"div"),t._uU(3,"Detalles del art\xedculo"),t.qZA(),t._UZ(4,"div",27),t.qZA(),t.TgZ(5,"div",28)(6,"div",29)(7,"mat-chip-listbox"),t.YNc(8,S,5,1,"mat-chip-option",30),t.qZA()(),t.TgZ(9,"div")(10,"button",31),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.getCategList())}),t.TgZ(11,"mat-icon",8),t._uU(12,"list"),t.qZA()()()(),t.YNc(13,D,2,1,"div",32),t.qZA()}if(2&s){const e=t.oxw(2);t.xp6(8),t.Q6J("ngForOf",e.prodResult.categIds),t.xp6(5),t.Q6J("ngIf",e.category2show)}}function H(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",17)(1,"div",18),t._UZ(2,"img",19),t.TgZ(3,"div",20)(4,"div",21),t.NdJ("click",function(){const n=t.CHM(e).index,r=t.oxw();return t.KtG(r.SetExpand(n,"prodeta"))}),t._uU(5),t.qZA(),t.TgZ(6,"div",22)(7,"mat-icon",23),t.NdJ("click",function(){const n=t.CHM(e).index,r=t.oxw();return t.KtG(r.SetExpand(n,"prodeta"))}),t._uU(8,"edit"),t.qZA(),t.TgZ(9,"mat-icon",21),t.NdJ("click",function(){const n=t.CHM(e).index,r=t.oxw();return t.KtG(r.SetExpand(n,"options"))}),t._uU(10,"list"),t.qZA(),t._uU(11," \xa0 "),t.TgZ(12,"mat-icon",21),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.ask2Save())}),t._uU(13,"done"),t.qZA()()()(),t.YNc(14,j,14,2,"div",24),t.qZA()}if(2&s){const e=l.$implicit,i=l.index,o=t.oxw();t.xp6(2),t.Q6J("src",o.getPicture(e),t.LSH),t.xp6(3),t.Oqu(e.description),t.xp6(9),t.Q6J("ngIf",o.getExpand(i,"prodeta"))}}const Y=[{path:"",component:(()=>{class s{constructor(e,i,o,n,r,c,d,p,m){this.sharedvar=e,this.dtb=i,this.sanitizer=o,this.imageCompress=n,this.ds=r,this.dg=c,this.snkBar=d,this.data2excel=p,this.prodserv=m,this.prodEditCharDataSchema={controls:[]},this.categ2Prod={controls:[{name:"title",label:"T\xedtulo del elemento:",type:"text",style:"w-full",validators:{required:!0}},{name:"stock",label:"Existencia:",type:"number",default:0,validators:{required:!0}},{name:"price",label:"Precio:",type:"number",default:0,validators:{required:!0}},{name:"tax_p",label:"Porcentaje de impuesto:",type:"number",default:0,validators:{required:!0}}]},this.pictList=[],this.show_Product=-1,this.show_area="",this.prodReset=0,this.show_prodOption=-1,this.prodList=[],this.subFilter=[],this.elementView=-1,this.prodEditCharData={},this.prodDataReset=0}ngOnInit(){var e=this;return(0,u.Z)(function*(){e.prodList=yield e.prodserv.getAllCRMProdAsync("parent"),e.subFilter=yield e.prodserv.subquerylist()})()}getClicked(e){switch(e.index){case 2:case 4:let i=document.getElementById("spanTrigger");i&&(i.style.display="",i.style.position="absolute",i.style.left=e.pageX+5+"px",i.style.top=e.pageY+5+"px",this.editControlTrigger.openMenu())}}getCategList(){var e=this;return(0,u.Z)(function*(){let o={value:yield e.prodserv.getAllShortCategAsync(),title:"Seleccione Categor\xeda",dgwidth:400,dgheigth:600};const r=(yield e.dg.aNestedSelect(o)).data;if(r&&r.length>0){let c=[];r.forEach(p=>c.push(p.key)),(yield e.prodserv.getCategListAsync(c.join(","))).forEach(p=>{e.prodResult.optList||(e.prodResult.optList=[]),p.characterList.forEach(m=>{-1===e.prodResult.optList.findIndex(K=>K.catid==p._id)&&(e.prodResult.optList=[...e.prodResult.optList,...e.setElem(m)])})}),e.prodResult.categIds=[...e.prodResult.categIds,...r],e.prodResult.categIds=e.avoidGRDdup(e.prodResult.categIds),yield e.prodserv.updateProd(e.prodResult)}})()}avoidGRDdup(e){return e.filter((i,o)=>{const n=i.key;return o===e.findIndex(r=>r.key===n)})}setElem(e){const i=[];return e.data.forEach(o=>{i.push({catid:e.cat_id,optid:o.id,opt_name:o.name,source:o.type})}),i}updaSetElem(e,i=[]){return e.data.forEach(o=>{const n=i.findIndex(c=>c.optid===o.id),r={catid:e.cat_id,optid:o.id,opt_name:o.name,source:o.type,selectlist:o.selectlist||[]};n>=0?i[n]=r:i.push(r)}),i}removeCateg(e){var i=this;return(0,u.Z)(function*(){i.snkBar.open(`\xbfEliminar ${i.prodResult.categIds[e].value}?`,"Ok",{duration:5e3}).onAction().subscribe(function(){var o=(0,u.Z)(function*(n){const r=i.prodResult.categIds&&i.prodResult.categIds[e].key?i.prodResult.categIds[e].key:"";if(r.length>0&&i.prodResult.optList){let c=0;for(;c<i.prodResult.optList.length;){const d=i.prodResult.optList[c];d.catid&&d.catid!==r?c++:i.prodResult.optList.splice(c,1)}}i.prodResult.categIds?.splice(e,1),yield i.prodserv.updateProd(i.prodResult)});return function(n){return o.apply(this,arguments)}}())})()}editSelectCateg(e){var i=this;return(0,u.Z)(function*(){i.category2show=yield i.prodserv.getCategAsync(e.key)})()}restartElements(e){this.expandElements(e),this.prodResult.optList=this.updaSetElem(this.category2show.characterList[e],this.prodResult.optList)}expandElements(e){if(e===this.elementView)this.elementView=-1;else{const i=this.category2show.characterList[e];this.prodEditCharDataSchema.controls=[],i.data.forEach(o=>{const n=this.prodResult.optList?.find(r=>r.optid===o.id);n&&(this.prodEditCharData[n.optid]=n.value),this.prodEditCharDataSchema.controls?.push(this.getCharCtrl(o))}),this.elementView=e}}getElementVisible(e){return this.elementView===e}getCharCtrl(e){let i="textarea",o="",n="",r="",c="w-full",d={},m=[];switch(e.type){case"prod_code":case"prod_name":case"text":case"box":i="text";break;case"image":i="header",r=`Editar: ${e.title}      `,c="w-full font-medium",o="add",n="delete",i="picture",d.pictheight="500",d.pictwidth="500";break;case"image_carrousel":i="header",r=`Editar: ${e.title}      `,c="w-full font-medium",o="description",n="photo_library";break;case"circle":i="picture",d.pictheight="100",d.pictwidth="100",o="add",n="delete";break;case"geolocation":i="geolocation";break;case"checkbox":i="boolean";break;case"prod_stock":case"prod_tax_p":case"prod_price":case"prod_star":case"number":i="number"}return e.type.includes("_list")&&(e.selectlist&&e.selectlist.length>0&&(m=this.fillSelectlist(e.selectlist)),i="select",o="list"),this.subFilter.findIndex(y=>y.subfilterlist.includes(e.id))>-1&&(n="menu_open"),{name:e.id,type:i,label:e.title,value:"",default:r,validators:{required:!0},selectOptions:m,tags:d,style:c,totalRows:5,sideBtn:o,sideBtn2:n}}fillSelectlist(e){const i=[];return e.forEach(o=>i.push({key:o,value:o})),i}onGetProdEditCharData(e,i){var o=this;return(0,u.Z)(function*(){if(e._btnclick_||e._btnclick_2_){const r=o.prodResult.optList.findIndex(d=>d.optid===e._propName_),c=o.category2show.characterList[i].data.find(d=>e._propName_===d.id);o.prodResult.optList[r]=yield o.selectlist(o.prodResult.optList[r],o.category2show.characterList[i]),r>-1&&c&&c.type.includes("_list")&&(o.prodResult.optList[r]=e._btnclick_?yield o.SelCharOption(o.prodResult.optList[r],o.category2show.characterList[i]):yield o.selectlist(o.prodResult.optList[r],o.category2show.characterList[i]))}Object.keys(e).forEach(r=>{const c=o.prodResult.optList?.find(d=>d.optid===r);c&&(c.value=e[r])}),yield o.prodserv.updateProd(o.prodResult)})()}SelCharOption(e,i){var o=this;return(0,u.Z)(function*(){const n={title:"Elemento",schema:o.categ2Prod,value:e,dgwidth:450,dgheigth:480},r=yield o.dg.aDefault(n);return r&&o.dg.updatePropResult(e,r),e})()}selectlist(e,i){var o=this;return(0,u.Z)(function*(){const n={title:"Lista de im\xe1genes",schema:{controls:[{label:"Imagen/Foto",name:"imagen",validators:{},type:"picture",tags:{pictheight:"500",pictwidth:"500"}},{label:"V\xednculo remoto",name:"remote_link",validators:{},type:"text",style:"w-full"}]},value:"",tags:{headerAdd:"add",delText:"Eliminar im\xe1gen "},function:[{name:"remote_link",self:o,btn_source:0,function:o.imageRemoteLink}]};return yield o.dg.aDefaultMulti(n),e})()}imageRemoteLink(e,i,o){return(0,u.Z)(function*(){if(i)return i.imagen=i.remote_link,{schema:null,value:i}})()}getPicture(e){return"../assets/images/favicon.png"}onGetProdData(e){}addMateriales(){}deleteMateriales(e){}onGetMaterialData(e){}editCategList(e){}addEditNewCategory(e,i=!1){}updateItemsCat(e,i){}getSubCategList(){}editSubCategList(e,i){}addEditSubCategLis(e,i=!1){}updateItemsSubcat(e,i,o){}getExpand(e,i){return this.show_Product===e&&this.show_area===i}SetExpand(e,i){this.show_Product!==e&&(this.show_Product=e,e>=0?(this.prodResult=this.prodList[e],""===this.prodResult.code&&(this.prodResult.code=this.prodResult._id||"NONE"),this.show_area=i):this.show_area="",this.elementView=-1,this.category2show=null)}startMaterialData(e){}ask2Save(){return(0,u.Z)(function*(){})()}saveItem(){return(0,u.Z)(function*(){})()}startItemAdditionalVals(e){}setItemAdditionalVals(){}getComImage(e,i,o=0){}fileChangeEvent(e,i,o=0,n=null){}findPictElement(e){}onExcel2Dtb(e){this.excelUpload&&this.excelUpload.nativeElement.click()}onDtb2Excel(){}onAllImgs(){return(0,u.Z)(function*(){})()}onFolder2Dtb(e){this.excelUpload&&this.excelUpload.nativeElement.click()}onExcelFileSelected(e){}fileImagesChangeEvent(e){}static#t=this.\u0275fac=function(i){return new(i||s)(t.Y36(b.D),t.Y36(E.k),t.Y36(T.H7),t.Y36(k.r2),t.Y36(w.n),t.Y36(P.x),t.Y36(A.ux),t.Y36(R.Z),t.Y36(L.M))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-product"]],viewQuery:function(i,o){if(1&i&&(t.Gf(F,5),t.Gf(M,5),t.Gf(N,5)),2&i){let n;t.iGM(n=t.CRH())&&(o.editControlTrigger=n.first),t.iGM(n=t.CRH())&&(o.excelUpload=n.first),t.iGM(n=t.CRH())&&(o.imagesUpload=n.first)}},decls:30,vars:4,consts:[[1,"flex","flex-col","max-h-screen"],[3,"buttons","nav_menu","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"flex-1","px-2","flex","flex-col","gap-2","bg-gray-100","overflow-auto"],["class","p-1 flex flex-col justify-between border border-gray-300 rounded shadow-sm bg-white",4,"ngFor","ngForOf"],["products","matMenu"],[1,"font-medium"],["color","primary"],["mat-menu-item","",1,"pl-4",3,"click"],[1,"label"],["type","file","required","","multiple","","accept",".png,.jpg,.gif,.jpeg",3,"change"],[1,"pl-4","my-2"],["color","primary",1,"mt-1"],["mat-menu-item","",3,"click"],["type","file","accept",".xlsx",1,"invisible",3,"change"],["excelUpload",""],[1,"p-1","flex","flex-col","justify-between","border","border-gray-300","rounded","shadow-sm","bg-white"],[1,"flex","justify-start"],["alt","Product",1,"h-16","w-16","rounded-full","object-fill",3,"src"],[1,"flex-1","flex","flex-col","items-start","px-2","grow"],[3,"click"],[1,"text-gray-300"],[1,"hover:text-violet-500",3,"click"],["class","p-2 bg-gray-50",4,"ngIf"],[1,"p-2","bg-gray-50"],[1,"flex","items-center","font-medium"],[1,"grow","ml-2","border-t","border-gray-500"],[1,"flex","ml-2"],[1,"grow"],[3,"removed","click",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],["class","ml-4",4,"ngIf"],[3,"removed","click"],["matChipRemove",""],[1,"ml-4"],[4,"ngFor","ngForOf"],[1,"flex","justify-start","p-1","text-violet-900","font-medium","bg-violet-200","hover:text-violet-400"],[1,"grow",3,"click"],[4,"ngIf"],[1,"ml-2","p-1","bg-gray-100","text-sm"],[1,"flex-1","p-1","mt-2",3,"jsonFormData","values","reset","result"],["let","",4,"ngFor","ngForOf"],["let",""]],template:function(i,o){if(1&i&&(t.TgZ(0,"div",0)(1,"app-header",1),t.NdJ("onClicked",function(r){return o.getClicked(r)}),t.qZA(),t._UZ(2,"span",2,3),t.TgZ(4,"div",4),t.YNc(5,H,15,3,"div",5),t.qZA(),t.TgZ(6,"mat-menu",null,6)(8,"div",7)(9,"mat-icon",8),t._uU(10,"cloud_upload"),t.qZA(),t._uU(11," Base remota "),t.qZA(),t.TgZ(12,"button",9),t.NdJ("click",function(r){return o.onExcel2Dtb(r)}),t._uU(13," Excel hacia DtBase "),t.qZA(),t.TgZ(14,"label",10)(15,"input",11),t.NdJ("change",function(r){return o.fileImagesChangeEvent(r)}),t.qZA(),t.TgZ(16,"span",12),t._uU(17,"Im\xe1genes hacia DtBase"),t.qZA(),t._uU(18,"\xa0\xa0 "),t.qZA(),t._UZ(19,"hr"),t.TgZ(20,"div",7)(21,"mat-icon",13),t._uU(22,"edit"),t.qZA(),t._uU(23," Base local "),t.qZA(),t.TgZ(24,"button",14),t.NdJ("click",function(){return o.onDtb2Excel()}),t._uU(25," Data base hacia Excel "),t.qZA(),t.TgZ(26,"button",14),t.NdJ("click",function(){return o.onAllImgs()}),t._uU(27," Lista de im\xe1genes en la base "),t.qZA()(),t.TgZ(28,"input",15,16),t.NdJ("change",function(r){return o.onExcelFileSelected(r)}),t.qZA()()),2&i){const n=t.MAs(7);t.xp6(1),t.Q6J("buttons","111111")("nav_menu",!1),t.xp6(1),t.Q6J("matMenuTriggerFor",n),t.xp6(3),t.Q6J("ngForOf",o.prodList)}},dependencies:[g.sg,g.O5,U.G,v.Hw,I.r,x.lW,_.VK,_.OP,_.p6,h.z2,h.iO,h.qH],styles:["label.label[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:absolute;top:-1000px}"]})}return s})()}];let Q=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[C.Bz.forChild(Y),C.Bz]})}return s})();var B=a(5425);let V=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[g.ez,Q,B.O,v.Ps,Z.N,x.ot,_.Tx,h.Hi]})}return s})()}}]);