"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[709],{7709:($,g,l)=>{l.r(g),l.d(g,{StaffListModule:()=>R});var f=l(7087),_=l(3759),p=l(3241),x=l(1348),y=l.t(x,2),t=l(2283),A=l(4758),C=l(6806),k=l(6510),b=l(1359),T=l(3620),m=l(9347),h=l(8464),v=l(5559),Z=l(3578),S=l(5499);const w=["editControlTrigger"],U=["excelUpload"];function L(r,u){if(1&r){const e=t.EpF();t.TgZ(0,"div",31)(1,"app-dynamic-form",32),t.NdJ("result",function(n){t.CHM(e);const o=t.oxw(3);return t.KtG(o.onGetdefaData(n))}),t.qZA(),t.TgZ(2,"div",33)(3,"mat-icon",34),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(3);return t.KtG(n.onClearAppoint())}),t._uU(4,"clear"),t.qZA(),t._uU(5," \xa0 "),t.TgZ(6,"mat-icon",35),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2).$implicit,o=t.oxw();return t.KtG(o.onSaveAppoint(n))}),t._uU(7,"done"),t.qZA()()()}if(2&r){const e=t.oxw(3);t.xp6(1),t.Q6J("reset",e.reset)("values",e.appointData)("jsonFormData",e.schemaAppoint)}}function N(r,u){if(1&r&&(t.TgZ(0,"div",42)(1,"div")(2,"strong"),t._uU(3,"Contacto:"),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div")(6,"strong"),t._uU(7,"Correo:"),t.qZA(),t._uU(8),t.qZA(),t.TgZ(9,"div")(10,"strong"),t._uU(11,"Tel\xe9fono:"),t.qZA(),t._uU(12),t.qZA(),t.TgZ(13,"div")(14,"strong"),t._uU(15,"Compromiso:"),t.qZA(),t._uU(16),t.qZA(),t.TgZ(17,"div")(18,"strong"),t._uU(19,"Ejecutar:"),t.qZA(),t._uU(20),t.qZA()()),2&r){const e=t.oxw().$implicit;t.xp6(4),t.hij(" ",e.contact,""),t.xp6(4),t.hij(" ",e.email,""),t.xp6(4),t.hij(" ",e.phone,""),t.xp6(4),t.hij(" ",e.task,""),t.xp6(4),t.hij(" ",e.pollgrp_model_name,"")}}function F(r,u){if(1&r){const e=t.EpF();t.TgZ(0,"div")(1,"div",36)(2,"div",37),t.NdJ("click",function(){const o=t.CHM(e).$implicit,a=t.oxw(3);return t.KtG(a.onHtml2Pdf(o))}),t._uU(3),t.ALo(4,"date"),t.qZA(),t.TgZ(5,"div",38)(6,"mat-icon",39),t.NdJ("click",function(){const o=t.CHM(e).index,a=t.oxw(2).$implicit,c=t.oxw();return t.KtG(c.onDelAppoint(a,o))}),t._uU(7,"delete_otuline"),t.qZA(),t.TgZ(8,"mat-icon",39),t.NdJ("click",function(){const o=t.CHM(e).index,a=t.oxw(2).$implicit,c=t.oxw();return t.KtG(c.onEditAppoint(a,o))}),t._uU(9,"edit"),t.qZA(),t.TgZ(10,"mat-icon",40),t.NdJ("click",function(){const o=t.CHM(e).$implicit,a=t.oxw(3);return t.KtG(a.onchangefull(o))}),t._uU(11),t.qZA()()(),t.YNc(12,N,21,5,"div",41),t.qZA()}if(2&r){const e=u.$implicit,i=t.oxw(3);t.xp6(3),t.AsE(" ",t.xi3(4,4,e.datetime,"MMM dd, yyy hh:mm a")," - ",e.costumer," "),t.xp6(8),t.Oqu(i.getAppIcon(e)),t.xp6(1),t.Q6J("ngIf",e.full)}}function E(r,u){if(1&r){const e=t.EpF();t.TgZ(0,"div",24)(1,"div",25)(2,"div",26),t._uU(3," AGENDA "),t.qZA(),t.TgZ(4,"mat-icon",27),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw();return t.KtG(o.onFilter(n))}),t._uU(5,"tune"),t.qZA(),t.TgZ(6,"mat-icon",28),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.onAddAppoint())}),t._uU(7,"add"),t.qZA()(),t.YNc(8,L,8,3,"div",29),t.YNc(9,F,13,7,"div",30),t.qZA()}if(2&r){const e=t.oxw().$implicit,i=t.oxw();t.xp6(8),t.Q6J("ngIf",i.addApp),t.xp6(1),t.Q6J("ngForOf",e.appoint)}}const M=function(r){return{"background-color":r}};function q(r,u){if(1&r){const e=t.EpF();t.TgZ(0,"div",10),t._UZ(1,"img",11),t.TgZ(2,"div",12)(3,"div",13),t._uU(4),t.qZA(),t.TgZ(5,"div",14)(6,"div",15)(7,"strong"),t._uU(8,"M\xf3vil:"),t.qZA(),t._uU(9),t.qZA(),t.TgZ(10,"div",15)(11,"strong"),t._uU(12,"Email:"),t.qZA(),t._uU(13),t.qZA(),t.TgZ(14,"div",15)(15,"strong"),t._uU(16,"Calificaci\xf3n:"),t.qZA(),t._uU(17),t.qZA()(),t.TgZ(18,"div",16)(19,"div",17)(20,"span")(21,"mat-icon",18),t._uU(22,"forum"),t.qZA(),t.TgZ(23,"mat-icon",19),t.NdJ("click",function(){const o=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.getStaffClicked(o,0))}),t._uU(24,"lock_open"),t.qZA(),t.TgZ(25,"mat-icon",20),t.NdJ("click",function(){const o=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.getStaffClicked(o,1))}),t._uU(26,"edit"),t.qZA(),t.TgZ(27,"mat-icon",21),t.NdJ("click",function(){const o=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.getStaffClicked(o,3))}),t._uU(28,"pending_actions"),t.qZA(),t.TgZ(29,"mat-icon",21),t.NdJ("click",function(){const o=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.getStaffClicked(o,3))}),t._uU(30,"expand_more"),t.qZA(),t._uU(31," \xa0 "),t.TgZ(32,"mat-icon",22),t.NdJ("click",function(){const o=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.getStaffClicked(o,2))}),t._uU(33,"delete"),t.qZA()()()(),t.YNc(34,E,10,2,"div",23),t.qZA()()}if(2&r){const e=u.$implicit,i=t.oxw();t.Q6J("ngStyle",t.VKq(8,M,i.getBackColor(e))),t.xp6(1),t.Q6J("src",i.getPicture(e),t.LSH),t.xp6(3),t.AsE("",e.names," ",e.lastnames," "),t.xp6(5),t.hij(" ",e.phone," "),t.xp6(4),t.hij(" ",e.email," "),t.xp6(4),t.hij(" ",e.stars," "),t.xp6(17),t.Q6J("ngIf","A1"===e.tag)}}const J=[{path:"",component:(()=>{class r{constructor(e,i,n,o,a,c){this.sharedvar=e,this.dtb=i,this.dg=n,this.snkBar=o,this.route=a,this.ds=c,this.addApp=!1,this.reset=0,this.groupRefTrue=[],this.arol="K",this.loading=!1,this.staffList=[],this.schemaAppoint={controls:[{name:"datetime",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}},{name:"costumer",label:"Cliente",type:"text",sideBtn:"people",style:"w-full",validators:{}},{name:"contact",label:"Contacto",type:"text",sideBtn:"person",style:"w-full",validators:{}},{name:"task",label:"Actividad/Compromiso:",type:"textarea",totalRows:4,style:"w-full",validators:{required:!0}},{name:"pollgrp_id",label:"Tarea a ejecutar:",type:"select",style:"w-full",selectOptions:[],validators:{}}]}}ngOnInit(){var e=this;return(0,p.Z)(function*(){e.sub=e.route.params.subscribe(function(){var i=(0,p.Z)(function*(n){if(e.getGroupRef(),e.schemaAppoint.controls){const o=e.schemaAppoint.controls.find(a=>"pollgrp_id"===a.name);o&&(o.selectOptions=e.groupRefTrue,e.reset++)}e.arol=n.rol,e.filter={queryType:3,active:!0,stars:0,rol:e.arol},e.staffList=yield e.dtb.getStaffByFilterAsync(e.filter)});return function(n){return i.apply(this,arguments)}}())})()}ngOnDestroy(){this.sub&&this.sub.unsubscribe()}getBackColor(e){return e.active?"white":"#ffffcc"}getPicture(e){return e.picture&&e.picture.length>0?e.picture:"../assets/images/favicon.png"}getClicked(e){var i=this;return(0,p.Z)(function*(){switch(e.index){case 1:"P"===i.arol&&i.filterDialog();break;case 2:i.onStaff();break;case 3:let n=document.getElementById("spanTrigger");n&&(n.style.display="",n.style.position="absolute",n.style.left=e.pageX+5+"px",n.style.top=e.pageY+5+"px",i.editControlTrigger.openMenu());break;case 4:i.staffList=yield i.dtb.getStaffByFilterAsync(i.filter)}})()}getStaffClicked(e,i){var n=this;switch(i){case 0:this.snkBar.open(`Reiniciar contrase\xf1a: ${e.names} ${e.lastnames}?.`,"Ok",{duration:5e3}).onAction().subscribe(o=>{e.password="",this.dtb.updateStaffAsync(e)});break;case 1:this.onStaff(e);break;case 2:if(this.sharedvar.staff._id===e._id)return void this.snkBar.open(`No es posible eliminar al propietario de \xe9sta sesi\xf3n: ${e.names} ${e.lastnames}?.`,"Ok",{duration:5e3});this.snkBar.open(`Eliminar tasker: ${e.names} ${e.lastnames}?.`,"Ok",{duration:5e3}).onAction().subscribe(function(){var o=(0,p.Z)(function*(a){if(e.active=!1,yield n.dtb.deleteStaffAsync(e._id)){const s=n.staffList.findIndex(d=>d._id===e._id);s>0&&n.staffList.splice(s,1)}});return function(a){return o.apply(this,arguments)}}());break;case 3:e.tag=e.tag="A1"===e.tag?"A0":"A1",this.addApp=!1,this.dtb.updateStaffAsync(e)}}onStaff(e=null){const i=JSON.parse(JSON.stringify(y));if("K"===this.arol){const a=i.controls.findIndex(c=>"rol"===c.name);a>=0&&i.controls.splice(a,1)}let n=!1;e||(e={},n=!0);let o={schema:i,value:e,title:"Datos del Administrador/Tasker",showImage:!0,image:e.picture,imgwidth:200,imgheight:200,newUsr:n};this.dg.aDefault(o).subscribe(a=>{a&&e&&(this.dg.updatePropResult(e,a),e.rol||(e.rol=[]),"K"===this.arol&&!e.rol.includes(this.arol)&&e.rol.push("K"),e.rol.includes("A")||e.rol.push("A"),o.image&&(e.picture=o.image),this.dtb.setStaff(e).subscribe({next:s=>{e=s;const d=this.staffList.findIndex(j=>j._id===s._id);d>=0?this.staffList[d]=s:this.staffList.push(s)}}),navigator.clipboard.writeText(`${this.sharedvar.TASKY_SERVER}tasker/?staff=${e.email}`).then(s=>{}).catch(s=>alert(s)),this.snkBar.open("V\xednculo al cliente copiado al portapapeles.","Ok",{duration:3e3}))})}onExcel2Dtb(e){this.excelUpload&&this.excelUpload.nativeElement.click()}onExcelFileSelected(e){const i=e.target.files[0];this.loading=!this.loading,this.dtb.upload2Excel("staff",i).subscribe({next:n=>{this.loading=!1,this.snkBar.open("Base de tasker/usuarios actualizada","Ok",{duration:1e4}).onAction().subscribe(o=>{location.reload()})}})}onchangefull(e){e.full=!e.full}onHtml2Pdf(e){var i=this;return(0,p.Z)(function*(){if(void 0===e.pollresult_id)return;const n=yield i.dtb.getPollResultAsync(e.pollresult_id);n&&i.dg.aPollResult({schema:{},value:n,title:"Datos de la encuesta: "+n.staff_name}).subscribe(a=>{})})()}getAppIcon(e){return e.full?"expand_less":"expand_more"}onDelAppoint(e,i){!e.appoint||0===e.appoint.length||this.snkBar.open("Eliminar item de la agenda?.","Ok",{duration:5e3}).onAction().subscribe(n=>{e.appoint?.splice(i,1),this.dtb.updateStaffAsync(e)})}onEditAppoint(e,i){var n=this;if(e.appoint&&e.appoint[i].costumer){let a="Editar agenda: ";a+=e.appoint[i].costumer,this.dg.aDefault({schema:{controls:[{name:"datetime",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}},{name:"task",label:"Actividad/Compromiso:",type:"textarea",totalRows:4,style:"w-full",validators:{required:!0}},{name:"pollgrp_id",label:"Tarea a ejecutar:",type:"select",style:"w-full",selectOptions:this.groupRefTrue,validators:{}}]},title:a,value:e.appoint[i],dgwidth:400,dgheigth:450}).subscribe(function(){var s=(0,p.Z)(function*(d){d&&e.appoint&&(e.appoint[i].datetime=d.datetime,e.appoint[i].task=d.task,e.appoint[i].pollgrp_id=d.pollgrp_id,e.appoint[i].pollgrp_model_name=n.getPollGrpName(d.pollgrp_id),n.dtb.updateStaffAsync(e))});return function(d){return s.apply(this,arguments)}}())}}onFilter(e){}onAddAppoint(){this.addApp=!0}onClearAppoint(){this.addApp=!1}onSaveAppoint(e){this.appointSaveSave._valid_?(this.appointSaveSave.pollgrp_model_name=this.getPollGrpName(this.appointSaveSave.pollgrp_id),e.appoint||(e.appoint=[]),e.appoint.push(this.appointSaveSave),this.dtb.updateStaffAsync(e),this.addApp=!1,this.appointSaveSave=null):this.snkBar.open("Datos incompletos?.","Ok",{duration:5e3})}getPollGrpName(e){if(e){const i=this.groupRefTrue.find(n=>n.key===e);if(i)return i.value}return""}getCostumer(e){var i=this;return(0,p.Z)(function*(){if(!e)return;const n=[],o=yield i.dtb.getActiveCRMCostumAsync();o&&(o.forEach(c=>{c&&n.push({selected:!1,myid:c.id,name:c.name})}),i.ds.aSelectDefault({title:"Seleccione Cliente",dgheigth:450,viewfilter:!0,viewAdd:!1,multiSelect:!0,valuelst:n}).subscribe(function(){var c=(0,p.Z)(function*(s){s&&(i.appointData=e,i.appointData.costumer=s[0].name,i.getContact(s[0].myid,s[0].name))});return function(s){return c.apply(this,arguments)}}()))})()}getContact(e,i){var n=this;return(0,p.Z)(function*(){const o=[],a=yield n.dtb.getCMRCostumAsync(e);i=a&&a.name?a.name:i,a?.linkup_1&&o.push({selected:!1,myid:a.phone_1,name:a.linkup_1}),a?.linkup_2&&o.push({selected:!1,myid:a.phone_2,name:a.linkup_2}),n.ds.aSelectDefault({title:"Seleccione Contacto",dgheigth:450,viewfilter:!0,viewAdd:!1,multiSelect:!0,valuelst:o}).subscribe(function(){var s=(0,p.Z)(function*(d){d&&(n.appointData.contact=d[0].name,n.appointData._propName_="",n.appointData._btnEvent_=null,n.reset++)});return function(d){return s.apply(this,arguments)}}())})()}onGetdefaData(e){switch(this.appointSaveSave=e,e._propName_){case"costumer":case"contact":this.getCostumer(e)}}filterDialog(){var e=this;this.dg.aDefault({schema:{controls:[{name:"active",label:"Estado:",type:"select",validators:{},selectOptions:[{key:"1",value:"Activo"},{key:"0",value:"Inactivo"}]},{name:"rol",label:"Rol:",type:"select",validators:{},selectOptions:[{key:"F",value:"Administrador"},{key:"K",value:"Tasker"}]},{name:"email",label:"Correo electr\xf3nico:",type:"text",style:"w-full",validators:{}}]},title:"Filtros",dgwidth:300,dgheigth:400}).subscribe(function(){var o=(0,p.Z)(function*(a){a&&(e.filter={queryType:3,rol:a.rol,email:a.email},a.active&&(e.filter.active="1"===a.active),e.staffList=yield e.dtb.getStaffByFilterAsync(e.filter))});return function(a){return o.apply(this,arguments)}}())}getGroupRef(){this.groupRefTrue=[],this.getRefNodeTrue(this.sharedvar.pollGroupIndex)}getRefNodeTrue(e){if(e.children)for(let i=0;i<e.children.length;i++){const n=e.children[i];if(n.ref)this.groupRefTrue.push({key:n.id,value:n.model_name||n.name});else if(n.children&&n.children.length>0)return this.getRefNodeTrue(n)}}static#t=this.\u0275fac=function(i){return new(i||r)(t.Y36(A.D),t.Y36(C.k),t.Y36(k.x),t.Y36(b.ux),t.Y36(_.gz),t.Y36(T.n))};static#e=this.\u0275cmp=t.Xpm({type:r,selectors:[["app-staff-list"]],viewQuery:function(i,n){if(1&i&&(t.Gf(w,5),t.Gf(U,5)),2&i){let o;t.iGM(o=t.CRH())&&(n.editControlTrigger=o.first),t.iGM(o=t.CRH())&&(n.excelUpload=o.first)}},decls:15,vars:4,consts:[[1,"flex","flex-col","max-h-screen"],[3,"buttons","nav_menu","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"flex-1","flex","flex-col","gap-2","m-2","bg-gray-100","overflow-y-scroll"],["class","w-full p-1 flex flex-row border border-gray-300 rounded shadow-sm",3,"ngStyle",4,"ngFor","ngForOf"],["controlEdit","matMenu"],["mat-menu-item","",3,"click"],["type","file","accept",".xlsx",1,"invisible",3,"change"],["excelUpload",""],[1,"w-full","p-1","flex","flex-row","border","border-gray-300","rounded","shadow-sm",3,"ngStyle"],["alt","aja",1,"h-16","w-16","rounded-full","object-fill",3,"src"],[1,"flex-1","flex","flex-col","items-start","px-2"],[1,"h-6","w-48","overflow-hidden","font-medium","leading-tight"],[1,"flex","flex-row","h-6","mt-1"],[1,"pl-2","h-5","w-48","text-xs","overflow-hidden"],[1,"w-full","h-8","px-1","border-t","border-gray-300","flex","flex-row","gap-x-4","justify-end","text-gray-300"],[1,"pt-1"],["matTooltip","Iniciar conversaci\xf3n",1,"hover:text-violet-500"],["matTooltip","Reiniciar contrase\xf1a",1,"hover:text-violet-500",3,"click"],["matTooltip","Editar informaci\xf3n del usuario",1,"hover:text-violet-500",3,"click"],["matTooltip","Ver/Ocultar agenda",1,"hover:text-violet-500",3,"click"],["matTooltip","Eliminar usuario",1,"hover:text-red-500",3,"click"],["class","w-full mt-2 bg-gray-50 border-b border-gray-300",4,"ngIf"],[1,"w-full","mt-2","bg-gray-50","border-b","border-gray-300"],[1,"h-6","flex","flex-row","items-end","justify-end","bg-gray-200","text-sm"],[1,"flex-1","ml-1","pt-1","text-sky-700"],["matTooltip","Filtrar agenda",1,"mat-18",3,"click"],[1,"text-gray-400","hover:text-sky-700",3,"click"],["matTooltip","Agregar agenda","class","p-4 border border-gray-200",4,"ngIf"],[4,"ngFor","ngForOf"],["matTooltip","Agregar agenda",1,"p-4","border","border-gray-200"],[3,"reset","values","jsonFormData","result"],[1,"h-6","flex","flex-row","items-end","justify-end","bg-gray-200","text-sm","text-gray-400"],["matTooltip","Descartar cambios","color","warn",3,"click"],["matTooltip","Salvar cambios","color","warn",3,"click"],[1,"pl-2","flex","flex-row","text-xs","text-sky-700","items-center"],[1,"flex-1","h-6",3,"click"],[1,"text-gray-300"],[1,"text-sm","hover:text-sky-700",3,"click"],[1,"hover:text-sky-700",3,"click"],["class","ml-4 mb-2 p-1 bg-slate-100 text-xs text-gray-600",4,"ngIf"],[1,"ml-4","mb-2","p-1","bg-slate-100","text-xs","text-gray-600"]],template:function(i,n){if(1&i&&(t.TgZ(0,"div",0)(1,"app-header",1),t.NdJ("onClicked",function(a){return n.getClicked(a)}),t.qZA(),t._UZ(2,"span",2,3),t.TgZ(4,"div",4),t.YNc(5,q,35,10,"div",5),t.qZA()(),t.TgZ(6,"mat-menu",null,6)(8,"button",7),t.NdJ("click",function(a){return n.onExcel2Dtb(a)}),t.TgZ(9,"mat-icon"),t._uU(10,"build"),t.qZA(),t._uU(11," Importar de Excel "),t.qZA(),t._UZ(12,"hr"),t.qZA(),t.TgZ(13,"input",8,9),t.NdJ("change",function(a){return n.onExcelFileSelected(a)}),t.qZA()),2&i){const o=t.MAs(7);t.xp6(1),t.Q6J("buttons","111110")("nav_menu",!1),t.xp6(1),t.Q6J("matMenuTriggerFor",o),t.xp6(3),t.Q6J("ngForOf",n.staffList)}},dependencies:[f.sg,f.O5,f.PC,m.VK,m.OP,m.p6,h.Hw,v.gM,Z.G,S.r,f.uU]})}return r})()}];let G=(()=>{class r{static#t=this.\u0275fac=function(i){return new(i||r)};static#e=this.\u0275mod=t.oAB({type:r});static#i=this.\u0275inj=t.cJS({imports:[_.Bz.forChild(J),_.Bz]})}return r})();var D=l(769),O=l(7572);let R=(()=>{class r{static#t=this.\u0275fac=function(i){return new(i||r)};static#e=this.\u0275mod=t.oAB({type:r});static#i=this.\u0275inj=t.cJS({imports:[f.ez,G,m.Tx,h.Ps,v.AV,D.O,O.N]})}return r})()}}]);