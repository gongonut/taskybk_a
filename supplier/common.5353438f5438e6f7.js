"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[592],{9554:(L,C,n)=>{n.d(C,{g:()=>x});var _=n(3241),o=n(2283),p=n(7087),f=n(3279);const E=["chart"];function b(m,c){if(1&m&&(o.TgZ(0,"div",1),o._UZ(1,"apx-chart",2),o.qZA()),2&m){const e=o.oxw();o.xp6(1),o.Q6J("series",e.chartOptions.series)("chart",e.chartOptions.chart)("fill",e.chartOptions.fill)("legend",e.chartOptions.legend)("plotOptions",e.chartOptions.plotOptions)("xaxis",e.chartOptions.xaxis)("tooltip",e.chartOptions.tooltip)}}let x=(()=>{class m{constructor(){this.data=[],this.prod_list=[],this.pivot=0,this.bartype=0,this.onSelect=new o.vpe}ngOnChanges(e){this.buildChart()}buildChart(){var e=this;return(0,_.Z)(function*(){if(e.data&&0!==e.data.length){switch(e.serieList=[],e.pivot){case 0:case 1:e.timeLineTaskerPivot();break;case 2:e.timeLineTCostumerPivot();break;case 3:e.timeLineProductPivot()}e.chartOptions={series:e.serieList,chart:{height:450,type:"rangeBar",events:{dataPointSelection:(s=(0,_.Z)(function*(t,a,i){yield e.onSelectEvent(e.serieList[i.seriesIndex].data[i.dataPointIndex])}),function(a,i,l){return s.apply(this,arguments)})},toolbar:{show:!0,tools:{zoomin:!0,zoomout:!0}}},plotOptions:{bar:{horizontal:!0,barHeight:"80%",rangeBarGroupRows:1===e.bartype}},xaxis:{type:"datetime",labels:{datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:"hh:mm"},datetimeUTC:!1},tickAmount:6},fill:{type:"solid"},legend:{position:"top",horizontalAlign:"left"},tooltip:{custom:({seriesIndex:s,dataPointIndex:t})=>{const a=e.data.find(i=>i._id===e.serieList[s].data[t].meta);if(a){let i=`: ${new Date(a.date_ini).toLocaleString("es-CO",{dateStyle:"short",timeStyle:"short",hour12:!0})} >> ${new Date(a.date_end).toLocaleString("es-CO",{dateStyle:"short",timeStyle:"short",hour12:!0})}`;switch(e.pivot){case 0:return a.tasker_name+i;case 1:return a.activity_name+i;case 2:return a.costumer_name+i;case 3:return a.crm_products+i}return a.activity_name+i}return""}}}}var s})()}timeLineTaskerPivot(){this.data.forEach(e=>{const s=this.serieList.findIndex(t=>t.name===e.activity_name);s>=0?this.serieList[s].data.push({x:e.tasker_name,y:[e.date_ini,e.date_end],meta:e._id}):this.serieList.push({name:e.activity_name,data:[{x:e.tasker_name,y:[e.date_ini,e.date_end],meta:e._id}]})}),this.cleanSeries()}timeLineTCostumerPivot(){this.data.forEach(e=>{const s=this.serieList.findIndex(t=>t.name===e.costumer_name);s>=0?this.serieList[s].data.push({x:e.tasker_name,y:[e.date_ini,e.date_end],meta:e._id}):this.serieList.push({name:e.costumer_name,data:[{x:e.tasker_name,y:[e.date_ini,e.date_end],meta:e._id}]})}),this.cleanSeries()}timeLineProductPivot(){(!this.prod_list||0===this.prod_list.length)&&(this.prod_list=[],this.data.forEach(e=>{e.crm_products&&e.crm_products.length>0&&this.prod_list.push(...e.crm_products)}),this.prod_list=[...new Set(this.prod_list)]),this.prod_list.forEach(e=>{this.serieList.push({name:e,data:[]})}),this.data.forEach(e=>{const s=this.serieList.findIndex(t=>e.crm_products.find(a=>t.name===a));s>=0?this.serieList[s].data.push({x:e.tasker_name,y:[e.date_ini,e.date_end],meta:e._id}):this.serieList.push({name:e.costumer_name,data:[{x:e.tasker_name,y:[e.date_ini,e.date_end],meta:e._id}]})}),this.cleanSeries()}onSelectEvent(e){var s=this;return(0,_.Z)(function*(){s.onSelect.emit(e)})()}cleanSeries(){this.serieList.forEach(e=>{let s=0;for(;s<e.data.length;)0===e.data[s].y.length?e.data.splice(s,1):s++})}static#e=this.\u0275fac=function(s){return new(s||m)};static#t=this.\u0275cmp=o.Xpm({type:m,selectors:[["app-time-line"]],viewQuery:function(s,t){if(1&s&&o.Gf(E,5),2&s){let a;o.iGM(a=o.CRH())&&(t.chart=a.first)}},inputs:{data:"data",prod_list:"prod_list",pivot:"pivot",bartype:"bartype"},outputs:{onSelect:"onSelect"},features:[o.TTD],decls:1,vars:1,consts:[["id","chart",4,"ngIf"],["id","chart"],[3,"series","chart","fill","legend","plotOptions","xaxis","tooltip"]],template:function(s,t){1&s&&o.YNc(0,b,2,7,"div",0),2&s&&o.Q6J("ngIf",t.data&&t.data.length>0)},dependencies:[p.O5,f.x]})}return m})()},6483:(L,C,n)=>{n.d(C,{q:()=>m});var _=n(7087),o=n(3759),p=n(9554),f=n(2283);const E=[{path:"",component:p.g}];let b=(()=>{class c{static#e=this.\u0275fac=function(t){return new(t||c)};static#t=this.\u0275mod=f.oAB({type:c});static#i=this.\u0275inj=f.cJS({imports:[o.Bz.forChild(E),o.Bz]})}return c})();var x=n(3279);let m=(()=>{class c{static#e=this.\u0275fac=function(t){return new(t||c)};static#t=this.\u0275mod=f.oAB({type:c});static#i=this.\u0275inj=f.cJS({imports:[_.ez,b,x.X]})}return c})()},4537:(L,C,n)=>{n.d(C,{x:()=>c});var _=n(3241),o=n(4344),p=n(2283),f=n(4758),E=n(6806),b=n(1359),x=n(6510),m=n(3620);let c=(()=>{class e{constructor(t,a,i,l,r){this.sharedvar=t,this.dtb=a,this.snkBar=i,this.dg=l,this.ds=r,this.schemaAppoint={controls:[{name:"staff",label:"Responsable:",type:"select",selectOptions:[],validators:{required:!0}},{name:"datetime",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}},{name:"dateend",label:"Fecha y hora final sugerida:",type:"datetime-local",sideBtn:"more_time",validators:{required:!0}},{name:"notes",label:"Notas:",type:"textarea",totalRows:4,style:"w-full",validators:{required:!0}},{name:"costumer",label:"Cliente",type:"text",sideBtn:"people",style:"w-full",validators:{}},{name:"contact",label:"Contacto",type:"text",style:"w-full",validators:{}},{name:"address",label:"Direcci\xf3n",type:"text",style:"w-full",validators:{}},{name:"geoLoc",label:"Geolocalizaci\xf3n",type:"text",style:"w-full",sideBtn:"room",validators:{}},{name:"pollgrp_id",label:"Tarea a ejecutar:",type:"select",style:"w-full",selectOptions:[],validators:{}}]},this.groupRefTrue=[]}startAppointData(t){if(this.staffList=t,this.getGroupRef(),this.schemaAppoint.controls){const a=this.schemaAppoint.controls.find(l=>"pollgrp_id"===l.name);a&&(a.selectOptions=this.groupRefTrue);const i=this.schemaAppoint.controls.find(l=>"staff"===l.name);i&&(i.selectOptions=[],t.forEach(l=>{l._id&&i.selectOptions?.push({key:l._id,value:`${l.names} ${l.lastnames}`})}))}}getPollGrpName(t){if(t){const a=this.groupRefTrue.find(i=>i.key===t);if(a)return a.value}return""}getGroupRef(){this.groupRefTrue=[],this.getRefNodeTrue(this.sharedvar.pollGroupIndex)}getRefNodeTrue(t){if(t.children)for(let a=0;a<t.children.length;a++){const i=t.children[a];if(i.ref)this.groupRefTrue.push({key:i.id,value:i.model_name||i.name});else if(i.children&&i.children.length>0)return this.getRefNodeTrue(i)}}onDelAppoint(t,a){!t.appoint||0===t.appoint.length||this.snkBar.open("Eliminar item de la agenda?.","Ok",{duration:5e3}).onAction().subscribe(i=>{t.appoint?.splice(a,1),this.dtb.updateStaffAsync(t)})}onAddEditAppoint(t,a){var i=this;let l,r,O="Agenda ";const y=null===t||-1===a;null==t&&(t=this.staffList[0]),t.appoint||(t.appoint=[]),r=-1===a?{datetime:this.sharedvar.dateNow(),dateend:this.sharedvar.dateNow(),ended:!1,owner:this.sharedvar.staff._id||""}:t.appoint[a],O+=y?"Nueva":`${t.names} ${t.lastnames||""}`;const h=this.schemaAppoint.controls?.findIndex(v=>"contact"===v.name);if(h&&h>=0&&this.schemaAppoint.controls&&(this.schemaAppoint.controls[h].type="text"),this.schemaAppoint.controls){const v=this.schemaAppoint.controls.findIndex(d=>"staff"===d.name);v>=0&&(this.schemaAppoint.controls[v].disabled=!y)}t.appoint&&r&&(l={staff:t._id,...r}),this.dg.aDefault({schema:this.schemaAppoint,title:O,value:l,dgwidth:400,function:[{name:"costumer",self:this,function:this.getCostumer1},{name:"dateend",self:this,function:this.addTime}]}).subscribe(function(){var v=(0,_.Z)(function*(d){if(d){const g=i.staffList.find(A=>A._id==d.staff);if(!g)return;g.appoint||(g.appoint=[]),d.dateend<=d.datetime&&(d.dateend=d.datetime+i.sharedvar.addMinutes(15)),delete d._btnEvent_,delete d._btnclick_,delete d._propName_,delete d._valid_,delete d.staff,i.dg.updatePropResult(r,d),i.selectedCostumer&&(r.contact===i.selectedCostumer.linkup_1?(r.email=i.selectedCostumer.email_1,r.phone=i.selectedCostumer.phone_1):(r.email=i.selectedCostumer.email_2,r.phone=i.selectedCostumer.phone_2)),r.pollgrp_model_name=i.getPollGrpName(d.pollgrp_id),y?g.appoint.push(r):g.appoint[a]=r,i.dtb.updateStaffAsync(g)}});return function(d){return v.apply(this,arguments)}}())}getCostumer1(t,a,i){return(0,_.Z)(function*(){if(!a)return;const l=[],r=yield t.dtb.getActiveCRMCostumAsync();if(!r)return;r.forEach(h=>{h&&l.push({selected:!1,myid:h.id,name:h.name})});const O={title:"Seleccione Cliente",dgheigth:450,viewfilter:!0,viewAdd:!1,multiSelect:!0,valuelst:l},y=yield(0,o.z)(t.ds.aSelectDefault(O));if(y){t.selectedCostumer=r.find(u=>u.name===y[0].name),a.costumer=y[0].name,a.address=t.selectedCostumer.address;const h=i.controls?.findIndex(u=>"contact"===u.name);if(h&&h>=0&&i.controls){const u=[];t.selectedCostumer?.linkup_1&&u.push({key:t.selectedCostumer.linkup_1,value:t.selectedCostumer.linkup_1}),t.selectedCostumer?.linkup_2&&u.push({key:t.selectedCostumer?.linkup_2,value:t.selectedCostumer?.linkup_2}),i.controls[h].type="select",i.controls[h].selectOptions=u}}return{schema:i,value:a}})()}addTime(t,a,i){return(0,_.Z)(function*(){if(a)return a.dateend=Number(a.dateend)+t.sharedvar.addMinutes(15),{schema:null,value:a}})()}onFilter(t){}static#e=this.\u0275fac=function(a){return new(a||e)(p.LFG(f.D),p.LFG(E.k),p.LFG(b.ux),p.LFG(x.x),p.LFG(m.n))};static#t=this.\u0275prov=p.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})()},1348:L=>{L.exports=JSON.parse('{"controls":[{"name":"id","label":"Identificaci\xf3n:","type":"text","validators":{"required":true}},{"name":"names","label":"Nombre (s):","type":"text","style":"w-3/4","validators":{"required":true}},{"name":"lastnames","label":"Apellidos (s):","type":"text","style":"w-3/4","validators":{"required":true}},{"name":"city","label":"Ciudad de residencia","type":"text","style":"w-3/4","validators":{"required":true}},{"name":"email","label":"Correo electr\xf3nico","type":"text","style":"w-3/4","validators":{"required":true}},{"name":"phone","label":"Tel\xe9fono","type":"tel","validators":{"required":true}},{"name":"rol","label":"Permiso para editar","type":"multiselect","style":"w-full","validators":{"required":true},"selectOptions":[{"key":"K","value":"Es Tasker"},{"key":"P","value":"Es Administrador"},{"key":"F","value":"Edita tasker"},{"key":"U","value":"Edita usuaro"},{"key":"D","value":"Edita directorio"}]},{"name":"legal_acceptance","label":"Acepto t\xe9rminos de la ley 1581.","type":"checkbox","validators":{"required":true}},{"name":"active","label":"Activo.","type":"checkbox","validators":{"required":true}}]}')}}]);