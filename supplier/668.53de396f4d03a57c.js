"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[668],{7668:(T,y,r)=>{r.r(y),r.d(y,{DynamicDialogComponent:()=>E});var f=r(765),e=r(6339),D=r(6789),v=r(7254),C=r(8466),a=r(1781),n=r(4070),s=r(4370),p=r(8137),c=r(4156),_=r(1030);const m=["scrollMe"],h=["editControlTrigger"];function g(d,x){1&d&&(e.TgZ(0,"div",23)(1,"div",24),e._uU(2," Llave "),e.qZA(),e.TgZ(3,"div",25),e._uU(4," T\xedtulo "),e.qZA()())}function k(d,x){if(1&d){const t=e.EpF();e.TgZ(0,"div",26)(1,"div",27)(2,"div",28),e._uU(3,"T\xedtulo"),e.qZA(),e._UZ(4,"div",28),e.TgZ(5,"input",29),e.NdJ("valueChange",function(l){e.CHM(t);const o=e.oxw(2);return e.KtG(o.avalue=l)})("change",function(l){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onEditVal(l,"V"))}),e.qZA()(),e._UZ(6,"hr"),e.TgZ(7,"div",30)(8,"div",28),e._uU(9,"Llave"),e.qZA(),e._UZ(10,"div",28),e.TgZ(11,"input",29),e.NdJ("valueChange",function(l){e.CHM(t);const o=e.oxw(2);return e.KtG(o.akey=l)})("change",function(l){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onEditVal(l,"K"))}),e.qZA(),e._UZ(12,"div",31),e.TgZ(13,"mat-icon",19),e.NdJ("click",function(){e.CHM(t);const l=e.oxw(2);return e.KtG(l.selKey())}),e._uU(14,"more_horiz"),e.qZA()()()}if(2&d){const t=e.oxw(2);e.xp6(5),e.Q6J("value",t.avalue),e.xp6(6),e.Q6J("value",t.akey)}}function b(d,x){if(1&d){const t=e.EpF();e.TgZ(0,"div",32)(1,"div",33),e._uU(2),e.qZA(),e.TgZ(3,"div",25),e._uU(4),e.qZA(),e.TgZ(5,"div",34)(6,"mat-icon",19),e.NdJ("click",function(){const o=e.CHM(t).index,u=e.oxw(2);return e.KtG(u.onOptionSel(o))}),e._uU(7,"edit"),e.qZA(),e.TgZ(8,"mat-icon",19),e.NdJ("click",function(){const o=e.CHM(t).index,u=e.oxw(2);return e.KtG(u.onOptionDel(o))}),e._uU(9,"delete"),e.qZA()()()}if(2&d){const t=x.$implicit;e.xp6(2),e.hij(" ",t.key," "),e.xp6(2),e.hij(" ",t.value," ")}}function O(d,x){if(1&d){const t=e.EpF();e.TgZ(0,"div",15)(1,"div",16)(2,"div",17),e._uU(3," Opciones "),e.qZA(),e.TgZ(4,"div",18)(5,"mat-icon",19),e.NdJ("click",function(){e.CHM(t);const l=e.oxw();return e.KtG(l.onOptionSel())}),e._uU(6),e.qZA()()(),e.YNc(7,g,5,0,"div",20),e.YNc(8,k,15,2,"div",21),e.YNc(9,b,10,2,"div",22),e.qZA()}if(2&d){const t=e.oxw();e.xp6(6),e.Oqu(t.getIconState()),e.xp6(1),e.Q6J("ngIf",-1===t.edtOpIndex),e.xp6(1),e.Q6J("ngIf",t.edtOpIndex>-1),e.xp6(1),e.Q6J("ngForOf",t.selectOptions)}}let E=(()=>{class d{constructor(t,i,l,o,u,A){this.dialogRef=t,this.data=i,this.sharedvar=l,this.snkBar=o,this.pollServ=u,this.ds=A,this.ValidationsArray=[],this.reset=0,this.formData={controls:[{name:"type",label:"T\xedpo de Control:",type:"select",default:"header",style:"w-full",validators:{required:!0},selectOptions:[{key:"appoint",value:"Agenda"},{key:"textarea",value:"Area de Texto"},{key:"text",value:"Texto"},{key:"password",value:"Contrase\xf1a"},{key:"costumer",value:"CRM Clientes"},{key:"costumer_edit",value:"CRM Clientes (Editable)"},{key:"product",value:"CRM Productos"},{key:"draw",value:"Dibujo"},{key:"duplicate",value:"Duplicar Grupo"},{key:"date",value:"Fecha"},{key:"datetime-local",value:"Fecha-Hora"},{key:"picture",value:"Foto"},{key:"geolocation",value:"Geolocalizaci\xf3n"},{key:"goto",value:"Ir a..."},{key:"number",value:"N\xfamero"},{key:"select",value:"Selecci\xf3n"},{key:"multiselect",value:"Selecci\xf3n Multiple"},{key:"checkbox",value:"Caja de verificaci\xf3n"},{key:"header",value:"T\xedtulo"}]},{name:"name",label:"Nombre:",type:"text",sideBtn:"menu",style:"w-full",validators:{required:!0}},{name:"dtbase",label:"Afecta DataBase",type:"checkbox",default:"true",validators:{}},{name:"label",label:"T\xedtulo:",type:"textarea",style:"w-full",sideBtn:"find_in_page",totalRows:5,validators:{required:!0}},{name:"required",label:"Requerido",type:"checkbox",validators:{}},{name:"evidence",label:"Evidencia:",type:"multiselect",style:"w-full",validators:{},selectOptions:[{key:"note",value:"Notas"},{key:"picture",value:"Foto"},{key:"draw",value:"Firma"},{key:"attach",value:"Adjuntar"}]},{name:"style",label:"Est\xedlo:",type:"multiselect",style:"w-full",validators:{},selectOptions:[{key:"w-full",value:"Ancho Total"},{key:"w-2/3",value:"Ancho 2/3"},{key:"w-3/4",value:"Ancho 3/4"},{key:"text-xs",value:"Tama\xf1o del Texto XS"},{key:"text-xl",value:"Tama\xf1o del Texto L"},{key:"text-2xl",value:"Tama\xf1o del Texto XL"},{key:"bg-gray-950 text-white",value:"Fondo negro"},{key:"text-red-900 font-medium",value:"Destacar Texto"},{key:"text-gray-400",value:"Disimular Texto"},{key:"poll-text-box",value:"Caja de Texto"}]}]},this.ctrDefault={name:"default",label:"Valor por defecto",type:"text",style:"w-full",totalRows:5,validators:{}},this.ctrDuplicate={name:"dupactivity",label:"Seleccione Grupo Actividades",type:"text",style:"w-full",validators:{},sideBtn:"add"},this.ctrTtlRows={name:"totalRows",label:"N\xfamero de Lineas:",type:"number",validators:{}},this.selectData={name:"selectOptions",label:"Lista de opciones",type:"text",style:"invisible h-0",validators:{}},this.disable=!0,this.newValue={key:"",value:""},this.selectOptions=[],this.edtOpIndex=-1,t.disableClose=!0,i.value&&i.value.selectOptions&&(this.selectOptions=JSON.parse(JSON.stringify(i.value.selectOptions))),i.value||(i.value={type:"text",tags:{dtbase:!0,type:"text"}}),i.value.dtbase=i.value.tags.dtbase,i.value.type=i.value.tags.type,i.value.required=i.value.validators&&i.value.validators.required,i.value.dupactivity=i.value.tags.dupactivity,i.value.evidence=i.value.tags.evidence,this.schema=this.setSChema(i.value)}onGetData(t){if(this.disable=!1===t._valid_,t.validatorsVal=this.onValidation(t.validators).join(),(!this.result||this.result.type!==t.type)&&(this.schema=this.setSChema(t)),t.name&&t.name.length>0&&!t.label&&(t.label=t.name,this.data.value={...t}),"header"===t.type&&t.label!==t.default&&(t.default=t.label,this.data.value={...t}),"dupactivity"===t._propName_&&this.selDupGroup(t),!0===t._btnclick_){if("name"===t._propName_){let i=document.getElementById("spanTrigger");i&&(i.style.display="",i.style.position="absolute",i.style.left="50px",i.style.top="50px",this.editControlTrigger.openMenu())}if("label"===t._propName_){const i=this.pollServ.getUniqueTitle(t.name,t.label);t.label!==i&&this.snkBar.open(`El t\xedtulo "${t.label}" ya est\xe1 registrado en la lista de controles.`,"Ok",{duration:3e3})}}this.result={...t}}setSChema(t){const i=JSON.parse(JSON.stringify(this.formData));switch(i.controls||(i.controls=[]),t.type){case"draw":case"geolocation":case"picture":case"appoint":break;case"duplicate":i.controls.push(this.ctrDuplicate);break;default:i.controls.push(this.ctrDefault)}return"textarea"===t.type&&i.controls?.push(this.ctrTtlRows),("select"===t.type||"multiselect"===t.type||"goto"===t.type)&&i.controls.push(this.selectData),i}onValidation(t=[]){if(0===t.length)return this.ValidationsArray=[],[];const i=[];return t.forEach(l=>{const o=this.ValidationsArray.findIndex(u=>u.includes(l));i.push(o<0?l:this.ValidationsArray[o])}),this.ValidationsArray=i,i}onDismiss(){this.dialogRef.close()}onSave(){this.result.tags={dtbase:this.result.dtbase,type:this.result.type,evidence:this.result.evidence},this.pollServ.getSideBtn(this.result),this.result.selectOptions=this.selectOptions,this.dialogRef.close(this.result)}geSelOptionBoxVisible(){return this.result?"select"===this.result.type||"multiselect"===this.result.type||"goto"===this.result.type:this.selectOptions.length>0}getIconState(){return this.edtOpIndex>-1?"done":"add"}onEditVal(t,i){"K"===i||(this.avalue=t.target.value),this.akey=t.target.value}onOptionSel(t=-1){-1===t?this.edtOpIndex>=0?(this.selectOptions[this.edtOpIndex].key=this.akey,this.selectOptions[this.edtOpIndex].value=this.avalue,this.edtOpIndex=-1,this.newValue={key:"selectOptions",value:this.selectOptions}):(this.selectOptions.push({key:"",value:null}),this.edtOpIndex=this.selectOptions.length-1):this.edtOpIndex=t,this.edtOpIndex>=0&&(this.akey=this.selectOptions[this.edtOpIndex].key,this.avalue=this.selectOptions[this.edtOpIndex].value)}onOptionDel(t){this.snkBar.open(`Borrar: "${this.selectOptions[t].value}?"`,"Borrar",{duration:3e3}).onAction().subscribe(i=>{this.selectOptions.splice(t,1),this.newValue={key:"selectOptions",value:this.selectOptions}})}selKey(){const i={title:"Seleccione Formulario",dgheigth:450,viewfilter:!1,viewAdd:!1,multiSelect:!0,valuelst:this.getSelPollData(!1)};this.ds.aSelectDefault(i).subscribe(l=>{if(l){this.akey=l[0].myid,this.avalue=l[0].name;try{this.myScrollContainer.nativeElement.scrollTop=this.myScrollContainer.nativeElement.scrollHeight}catch{}}})}selDupGroup(t){const l={title:"Seleccione Formulario",dgheigth:450,viewfilter:!1,viewAdd:!1,multiSelect:!1,valuelst:this.getSelPollData(!0,t.dupactivity)};this.ds.aSelectDefault(l).subscribe(o=>{o&&(this.allowUpdateTotal(this.data.value.dupactivity,o[0].myid),this.data.value.dupactivity=o[0].myid,this.data.value.label=o[0].name,this.result.dupactivity=o[0].myid,this.result.label=o[0].name,this.reset++)})}allowUpdateTotal(t="",i){if(""!==t){const l=this.sharedvar.pollGrpExecuted.pollList.find(o=>o.id===t);l&&(l.totalDup||(l.totalDup=0),l.totalDup>0&&l.totalDup--)}if(""!==i){const l=this.sharedvar.pollGrpExecuted.pollList.find(o=>o.id===i);l&&(l.totalDup||(l.totalDup=0),l.totalDup++)}}getSelPollData(t,i=""){const l=[],o=this.sharedvar.pollSelected;return this.sharedvar.pollGrpExecuted.pollList.forEach(u=>{o.totalDup||(o.totalDup=0),(t||!t&&0===o.totalDup)&&u.id!==o.id&&l.push({selected:u.id===i,myid:u.id,name:u.title})}),l}onVarName(t){"text"===this.result.type?(this.result.name=t,this.data.value.name=this.result.name,this.data.value._valid_=!0,this.reset++):this.snkBar.open('Solo se admite en control tipo "Texto"',"Ok",{duration:5e3})}static#e=this.\u0275fac=function(i){return new(i||d)(e.Y36(f.so),e.Y36(f.WI),e.Y36(D.D),e.Y36(v.ux),e.Y36(C.n),e.Y36(a.n))};static#t=this.\u0275cmp=e.Xpm({type:d,selectors:[["app-dynamic-dialog"]],viewQuery:function(i,l){if(1&i&&(e.Gf(m,5),e.Gf(h,5)),2&i){let o;e.iGM(o=e.CRH())&&(l.myScrollContainer=o.first),e.iGM(o=e.CRH())&&(l.editControlTrigger=o.first)}},decls:34,vars:7,consts:[["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"flex","flex-col","h-full"],[1,"h-16","p-3","text-3xl","bg-violet-600","text-white","font-medium"],[1,"flex-1","px-3","pt-2","overflow-auto"],["scrollMe",""],[3,"reset","jsonFormData","values","result"],["class","border border-gray-300 items-center rounded-md",4,"ngIf"],[1,"flex","p-3","justify-end","border-t","border-violet-500"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary","cdkFocusInitia","",3,"disabled","click"],["controlEdit","matMenu"],[1,"p-1","text-center","font-medium"],[1,"ml-3","p-1"],["mat-menu-item","",3,"click"],[1,"border","border-gray-300","items-center","rounded-md"],[1,"flex","font-medium","p-2","bg-violet-500","rounded-t-md"],[1,"flex-auto","text-white","mt-1"],[1,"text-violet-500","bg-white","border","border-violet-600","rounded-sm"],[3,"click"],["class","flex items-center h-7 mt-0 mx-1 text-violet-800 border-b border-violet-800 border-dotted",4,"ngIf"],["class","mx-1 mt-0 flex flex-col items-start border-b border-dotted border-violet-800 p-1 text-violet-800",4,"ngIf"],["class","flex h-9 p-1",4,"ngFor","ngForOf"],[1,"flex","items-center","h-7","mt-0","mx-1","text-violet-800","border-b","border-violet-800","border-dotted"],[1,"w-12","h-8","p-1","bg-gray-300"],[1,"flex-auto","p-1"],[1,"mx-1","mt-0","flex","flex-col","items-start","border-b","border-dotted","border-violet-800","p-1","text-violet-800"],[1,"flex","items-center","justify-start","mt-1"],[1,"w-10"],[1,"rounded-sm","border","p-1","border-gray-300",3,"value","valueChange","change"],[1,"flex","items-center","justify-start"],[1,"w-2"],[1,"flex","h-9","p-1"],[1,"w-12","p-1","bg-gray-300","overflow-hidden"],[1,"bg-violet-100","border","content-center","text-sm","text-violet-500"]],template:function(i,l){if(1&i&&(e._UZ(0,"span",0,1),e.TgZ(2,"div",2)(3,"h1",3),e._uU(4),e.qZA(),e.TgZ(5,"div",4,5)(7,"app-dynamic-form",6),e.NdJ("result",function(u){return l.onGetData(u)}),e.qZA(),e.YNc(8,O,10,4,"div",7),e.qZA(),e.TgZ(9,"div",8)(10,"button",9),e.NdJ("click",function(){return l.onDismiss()}),e.TgZ(11,"mat-icon"),e._uU(12,"close"),e.qZA()(),e._uU(13," \xa0 "),e.TgZ(14,"button",10),e.NdJ("click",function(){return l.onSave()}),e.TgZ(15,"mat-icon"),e._uU(16,"done"),e.qZA()()()(),e.TgZ(17,"mat-menu",null,11)(19,"h2",12),e._uU(20,"Nombre del control correspondiente a variable del sistema que se generan al crear la agenda"),e.qZA(),e.TgZ(21,"div",13)(22,"button",14),e.NdJ("click",function(){return l.onVarName("crm_costum_id")}),e._uU(23," Identificaci\xf3n de cliente "),e.qZA(),e.TgZ(24,"button",14),e.NdJ("click",function(){return l.onVarName("crm_costum_name")}),e._uU(25," Nombre del cliente "),e.qZA(),e.TgZ(26,"button",14),e.NdJ("click",function(){return l.onVarName("crm_costum_contact")}),e._uU(27," Nombre del contacto "),e.qZA(),e.TgZ(28,"button",14),e.NdJ("click",function(){return l.onVarName("crm_costum_email")}),e._uU(29," Correo electr\xf3nico del contacto "),e.qZA(),e.TgZ(30,"button",14),e.NdJ("click",function(){return l.onVarName("crm_costum_phone")}),e._uU(31," Tel\xe9fono del contacto "),e.qZA(),e.TgZ(32,"button",14),e.NdJ("click",function(){return l.onVarName("crm_note")}),e._uU(33," Notas "),e.qZA()()()),2&i){const o=e.MAs(18);e.Q6J("matMenuTriggerFor",o),e.xp6(4),e.Oqu(l.data.title),e.xp6(3),e.Q6J("reset",l.reset)("jsonFormData",l.schema)("values",l.data.value),e.xp6(1),e.Q6J("ngIf",l.geSelOptionBoxVisible()),e.xp6(6),e.Q6J("disabled",l.disable)}},dependencies:[n.sg,n.O5,s.lW,p.Hw,c.VK,c.OP,c.p6,_.r]})}return d})()},8466:(T,y,r)=>{r.d(y,{n:()=>D});var f=r(6339),e=r(6789);let D=(()=>{class v{constructor(a){this.sharedvar=a,this.groupRefTrue=[]}parsePollList(a,n){for(let s=0;s<n.length;s++){const p=n[s];a.pollList.push(this.newPoll(p.name));const c=a.pollList[a.pollList.length-1].schema;for(let _=1;_<p.data.length;_++)c.controls.push(this.data2control(p.data[_]))}return n}data2control(a){const n=this.sharedvar.getUniqueName("",a.A,this.sharedvar.pollGrpExecuted.pollList),s=this.getTypeFromData(a.B),p=this.getEvidenceFromData(a.E),c={dtbase:a.F,type:s,evidence:p,help:a.H},_={required:a.D};let m=[];s.includes("select")&&a.C.split(";").forEach(k=>{const b=k.split(":");m.push({key:b[0],value:b[1]})});const h={name:n,label:a.A,type:s,style:this.getStyleFromData(a.G),tags:c,selectOptions:m,validators:_};return this.getSideBtn(h),h}getTypeFromData(a){switch(a){case"Agenda":return"appoint";case"Area de Texto":return"textarea";case"Texto":return"text";case"Contrase\xf1a":return"password";case"CRM Clientes":return"costumer";case"CRM Clientes (Editable)":return"costumer_edit";case"CRM Productos":return"product";case"Dibujo":return"draw";case"Duplicar Grupo":return"duplicate";case"Fecha":return"date";case"Fecha-Hora":return"datetime-local";case"Foto":return"picture";case"Geolocalizaci\xf3n":return"geolocation";case"Ir a...":return"goto";case"N\xfamero":return"number";case"Selecci\xf3n":return"select";case"Selecci\xf3n Multiple":return"multiselect";case"Caja de verificaci\xf3n":return"checkbox";case"T\xedtulo":return"header";default:return""}}getStyleFromData(a){return a&&0!==a.length?a.split(",").map(n=>n.trim()):["w-full"]}getEvidenceFromData(a){let n=[];if(0===a.length)return n;const s=a.split(",");return s.includes("Sin evidencia")||s.forEach(p=>{switch(p.trim()){case"Nota":n.push("note");break;case"Foto":n.push("picture");break;case"Firma":n.push("draw");break;case"Adjunto":n.push("attach")}}),n}getSideBtn(a){switch(a.type){case"appoint":a.type="text",a.sideBtn="pending_actions",a.disabled=!0;break;case"costumer":case"costumer_edit":a.type="text",a.sideBtn="people",a.disabled=!0;break;case"geolocation":a.type="text",a.sideBtn="terrain",a.disabled=!0;break;case"header":a.default=a.label,a.disabled=!0;break;case"goto":a.type="select",a.sideBtn="east";break;case"draw":a.type="text",a.sideBtn="edit",a.disabled=!0;break;case"picture":a.type="text",a.sideBtn="photo_camera",a.disabled=!0;break;case"product":a.type="text",a.sideBtn="shopping_cart",a.disabled=!0;break;case"duplicate":a.type="select",a.sideBtn="add",a.sideBtn2="navigate_next",a.tags.dupactivity=a.dupactivity||"";break;case"textarea":case"text":a.sideBtn="mic_none"}return a}getUniqueTitle(a,n){let s=0,p="";const c=n.split(" ");let _=Number(c[c.length-1]);""!=c[c.length-1]&&!isNaN(_)&&(c.splice(c.length-1,1),n=c.join(" "));for(let m=0;m<this.sharedvar.pollGrpExecuted.pollList.length;m++){const h=this.sharedvar.pollGrpExecuted.pollList[m].schema.controls||[];for(let g=0;g<h.length;g++)if(h[g].label.toUpperCase().includes(`${n}${p}`.toUpperCase())&&h[g].name!==a){p="_"+s++,m=-1;break}}return`${n}${p}`}getGroupRef(){return this.groupRefTrue=[],this.getRefNodeTrue(this.sharedvar.pollGroupIndex),this.groupRefTrue}getRefNodeTrue(a){if(a.children)for(let n=0;n<a.children.length;n++){const s=a.children[n];if(s.ref)this.groupRefTrue.push({key:s.id,value:s.model_name||s.name});else if(s.children&&s.children.length>0)return this.getRefNodeTrue(s)}}newPoll(a="Actividad"){return{id:this.sharedvar.getSerialKey(3,4,"_"),title:a,allowStart:!1,allowEnd:!1,duplicated:!1,totalDup:0,dupTotal:0,schema:{controls:[]},values:{_valid_:!0}}}static#e=this.\u0275fac=function(n){return new(n||v)(f.LFG(e.D))};static#t=this.\u0275prov=f.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"})}return v})()}}]);