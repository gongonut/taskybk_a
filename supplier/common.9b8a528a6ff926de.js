"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[592],{9554:(b,E,n)=>{n.d(E,{g:()=>O});var f=n(3241),o=n(2283),m=n(7087),y=n(3279);const x=["chart"];function L(h,u){if(1&h&&(o.TgZ(0,"div",1),o._UZ(1,"apx-chart",2),o.qZA()),2&h){const t=o.oxw();o.xp6(1),o.Q6J("series",t.chartOptions.series)("chart",t.chartOptions.chart)("fill",t.chartOptions.fill)("legend",t.chartOptions.legend)("plotOptions",t.chartOptions.plotOptions)("xaxis",t.chartOptions.xaxis)("tooltip",t.chartOptions.tooltip)}}let O=(()=>{class h{constructor(){this.data=[],this.prod_list=[],this.pivot=0,this.bartype=0,this.onSelect=new o.vpe}ngOnChanges(t){this.buildChart()}buildChart(){var t=this;return(0,f.Z)(function*(){if(t.data&&0!==t.data.length){switch(t.serieList=[],t.pivot){case 0:case 1:t.timeLineTaskerPivot();break;case 2:t.timeLineTCostumerPivot();break;case 3:t.timeLineProductPivot()}t.chartOptions={series:t.serieList,chart:{height:450,type:"rangeBar",events:{dataPointSelection:(s=(0,f.Z)(function*(e,i,a){yield t.onSelectEvent(t.serieList[a.seriesIndex].data[a.dataPointIndex])}),function(i,a,r){return s.apply(this,arguments)})},toolbar:{show:!0,tools:{zoomin:!0,zoomout:!0}}},plotOptions:{bar:{horizontal:!0,barHeight:"80%",rangeBarGroupRows:1===t.bartype}},xaxis:{type:"datetime",labels:{datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:"hh:mm"},datetimeUTC:!1},tickAmount:6},fill:{type:"solid"},legend:{position:"top",horizontalAlign:"left"},tooltip:{custom:({seriesIndex:s,dataPointIndex:e})=>{const i=t.data.find(a=>a._id===t.serieList[s].data[e].meta);if(i){let a=`: ${new Date(i.date_ini).toLocaleString("es-CO",{dateStyle:"short",timeStyle:"short",hour12:!0})} >> ${new Date(i.date_end).toLocaleString("es-CO",{dateStyle:"short",timeStyle:"short",hour12:!0})}`;switch(t.pivot){case 0:return i.tasker_name+a;case 1:return i.activity_name+a;case 2:return i.costumer_name+a;case 3:return i.crm_products+a}return i.activity_name+a}return""}}}}var s})()}timeLineTaskerPivot(){this.data.forEach(t=>{const s=this.serieList.findIndex(e=>e.name===t.activity_name);s>=0?this.serieList[s].data.push({x:t.tasker_name,y:[t.date_ini,t.date_end],meta:t._id}):this.serieList.push({name:t.activity_name,data:[{x:t.tasker_name,y:[t.date_ini,t.date_end],meta:t._id}]})}),this.cleanSeries()}timeLineTCostumerPivot(){this.data.forEach(t=>{const s=this.serieList.findIndex(e=>e.name===t.costumer_name);s>=0?this.serieList[s].data.push({x:t.tasker_name,y:[t.date_ini,t.date_end],meta:t._id}):this.serieList.push({name:t.costumer_name,data:[{x:t.tasker_name,y:[t.date_ini,t.date_end],meta:t._id}]})}),this.cleanSeries()}timeLineProductPivot(){(!this.prod_list||0===this.prod_list.length)&&(this.prod_list=[],this.data.forEach(t=>{t.crm_products&&t.crm_products.length>0&&this.prod_list.push(...t.crm_products)}),this.prod_list=[...new Set(this.prod_list)]),this.prod_list.forEach(t=>{this.serieList.push({name:t,data:[]})}),this.data.forEach(t=>{const s=this.serieList.findIndex(e=>t.crm_products.find(i=>e.name===i));s>=0?this.serieList[s].data.push({x:t.tasker_name,y:[t.date_ini,t.date_end],meta:t._id}):this.serieList.push({name:t.costumer_name,data:[{x:t.tasker_name,y:[t.date_ini,t.date_end],meta:t._id}]})}),this.cleanSeries()}onSelectEvent(t){var s=this;return(0,f.Z)(function*(){s.onSelect.emit(t)})()}cleanSeries(){this.serieList.forEach(t=>{let s=0;for(;s<t.data.length;)0===t.data[s].y.length?t.data.splice(s,1):s++})}static#t=this.\u0275fac=function(s){return new(s||h)};static#e=this.\u0275cmp=o.Xpm({type:h,selectors:[["app-time-line"]],viewQuery:function(s,e){if(1&s&&o.Gf(x,5),2&s){let i;o.iGM(i=o.CRH())&&(e.chart=i.first)}},inputs:{data:"data",prod_list:"prod_list",pivot:"pivot",bartype:"bartype"},outputs:{onSelect:"onSelect"},features:[o.TTD],decls:1,vars:1,consts:[["id","chart",4,"ngIf"],["id","chart"],[3,"series","chart","fill","legend","plotOptions","xaxis","tooltip"]],template:function(s,e){1&s&&o.YNc(0,L,2,7,"div",0),2&s&&o.Q6J("ngIf",e.data&&e.data.length>0)},dependencies:[m.O5,y.x]})}return h})()},6483:(b,E,n)=>{n.d(E,{q:()=>h});var f=n(7087),o=n(3759),m=n(9554),y=n(2283);const x=[{path:"",component:m.g}];let L=(()=>{class u{static#t=this.\u0275fac=function(e){return new(e||u)};static#e=this.\u0275mod=y.oAB({type:u});static#i=this.\u0275inj=y.cJS({imports:[o.Bz.forChild(x),o.Bz]})}return u})();var O=n(3279);let h=(()=>{class u{static#t=this.\u0275fac=function(e){return new(e||u)};static#e=this.\u0275mod=y.oAB({type:u});static#i=this.\u0275inj=y.cJS({imports:[f.ez,L,O.X]})}return u})()},4537:(b,E,n)=>{n.d(E,{x:()=>u});var f=n(3241),o=n(4344),m=n(2283),y=n(4758),x=n(6806),L=n(1359),O=n(6510),h=n(3620);let u=(()=>{class t{constructor(e,i,a,r,d){this.sharedvar=e,this.dtb=i,this.snkBar=a,this.dg=r,this.ds=d,this.schemaAppoint={controls:[{name:"staff",label:"Responsable:",type:"select",selectOptions:[],validators:{required:!0}},{name:"datetime",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}},{name:"dateend",label:"Fecha y hora final sugerida:",type:"datetime-local",sideBtn:"more_time",validators:{required:!0}},{name:"notes",label:"Notas:",type:"textarea",totalRows:4,style:"w-full",validators:{required:!0}},{name:"costumer",label:"Cliente",type:"text",sideBtn:"people",style:"w-full",validators:{}},{name:"contact",label:"Contacto",type:"text",style:"w-full",validators:{}},{name:"address",label:"Direcci\xf3n",type:"text",style:"w-full",validators:{}},{name:"geoLoc",label:"Geolocalizaci\xf3n",type:"text",style:"w-full",sideBtn:"room",validators:{}},{name:"pollgrp_id",label:"Tarea a ejecutar:",type:"select",style:"w-full",selectOptions:[],validators:{}}]},this.groupRefTrue=[]}startAppointData(e){if(this.staffList=e,this.getGroupRef(),this.schemaAppoint.controls){const i=this.schemaAppoint.controls.find(r=>"pollgrp_id"===r.name);i&&(i.selectOptions=this.groupRefTrue);const a=this.schemaAppoint.controls.find(r=>"staff"===r.name);a&&(a.selectOptions=[],e.forEach(r=>{r._id&&a.selectOptions?.push({key:r._id,value:`${r.names} ${r.lastnames}`})}))}}getPollGrpName(e){if(e){const i=this.groupRefTrue.find(a=>a.key===e);if(i)return i.value}return""}getGroupRef(){this.groupRefTrue=[],this.getRefNodeTrue(this.sharedvar.pollGroupIndex)}getRefNodeTrue(e){if(e.children)for(let i=0;i<e.children.length;i++){const a=e.children[i];if(a.ref)this.groupRefTrue.push({key:a.id,value:a.model_name||a.name});else if(a.children&&a.children.length>0)return this.getRefNodeTrue(a)}}onDelAppoint(e,i){!e.appoint||0===e.appoint.length||this.snkBar.open("Eliminar item de la agenda?.","Ok",{duration:5e3}).onAction().subscribe(a=>{e.appoint?.splice(i,1),this.dtb.updateStaffAsync(e)})}onAddEditAppoint(e,i){var a=this;let r,d,A="Agenda ";const v=null===e||-1===i;null==e&&(e=this.staffList[0]),e.appoint||(e.appoint=[]),d=-1===i?{datetime:this.sharedvar.dateNow(),dateend:this.sharedvar.dateNow()+this.sharedvar.addMinutes(30),ended:!1}:e.appoint[i],A+=v?"Nueva":`${e.names} ${e.lastnames||""}`;const p=this.schemaAppoint.controls?.findIndex(_=>"contact"===_.name);if(p&&p>=0&&this.schemaAppoint.controls&&(this.schemaAppoint.controls[p].type="text"),this.schemaAppoint.controls){const _=this.schemaAppoint.controls.findIndex(l=>"staff"===l.name);_>=0&&(this.schemaAppoint.controls[_].disabled=!v)}e.appoint&&d&&(r={staff:e._id,...d}),this.dg.aDefault({schema:this.schemaAppoint,title:A,value:r,dgwidth:400,function:[{name:"costumer",self:this,function:this.getCostumer1},{name:"dateend",self:this,function:this.addTime}]}).subscribe(function(){var _=(0,f.Z)(function*(l){if(l){const g=a.staffList.find(C=>C._id==l.staff);if(!g)return;g.appoint||(g.appoint=[]),0===l.dateend&&(l.dateend=l.datetime+a.sharedvar.addMinutes(30)),delete l._btnEvent_,delete l._btnclick_,delete l._propName_,delete l._valid_,delete l.staff,a.dg.updatePropResult(d,l),d.pollgrp_model_name=a.getPollGrpName(l.pollgrp_id),v?g.appoint.push(d):g.appoint[i]=d,a.dtb.updateStaffAsync(g)}});return function(l){return _.apply(this,arguments)}}())}getCostumer1(e,i,a){return(0,f.Z)(function*(){if(!i)return;const r=[],d=yield e.dtb.getActiveCRMCostumAsync();if(!d)return;d.forEach(p=>{p&&r.push({selected:!1,myid:p.id,name:p.name})});const A={title:"Seleccione Cliente",dgheigth:450,viewfilter:!0,viewAdd:!1,multiSelect:!0,valuelst:r},v=yield(0,o.z)(e.ds.aSelectDefault(A));if(v){i.costumer=v[0].name;const p=a.controls?.findIndex(c=>"contact"===c.name);if(p&&p>=0&&a.controls){const c=d.find(l=>l.name===v[0].name),_=[];c?.linkup_1&&_.push({key:c.linkup_1,value:c.linkup_1}),c?.linkup_2&&_.push({key:c?.linkup_2,value:c?.linkup_2}),a.controls[p].type="select",a.controls[p].selectOptions=_}}return{schema:a,value:i}})()}addTime(e,i,a){return(0,f.Z)(function*(){if(i)return i.dateend=Number(i.datetime)+e.sharedvar.addMinutes(30),{schema:null,value:i}})()}onFilter(e){}static#t=this.\u0275fac=function(i){return new(i||t)(m.LFG(y.D),m.LFG(x.k),m.LFG(L.ux),m.LFG(O.x),m.LFG(h.n))};static#e=this.\u0275prov=m.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})()},1348:b=>{b.exports=JSON.parse('{"controls":[{"name":"id","label":"Identificaci\xf3n:","type":"text","validators":{"required":true}},{"name":"names","label":"Nombre (s):","type":"text","style":"w-3/4","validators":{"required":true}},{"name":"lastnames","label":"Apellidos (s):","type":"text","style":"w-3/4","validators":{"required":true}},{"name":"city","label":"Ciudad de residencia","type":"text","style":"w-3/4","validators":{"required":true}},{"name":"email","label":"Correo electr\xf3nico","type":"text","style":"w-3/4","validators":{"required":true}},{"name":"phone","label":"Tel\xe9fono","type":"tel","validators":{"required":true}},{"name":"rol","label":"Permiso para editar","type":"multiselect","style":"w-full","validators":{"required":true},"selectOptions":[{"key":"K","value":"Es Tasker"},{"key":"P","value":"Es Administrador"},{"key":"F","value":"Edita tasker"},{"key":"U","value":"Edita usuaro"},{"key":"D","value":"Edita directorio"}]},{"name":"legal_acceptance","label":"Acepto t\xe9rminos de la ley 1581.","type":"checkbox","validators":{"required":true}},{"name":"active","label":"Activo.","type":"checkbox","validators":{"required":true}}]}')}}]);