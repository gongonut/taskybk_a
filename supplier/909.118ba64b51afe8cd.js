"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[909],{3909:(gt,C,a)=>{a.r(C),a.d(C,{ProdListModule:()=>ht});var u=a(7087),h=a(3759),p=a(3241),t=a(2283),y=a(4758),w=a(6806),I=a(8937),P=a(5061),T=a(1359),J=a(2312),Z=a(9666),N=a(3578),m=a(8464),g=a(6410),v=a(9347),U=a(4344),D=a(5499),x=a(7387);function $(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"mat-chip-option",9),t.NdJ("removed",function(){const r=t.CHM(e).index,n=t.oxw();return t.KtG(n.removeCateg(r))})("click",function(){const r=t.CHM(e).$implicit,n=t.oxw();return t.KtG(n.editSelectCateg(r))}),t._uU(1),t.TgZ(2,"button",10)(3,"mat-icon"),t._uU(4,"cancel"),t.qZA()()()}if(2&s){const e=l.$implicit;t.xp6(1),t.hij(" ",e.value," ")}}function B(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"div",17)(2,"app-dynamic-form",18),t.NdJ("result",function(o){t.CHM(e);const r=t.oxw().index,n=t.oxw(2);return t.KtG(n.onGetProdEditCharData(o,r))}),t.qZA()()()}if(2&s){const e=t.oxw(3);t.xp6(2),t.Q6J("jsonFormData",e.prodEditCharDataSchema)("values",e.prodEditCharData)("reset",e.prodDataReset)}}function M(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"div",13)(2,"div",14),t.NdJ("click",function(){const r=t.CHM(e).index,n=t.oxw(2);return t.KtG(n.expandElements(r))}),t._uU(3),t.qZA(),t.TgZ(4,"mat-icon",15),t.NdJ("click",function(){const r=t.CHM(e).index,n=t.oxw(2);return t.KtG(n.expandElements(r))}),t._uU(5,"expand_more"),t.qZA()(),t.YNc(6,B,3,3,"div",16),t.qZA()}if(2&s){const e=l.$implicit,i=l.index,o=t.oxw(2);t.xp6(3),t.Oqu(e.header),t.xp6(3),t.Q6J("ngIf",o.getElementVisible(i))}}function O(s,l){if(1&s&&(t.TgZ(0,"div",11),t.YNc(1,M,7,2,"div",12),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.category2show.characterList)}}var _=(()=>{return(s=_||(_={}))[s.all=0]="all",s[s.product=1]="product",s[s.subproduct=2]="subproduct",_;var s})();let L=(()=>{class s{constructor(e,i,o,r,n){this.sharedvar=e,this.dtb=i,this.dg=o,this.snkBar=r,this.prodserv=n,this.prodEditCharDataSchema={controls:[]},this.showtype=_.all,this.show_area="",this.elementView=-1,this.prodEditCharData={},this.subFilter=[],this.prodDataReset=0}ngOnChanges(){this.show_area="",this.category2show=null,this.elementView=-1}getTitle(){return this.showtype===_.product?"Detalles del Producto":this.showtype===_.subproduct?"Campos de filtro subproductos":"Productos y Subproductos"}removeCateg(e){var i=this;return(0,p.Z)(function*(){i.snkBar.open(`\xbfEliminar ${i.product.categIds[e].value}?`,"Ok",{duration:5e3}).onAction().subscribe(function(){var o=(0,p.Z)(function*(r){const n=i.product.categIds&&i.product.categIds[e].key?i.product.categIds[e].key:"";if(n.length>0&&i.product.optList){let d=0;for(;d<i.product.optList.length;){const c=i.product.optList[d];c.catid&&c.catid!==n?d++:i.product.optList.splice(d,1)}}i.product.categIds?.splice(e,1),yield i.prodserv.updateProd(i.product)});return function(r){return o.apply(this,arguments)}}())})()}getCategList(){var e=this;return(0,p.Z)(function*(){let o={value:yield e.prodserv.getAllShortCategAsync(),title:"Seleccione Categor\xeda",dgwidth:400,dgheigth:600};const n=(yield(0,U.z)(e.dg.aNestedSelect(o))).data;if(n&&n.length>0){let d=[];n.forEach(f=>d.push(f.key)),(yield e.prodserv.getCategListAsync(d.join(","))).forEach(f=>{e.product.optList||(e.product.optList=[]),f.characterList.forEach(b=>{-1===e.product.optList.findIndex(mt=>mt.catid==f._id)&&(e.product.optList=[...e.product.optList,...e.setElem(b)])})}),e.product.categIds=[...e.product.categIds,...n],e.product.categIds=e.avoidGRDdup(e.product.categIds),yield e.prodserv.updateProd(e.product)}})()}onGetProdEditCharData(e,i){var o=this;return(0,p.Z)(function*(){if(e._btnclick_||e._btnclick_2_){const n=o.product.optList.findIndex(c=>c.optid===e._propName_),d=o.category2show.characterList[i].data.find(c=>e._propName_===c.id);n>-1&&d&&d.type.includes("_list")&&e._btnclick_&&console.log(o.product.optList[n])}const r=e._propName_;if(r.length>0&&o.product.optList){let n=o.product.optList.findIndex(c=>c.optid===r);const d=o.category2show.characterList[i].data.find(c=>c.id===r);n>=0?o.product.optList[n].value=e[r]:o.product.optList?.push({catid:o.category2show._id,optid:r,opt_name:d?.name,value:e[r]}),!0===d?.add2subfilter&&(o.product.prodXFilterList||(o.product.prodXFilterList=[]),o.product.prodXFilterList.forEach(c=>{-1!==c.indexOf(`ct_${d?.name}:`)&&o.product.prodXFilterList.splice(o.product.prodXFilterList.indexOf(c),1)}),e[r].array.forEach(c=>{-1===o.product.prodXFilterList.indexOf(`ct_${d?.name}:${c.value}`)&&o.product.prodXFilterList.push(`ct_${d?.name}:${c.value}`)})),o.setValue2Table(o.product,d?.type,e[r])}console.log(o.product),yield o.prodserv.updateProd(o.product)})()}editSelectCateg(e){var i=this;return(0,p.Z)(function*(){i.category2show=yield i.prodserv.getCategAsync(e.key)})()}updaSetElem(e,i=[]){return e.data.forEach(o=>{const r=i.findIndex(d=>d.optid===o.id),n={catid:e.cat_id,char_id:e.id,optid:o.id,opt_name:o.name,source:this.getDataSource(o.type),selectlist:o.selectlist||[]};r>=0?i[r]=n:i.push(n)}),i}expandElements(e){if(e===this.elementView)this.elementView=-1;else{const i=this.category2show.characterList[e];this.prodEditCharDataSchema.controls=[];let o=!1;i.data.forEach(r=>{if(!0===r.add2subfilter&&this.showtype===_.product||!1===r.add2subfilter&&this.showtype===_.subproduct)return;const n=r.id;let d=this.getCharCtrl(r);const c=this.getValueFromTable(this.product,r,this.prodEditCharData[n]);this.prodEditCharData[r.id]=c.value,o=c.tosave||o,this.prodEditCharDataSchema.controls?.push(d)}),this.elementView=e,o&&this.prodserv.updateProd(this.product)}}getValueFromTable(e,i,o){let r=!1;if(i.type.includes("prod_"))switch(i.type){case"prod_price":r=e.price?.toString()!==o,o=this.getFieldValue(e,"price",i.id,o);break;case"prod_tax_p":r=e.tax_p?.toString()!==o,o=this.getFieldValue(e,"tax_p",i.id,o);break;case"prod_stock":r=e.stock?.toString()!==o,o=this.getFieldValue(e,"stock",i.id,o);break;case"prod_stars":r=e.stars?.toString()!==o,o=this.getFieldValue(e,"stars",i.id,o);break;case"prod_chip":r=e.chip?.toString()!==o,o=this.getFieldValue(e,"chip",i.id,o);break;case"prod_code":r=e.code?.toString()!==o,o=this.getFieldValue(e,"code",i.id,o);break;case"prod_description":r=e.description?.toString()!==o,o=this.getFieldValue(e,"description",i.id,o);break;case"prod_description_long":r=e.description_long?.toString()!==o,o=this.getFieldValue(e,"description_long",i.id,o)}else o=this.getValue(e,i.id,o);return{value:o,tosave:r}}getFieldValue(e,i="",o,r){const n=e.optList?.find(c=>c.optid===o),d=e[i];return d?(n.value=d,d):n?.value?(e[i]=n.value,n.value):(n.value=r,e[i]=r,r)}getValue(e,i,o){const r=e.optList?.find(n=>n.optid===i);return r?.value?r.value:(r.value=o,o)}setValue2Table(e,i,o){if(i&&i.includes("prod_"))switch(i){case"prod_price":return e.price=+o;case"prod_tax_p":return e.tax_p=+o;case"prod_stock":return e.stock=+o;case"prod_stars":return e.stars=+o;case"prod_chip":return e.chip=o?.toString();case"prod_code":return e.code=o?.toString();case"prod_description":return e.description=o?.toString();case"prod_description_long":return e.description_long=o?.toString()}}getElementVisible(e){return this.elementView===e}getCharCtrl(e){let i="textarea",o="",r="",n="",d="w-full",c={},b=[];switch(e.type){case"prod_code":case"prod_name":case"text":case"box":i="text";break;case"image":i="header",n=`Editar: ${e.title}      `,d="w-full font-medium",o="add",r="delete",i="picture",c.pictheight="500",c.pictwidth="500";break;case"image_carrousel":i="header",n=`Editar: ${e.title}      `,d="w-full font-medium",o="description",r="photo_library";break;case"circle":i="picture",c.pictheight="100",c.pictwidth="100",o="add",r="delete";break;case"geolocation":i="geolocation";break;case"checkbox":i="checkbox",o="";break;case"prod_stock":case"prod_tax_p":case"prod_price":case"prod_star":case"number":i="number"}return e.selectlist&&e.selectlist.length>0&&(b=this.fillSelectlist(e.selectlist),i="multiselect",o="list"),this.subFilter.findIndex(F=>F.subfilterlist.includes(e.id))>-1&&(r="menu_open"),{name:e.id,type:i,label:e.title,default:n,validators:{required:!0},selectOptions:b,tags:c,style:d,totalRows:5,sideBtn:o,sideBtn2:r}}fillSelectlist(e){const i=[];return e.forEach(o=>i.push({key:o,value:o})),i}setElem(e){const i=[];return e.data.forEach(o=>{i.push({catid:e.cat_id,optid:o.id,opt_name:o.name,source:this.getDataSource(o.type)})}),i}getDataSource(e){return e&&e.includes("prod_")?e.substring(5,e.length):"none"}avoidGRDdup(e){return e.filter((i,o)=>{const r=i.key;return o===e.findIndex(n=>n.key===r)})}SelCharOptionList(e,i){return(0,p.Z)(function*(){})()}static#t=this.\u0275fac=function(i){return new(i||s)(t.Y36(y.D),t.Y36(w.k),t.Y36(P.x),t.Y36(T.ux),t.Y36(Z.M))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-prod-cat-deta"]],inputs:{product:"product",showtype:"showtype"},features:[t.TTD],decls:14,vars:3,consts:[[1,"px-2","flex","flex-col","gap-2","bg-gray-100","overflow-auto"],[1,"flex","items-center","font-medium"],[1,"grow","ml-2","border-t","border-gray-500"],[1,"flex","ml-2","h-12"],[1,"grow"],[3,"removed","click",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],["color","primary"],["class","ml-4",4,"ngIf"],[3,"removed","click"],["matChipRemove",""],[1,"ml-4"],[4,"ngFor","ngForOf"],[1,"flex","justify-start","p-1","text-violet-900","font-medium","bg-violet-200","hover:text-violet-400"],[1,"grow",3,"click"],[3,"click"],[4,"ngIf"],[1,"ml-2","p-1","bg-gray-100","text-sm"],[1,"flex-1","p-1","mt-2",3,"jsonFormData","values","reset","result"]],template:function(i,o){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div"),t._uU(3),t.qZA(),t._UZ(4,"div",2),t.qZA(),t.TgZ(5,"div",3)(6,"div",4)(7,"mat-chip-listbox"),t.YNc(8,$,5,1,"mat-chip-option",5),t.qZA()(),t.TgZ(9,"div")(10,"button",6),t.NdJ("click",function(){return o.getCategList()}),t.TgZ(11,"mat-icon",7),t._uU(12,"list"),t.qZA()()()(),t.YNc(13,O,2,1,"div",8),t.qZA()),2&i&&(t.xp6(3),t.Oqu(o.getTitle()),t.xp6(5),t.Q6J("ngForOf",o.product.categIds),t.xp6(5),t.Q6J("ngIf",o.category2show))},dependencies:[u.sg,u.O5,m.Hw,D.r,g.lW,x.z2,x.iO,x.qH]})}return s})();var G=a(4072),S=a(6302);function H(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",9)(1,"mat-checkbox",10),t.NdJ("change",function(o){t.CHM(e);const r=t.oxw();return t.KtG(r.onShowSelected(o.checked))}),t._uU(2,"Mostrar seleccionados"),t.qZA()()}}let k=(()=>{class s{constructor(e,i){this.dtb=e,this.sharedvar=i,this.changePictProduct=new t.vpe,this.changePictSubproduct=new t.vpe,this.showAll=!0,this.imageSchema={controls:[{label:"Subir Imagen/Foto",name:"picture",validators:{},type:"picture",tags:{pictheight:"500",pictwidth:"500"}},{label:"Desde v\xednculo remoto",name:"remote_link",validators:{},type:"text",style:"w-full"}]},this.reset=0,this.valueList=[],this.ngOnChanges()}ngOnChanges(){this.valueList=[],this.product&&(this.product.pictures&&this.product.pictures.length>0?this.data2Show():(this.valueList.push({picture:"",remote_link:""}),this.reset++),this.subproduct&&this.imageSchema.controls.length<=2&&(this.imageSchema.controls.push({label:"Incluir imagen/Foto",name:"select",validators:{},type:"checkbox"}),this.getSubprodPictlist()),!this.subproduct&&this.imageSchema.controls.length>2&&this.imageSchema.controls.splice(2,1))}data2Show(){return this.valueList=[],this.showAll&&this.product.pictures&&this.product.pictures.length>0?this.product.pictures.forEach(e=>this.valueList.push({picture:e,remote_link:e})):!this.showAll&&this.subproduct&&this.subproduct.pictures&&this.subproduct.pictures.length>0&&this.subproduct.pictures.forEach(e=>this.valueList.push({picture:e,remote_link:e,select:!0})),this.valueList}onHeaderAddClick(){this.valueList.push({picture:"",remote_link:""}),this.valueList=JSON.parse(JSON.stringify(this.valueList)),console.log(this.valueList)}onGetData(e){var i=this;return(0,p.Z)(function*(){if(!0===e.state.delete){const o=e.valueList[e.index].picture;yield i.dtb.deleteFiles(o),e.valueList.splice(e.index,1),i.setSubprodPictlist(e)}if(e._propName_&&"picture"===e._propName_){let o="";e.valueList[e.index].remote_link.includes(i.sharedvar.TASKY_SERVER)&&(o=e.valueList[e.index].remote_link);const r=yield i.uploadImage(e.valueList[e.index].picture,o);e.valueList[e.index].remote_link=r,e.valueList[e.index].picture=r}e._propName_&&"select"===e._propName_&&i.setSubprodPictlist(e),e.index>=0&&(i.valueList=JSON.parse(JSON.stringify(e.valueList))),i.changePictProduct.emit(e)})()}uploadImage(e,i=""){var o=this;return(0,p.Z)(function*(){i.length>0&&(yield o.dtb.deleteFiles(i));let r=`P_${o.product._id}_${o.sharedvar.getSerialKey(2,4)}.jpeg`,n="";return n=e.substring(22,e.length),yield o.dtb.uploadFiles("products",[{file_name:`products/${r}`,data:o.sharedvar.b64toBlob(n,"image/jpeg")}]),`${o.sharedvar.TASKY_SERVER}${o.sharedvar.TASKY_PICTURES_2IO}products${o.sharedvar.SLASH_ESCAPE}${r}`})()}setSubprodPictlist(e){this.subproduct&&this.valueList.length>0&&(this.subproduct.pictures=[],this.valueList.forEach(i=>{!0===i.select&&this.subproduct.pictures.push(i.picture)}),this.changePictSubproduct.emit(e))}getSubprodPictlist(){this.subproduct&&this.subproduct.pictures&&this.valueList&&this.valueList.forEach(e=>{e.select=this.subproduct.pictures.includes(e.picture)})}onShowSelected(e){this.showAll=!e,this.data2Show()}static#t=this.\u0275fac=function(i){return new(i||s)(t.Y36(w.k),t.Y36(y.D))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-prod-image-list"]],inputs:{product:"product",subproduct:"subproduct"},outputs:{changePictProduct:"changePictProduct",changePictSubproduct:"changePictSubproduct"},features:[t.TTD],decls:12,vars:6,consts:[[1,"px-2","flex","flex-col","gap-2","bg-gray-100","overflow-auto"],[1,"flex","flex-row","items-center","font-medium"],[1,"grow","ml-2","border-t","border-gray-500"],[1,"flex","flex-row","justify-end"],["class","grow",4,"ngIf"],["mat-stroked-button","",3,"click"],["matTooltip","Agregar"],[1,"flex-1","px-2","pt-3","mt-1","overflow-auto"],[3,"schema","valuesList","reset","setValueByIndex","delButton","resultByIndex"],[1,"grow"],[3,"change"]],template:function(i,o){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div"),t._uU(3,"Lista de im\xe1genes"),t.qZA(),t._UZ(4,"div",2),t.qZA(),t.TgZ(5,"div",3),t.YNc(6,H,3,0,"div",4),t.TgZ(7,"button",5),t.NdJ("click",function(){return o.onHeaderAddClick()}),t.TgZ(8,"mat-icon",6),t._uU(9,"add"),t.qZA()()(),t.TgZ(10,"div",7)(11,"app-multi-dynamic",8),t.NdJ("resultByIndex",function(n){return o.onGetData(n)}),t.qZA()()()),2&i&&(t.xp6(6),t.Q6J("ngIf",o.subproduct),t.xp6(5),t.Q6J("schema",o.imageSchema)("valuesList",o.valueList)("reset",o.reset)("setValueByIndex",o.setValueByIndex)("delButton","delete"))},dependencies:[u.O5,m.Hw,G.W,g.lW,S.oG]})}return s})();var Y=a(938);const q=["editControlTrigger"],V=["excelUpload"],Q=["imagesUpload"];function R(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",21),t._UZ(1,"img",22),t.TgZ(2,"div",23)(3,"div"),t._uU(4),t.qZA(),t.TgZ(5,"div",24)(6,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return t.KtG(r.SetExpand(o,"prodeta"))}),t._uU(7,"edit"),t.qZA(),t.TgZ(8,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return t.KtG(r.SetExpand(o,"subproducts"))}),t._uU(9,"list"),t.qZA(),t.TgZ(10,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return t.KtG(r.SetExpand(o,"imagelist"))}),t._uU(11,"collections"),t.qZA(),t.TgZ(12,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return t.KtG(r.SetExpand(o,"calculate"))}),t._uU(13,"add_shopping_cart"),t.qZA(),t._uU(14," \xa0 "),t.TgZ(15,"mat-icon",26),t._uU(16,"delete"),t.qZA()()()()}if(2&s){const e=t.oxw().$implicit,i=t.oxw();t.xp6(1),t.Q6J("src",i.getPicture(e),t.LSH),t.xp6(3),t.Oqu(e.description),t.xp6(2),t.Tol(i.getButtonStyle(e._id,"prodeta",!1)),t.xp6(2),t.Tol(i.getButtonStyle(e._id,"subproducts",!1)),t.xp6(2),t.Tol(i.getButtonStyle(e._id,"imagelist",!1)),t.xp6(2),t.Tol(i.getButtonStyle(e._id,"calculate",!1))}}function j(s,l){if(1&s&&(t.TgZ(0,"div",27),t._UZ(1,"app-prod-cat-deta",28),t.qZA()),2&s){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("product",e)("showtype",1)}}function K(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",21),t._UZ(1,"img",22),t.TgZ(2,"div",23)(3,"div"),t._uU(4),t.qZA(),t.TgZ(5,"div",24)(6,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw(3);return t.KtG(r.setSubExpand(o._id,"prodeta"))}),t._uU(7,"edit"),t.qZA(),t.TgZ(8,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw(3);return t.KtG(r.setSubExpand(o._id,"filter"))}),t._uU(9,"account_tree"),t.qZA(),t.TgZ(10,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw(3);return t.KtG(r.setSubExpand(o._id,"imagelist"))}),t._uU(11,"collections"),t.qZA(),t._uU(12," \xa0 "),t.TgZ(13,"mat-icon",26),t._uU(14,"delete"),t.qZA()()()()}if(2&s){const e=t.oxw().$implicit,i=t.oxw(3);t.xp6(1),t.Q6J("src",i.getPicture(e),t.LSH),t.xp6(3),t.Oqu(e.description),t.xp6(2),t.Tol(i.getButtonStyle(e._id,"prodeta",!0)),t.xp6(2),t.Tol(i.getButtonStyle(e._id,"filter",!0)),t.xp6(2),t.Tol(i.getButtonStyle(e._id,"imagelist",!0))}}function z(s,l){if(1&s&&(t.TgZ(0,"div",27),t._UZ(1,"app-prod-cat-deta",28),t.qZA()),2&s){const e=t.oxw().$implicit,i=t.oxw(3);t.xp6(1),t.Q6J("product",e)("showtype",i.getSubType())}}function X(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",29)(1,"div",37)(2,"app-prod-image-list",38),t.NdJ("changePictProduct",function(o){t.CHM(e);const r=t.oxw(3).$implicit,n=t.oxw();return t.KtG(n.editPictProduct(o,r))})("changePictSubproduct",function(o){t.CHM(e);const r=t.oxw().$implicit,n=t.oxw(3);return t.KtG(n.editPictSubproduct(o,r))}),t.qZA()()()}if(2&s){const e=t.oxw().$implicit,i=t.oxw(2).$implicit;t.xp6(2),t.Q6J("product",i)("subproduct",e)}}function W(s,l){if(1&s&&(t.TgZ(0,"div",35)(1,"div",36),t.YNc(2,K,15,8,"div",18),t.YNc(3,z,2,2,"div",19),t.YNc(4,X,3,2,"div",20),t.qZA()()),2&s){const e=l.$implicit,i=t.oxw(3);t.xp6(2),t.Q6J("ngIf",i.getSubprodFilter(e)),t.xp6(1),t.Q6J("ngIf",i.getSubExpand(e._id,"filter_prodeta")),t.xp6(1),t.Q6J("ngIf",i.getSubExpand(e._id,"imagelist"))}}function tt(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",29)(1,"div",30)(2,"div"),t._uU(3,"Sub productos"),t.qZA(),t._UZ(4,"div",31),t.qZA(),t.TgZ(5,"div",32)(6,"button",33),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().index,r=t.oxw();return t.KtG(r.addSubProduct(o))}),t.TgZ(7,"mat-icon",8),t._uU(8,"add"),t.qZA()()(),t.YNc(9,W,5,3,"div",34),t.qZA()}if(2&s){const e=t.oxw(2);t.xp6(9),t.Q6J("ngForOf",e.subprodList)}}function et(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",29)(1,"div",37)(2,"app-prod-image-list",39),t.NdJ("changePictProduct",function(o){t.CHM(e);const r=t.oxw().$implicit,n=t.oxw();return t.KtG(n.editPictProduct(o,r))}),t.qZA()()()}if(2&s){const e=t.oxw().$implicit;t.xp6(2),t.Q6J("product",e)}}function it(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",29)(1,"div",37)(2,"app-shopping-cond",40),t.NdJ("change",function(o){t.CHM(e);const r=t.oxw().$implicit,n=t.oxw();return t.KtG(n.editShoppingProduct(o,r))}),t.qZA()()()}if(2&s){const e=t.oxw().$implicit,i=t.oxw();t.xp6(2),t.Q6J("product",e)("category",i.category2show)("subfilterlist",i.categ2SubFilter)("categList",i.categ_list)}}function ot(s,l){if(1&s&&(t.TgZ(0,"div",17),t.YNc(1,R,17,10,"div",18),t.YNc(2,j,2,2,"div",19),t.YNc(3,tt,10,1,"div",20),t.YNc(4,et,3,1,"div",20),t.YNc(5,it,3,4,"div",20),t.qZA()),2&s){const e=l.$implicit,i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.getProdFilter(e)),t.xp6(1),t.Q6J("ngIf",i.getExpand(e._id,"prodeta")),t.xp6(1),t.Q6J("ngIf",i.getExpand(e._id,"subproducts")),t.xp6(1),t.Q6J("ngIf",i.getExpand(e._id,"imagelist")),t.xp6(1),t.Q6J("ngIf",i.getExpand(e._id,"calculate"))}}const rt=[{path:"",component:(()=>{class s{constructor(e,i,o,r,n,d,c){this.sharedvar=e,this.dtb=i,this.sanitizer=o,this.dg=r,this.snkBar=n,this.data2excel=d,this.prodserv=c,this.prodEditCharDataSchema={controls:[]},this.newproduct={controls:[{name:"code",label:"C\xf3digo:",type:"text",style:"w-full",validators:{}},{name:"description",label:"Nombre:",type:"text",style:"w-full",validators:{}},{name:"description_long",label:"Descripci\xf3n:",type:"text",style:"w-full",validators:{}},{name:"price",label:"Precio:",type:"number",validators:{}},{name:"tax_p",label:"Impuesto %:",type:"number",validators:{}},{name:"stock",label:"Existencia:",type:"number",validators:{}}]},this.prodList=[],this.subprodList=[],this.show_product="",this.show_area="",this.elementView=-1,this.prodEditCharData={},this.subFilter=[],this.categ_list=[],this.categ2SubFilter=[],this.prodDataReset=0,this.show_subprod="",this.show_subprod_area=""}ngOnInit(){var e=this;return(0,p.Z)(function*(){e.prodList=yield e.prodserv.getAllCRMProdAsync("parent"),e.categ_list=yield e.prodserv.getCategories()})()}getClicked(e){switch(e.index){case 2:this.newProduct();break;case 4:let i=document.getElementById("spanTrigger");i&&(i.style.display="",i.style.position="absolute",i.style.left=e.pageX+5+"px",i.style.top=e.pageY+5+"px",this.editControlTrigger.openMenu())}}newProduct(){var e=this;return(0,p.Z)(function*(){e.dg.aDefault({schema:e.newproduct,value:{},title:"Nuevo producto",dgwidth:550,dgheigth:615}).subscribe(function(){var o=(0,p.Z)(function*(r){if(r){delete r._valid_,delete r._propName_,r.parent_id="",r.optList=[],r.opt2List=[],r.pictures=[];const n=yield e.prodserv.createProdAsync(r);e.prodList.push(n)}});return function(r){return o.apply(this,arguments)}}())})()}getPicture(e){return"../assets/images/favicon.png"}SetExpand(e,i){var o=this;return(0,p.Z)(function*(){o.show_product===e._id&&o.show_area===i||(o.show_product!==e._id&&(o.subprodList=yield o.prodserv.getAllCRMProdAsync(`subproduct/${e._id}`),o.show_product=e._id,o.prodResult=e,o.getCateg2SubFilter(),""===o.prodResult.code&&(o.prodResult.code=o.prodResult._id||"NONE")),o.show_area=o.show_area!==i?i:"")})()}setSubExpand(e="",i){this.show_subprod!==e||this.show_subprod_area!==i?(this.show_subprod=e,this.show_subprod_area=i):this.show_subprod=""}getButtonStyle(e="",i,o){if(o){if(this.show_subprod_area===i&&this.show_subprod===e)return"hover:text-violet-800 text-violet-500"}else if(this.show_area===i&&this.show_product===e)return"hover:text-violet-800 text-violet-500";return"hover:text-violet-500"}getSubExpand(e="",i){return this.show_subprod===e&&!(!i.includes(this.show_subprod_area)&&this.show_subprod_area!==i)}getSubType(){return"prodeta"===this.show_subprod_area?1:2}getProdFilter(e){return!0}getSubprodFilter(e){return!0}getExpand(e,i){return this.show_product===e&&this.show_area===i}addSubProduct(e){var i=this;return(0,p.Z)(function*(){if(e>=0){const o=i.prodList[e];if(o){const r={...o};delete r._id,r.parent_id=o._id||"";const n=yield i.prodserv.createProdAsync(r);i.subprodList.push(n)}}})()}editPictProduct(e,i){var o=this;return(0,p.Z)(function*(){e.index<0||(i.pictures=[],e.valueList.forEach(r=>{i.pictures?.push(r.remote_link)}),yield o.prodserv.updateProd(i))})()}editShoppingProduct(e,i){var o=this;return(0,p.Z)(function*(){yield o.prodserv.updateProd(i)})()}editPictSubproduct(e,i){var o=this;return(0,p.Z)(function*(){e.index<0||(i.pictures=[],e.valueList.forEach(r=>{!0===r.select&&i.pictures.push(r.remote_link)}),yield o.prodserv.updateProd(i))})()}getCateg2SubFilter(){return this.categ2SubFilter=[],this.prodResult.categIds.forEach(e=>{e.key&&this.categ2SubFilter.push(e.key)}),this.categ2SubFilter}onExcel2Dtb(e){this.excelUpload&&this.excelUpload.nativeElement.click()}onDtb2Excel(){}onAllImgs(){return(0,p.Z)(function*(){})()}onFolder2Dtb(e){this.excelUpload&&this.excelUpload.nativeElement.click()}onExcelFileSelected(e){}fileImagesChangeEvent(e){}static#t=this.\u0275fac=function(i){return new(i||s)(t.Y36(y.D),t.Y36(w.k),t.Y36(I.H7),t.Y36(P.x),t.Y36(T.ux),t.Y36(J.Z),t.Y36(Z.M))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-prod-list"]],viewQuery:function(i,o){if(1&i&&(t.Gf(q,5),t.Gf(V,5),t.Gf(Q,5)),2&i){let r;t.iGM(r=t.CRH())&&(o.editControlTrigger=r.first),t.iGM(r=t.CRH())&&(o.excelUpload=r.first),t.iGM(r=t.CRH())&&(o.imagesUpload=r.first)}},decls:30,vars:4,consts:[[1,"flex","flex-col","max-h-screen"],[3,"buttons","nav_menu","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"flex-1","px-2","flex","flex-col","gap-2","bg-gray-100","overflow-auto"],["class","p-1 flex flex-col justify-between border border-gray-300 rounded shadow-sm bg-white",4,"ngFor","ngForOf"],["products","matMenu"],[1,"font-medium"],["color","primary"],["mat-menu-item","",1,"pl-4",3,"click"],[1,"label"],["type","file","required","","multiple","","accept",".png,.jpg,.gif,.jpeg",3,"change"],[1,"pl-4","my-2"],["color","primary",1,"mt-1"],["mat-menu-item","",3,"click"],["type","file","accept",".xlsx",1,"invisible",3,"change"],["excelUpload",""],[1,"p-1","flex","flex-col","justify-between","border","border-gray-300","rounded","shadow-sm","bg-white"],["class","flex justify-start",4,"ngIf"],["class","p-2 bg-gray-50",4,"ngIf"],["class","px-2 bg-gray-50",4,"ngIf"],[1,"flex","justify-start"],["alt","Product",1,"h-16","w-16","rounded-full","object-fill",3,"src"],[1,"flex-1","flex","flex-col","items-start","px-2","grow"],[1,"text-gray-300"],[3,"click"],[1,"hover:text-red-300"],[1,"p-2","bg-gray-50"],[3,"product","showtype"],[1,"px-2","bg-gray-50"],[1,"flex","items-center","font-medium"],[1,"grow","ml-2","border-t","border-gray-500"],[1,"mb-2","flex","justify-end"],["mat-stroked-button","",3,"click"],["class","flex flex-col mb-2",4,"ngFor","ngForOf"],[1,"flex","flex-col","mb-2"],[1,"ml-5","p-1","flex","flex-col","justify-between","border","border-gray-300","rounded","shadow-sm","bg-white"],[1,"flex-1","px-2","pt-3","mt-1","overflow-auto"],[3,"product","subproduct","changePictProduct","changePictSubproduct"],[3,"product","changePictProduct"],[3,"product","category","subfilterlist","categList","change"]],template:function(i,o){if(1&i&&(t.TgZ(0,"div",0)(1,"app-header",1),t.NdJ("onClicked",function(n){return o.getClicked(n)}),t.qZA(),t._UZ(2,"span",2,3),t.TgZ(4,"div",4),t.YNc(5,ot,6,5,"div",5),t.qZA(),t.TgZ(6,"mat-menu",null,6)(8,"div",7)(9,"mat-icon",8),t._uU(10,"cloud_upload"),t.qZA(),t._uU(11," Base remota "),t.qZA(),t.TgZ(12,"button",9),t.NdJ("click",function(n){return o.onExcel2Dtb(n)}),t._uU(13," Excel hacia DtBase "),t.qZA(),t.TgZ(14,"label",10)(15,"input",11),t.NdJ("change",function(n){return o.fileImagesChangeEvent(n)}),t.qZA(),t.TgZ(16,"span",12),t._uU(17,"Im\xe1genes hacia DtBase"),t.qZA(),t._uU(18,"\xa0\xa0 "),t.qZA(),t._UZ(19,"hr"),t.TgZ(20,"div",7)(21,"mat-icon",13),t._uU(22,"edit"),t.qZA(),t._uU(23," Base local "),t.qZA(),t.TgZ(24,"button",14),t.NdJ("click",function(){return o.onDtb2Excel()}),t._uU(25," Data base hacia Excel "),t.qZA(),t.TgZ(26,"button",14),t.NdJ("click",function(){return o.onAllImgs()}),t._uU(27," Lista de im\xe1genes en la base "),t.qZA()(),t.TgZ(28,"input",15,16),t.NdJ("change",function(n){return o.onExcelFileSelected(n)}),t.qZA()()),2&i){const r=t.MAs(7);t.xp6(1),t.Q6J("buttons","111111")("nav_menu",!1),t.xp6(1),t.Q6J("matMenuTriggerFor",r),t.xp6(3),t.Q6J("ngForOf",o.prodList)}},dependencies:[u.sg,u.O5,N.G,m.Hw,g.lW,v.VK,v.OP,v.p6,L,k,Y.y]})}return s})()}];let st=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[h.Bz.forChild(rt),h.Bz]})}return s})();var E=a(769),A=a(7572);const nt=[{path:"",component:L}];let ct=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[h.Bz.forChild(nt),h.Bz]})}return s})(),dt=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[u.ez,ct,E.O,m.Ps,A.N,g.ot,v.Tx,x.Hi]})}return s})();const at=[{path:"",component:k}];let lt=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[h.Bz.forChild(at),h.Bz]})}return s})();var pt=a(2152);let ut=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[u.ez,lt,m.Ps,pt.r,g.ot,S.p9]})}return s})();var _t=a(1225);let ht=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[u.ez,st,E.O,m.Ps,A.N,g.ot,v.Tx,x.Hi,dt,ut,_t.U]})}return s})()}}]);