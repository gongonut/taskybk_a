"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[709],{7709:(P,M,c)=>{c.r(M),c.d(M,{StaffListModule:()=>K});var v=c(7087),T=c(3759),A=c(3241),b=c(4344),w=c(1348),U=c.t(w,2),t=c(2283),D=c(4758),O=c(6806),N=c(3638),F=c(1359),Z=c(4537),R=c(8035),i=c(9347),n=c(8464),r=c(5559),d=c(3578);const g=["editControlTrigger"],u=["excelUpload"];function C(f,L){if(1&f&&(t.TgZ(0,"div",38)(1,"div")(2,"strong"),t._uU(3,"Contacto:"),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div")(6,"strong"),t._uU(7,"Correo:"),t.qZA(),t._uU(8),t.qZA(),t.TgZ(9,"div")(10,"strong"),t._uU(11,"Tel\xe9fono:"),t.qZA(),t._uU(12),t.qZA(),t.TgZ(13,"div")(14,"strong"),t._uU(15,"Compromiso:"),t.qZA(),t._uU(16),t.qZA(),t.TgZ(17,"div")(18,"strong"),t._uU(19,"Ejecutar:"),t.qZA(),t._uU(20),t.qZA()()),2&f){const e=t.oxw().$implicit;t.xp6(4),t.hij(" ",e.contact,""),t.xp6(4),t.hij(" ",e.email,""),t.xp6(4),t.hij(" ",e.phone,""),t.xp6(4),t.hij(" ",e.notes,""),t.xp6(4),t.hij(" ",e.pollgrp_model_name,"")}}function _(f,L){if(1&f){const e=t.EpF();t.TgZ(0,"div")(1,"div",32)(2,"div",33),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw(3);return t.KtG(l.onHtml2Pdf(a))}),t._uU(3),t.ALo(4,"date"),t.qZA(),t.TgZ(5,"div",34)(6,"mat-icon",35),t.NdJ("click",function(){const a=t.CHM(e).index,l=t.oxw(2).$implicit,h=t.oxw();return t.KtG(h.onDelAppoint(l,a))}),t._uU(7,"delete_otuline"),t.qZA(),t.TgZ(8,"mat-icon",35),t.NdJ("click",function(){const a=t.CHM(e).index,l=t.oxw(2).$implicit,h=t.oxw();return t.KtG(h.onAddEditAppoint(l,a))}),t._uU(9,"edit"),t.qZA(),t.TgZ(10,"mat-icon",36),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw(3);return t.KtG(l.onchangefull(a))}),t._uU(11),t.qZA()()(),t.YNc(12,C,21,5,"div",37),t.qZA()}if(2&f){const e=L.$implicit,o=t.oxw(3);t.xp6(3),t.AsE(" ",t.xi3(4,4,e.datetime,"MMM dd, yyy hh:mm a")," - ",e.crm_costum_name," "),t.xp6(8),t.Oqu(o.getAppIcon(e)),t.xp6(1),t.Q6J("ngIf",e.full)}}function p(f,L){if(1&f){const e=t.EpF();t.TgZ(0,"div",26)(1,"div",27)(2,"div",28),t._uU(3," AGENDA "),t.qZA(),t.TgZ(4,"mat-icon",29),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit,a=t.oxw();return t.KtG(a.onFilter(s))}),t._uU(5,"tune"),t.qZA(),t.TgZ(6,"mat-icon",30),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit,a=t.oxw();return t.KtG(a.onAddEditAppoint(s,-1))}),t._uU(7,"add"),t.qZA()(),t.YNc(8,_,13,7,"div",31),t.qZA()}if(2&f){const e=t.oxw().$implicit;t.xp6(8),t.Q6J("ngForOf",e.appoint)}}const x=function(f){return{"background-color":f}};function m(f,L){if(1&f){const e=t.EpF();t.TgZ(0,"div",10),t._UZ(1,"img",11),t.TgZ(2,"div",12)(3,"div",13),t._uU(4),t.qZA(),t.TgZ(5,"div",14)(6,"div",15)(7,"strong"),t._uU(8,"M\xf3vil:"),t.qZA(),t._uU(9),t.qZA(),t.TgZ(10,"div",16)(11,"strong"),t._uU(12,"Email:"),t.qZA(),t._uU(13),t.qZA(),t.TgZ(14,"div",15)(15,"strong"),t._uU(16,"Calificaci\xf3n:"),t.qZA(),t._uU(17),t.qZA()(),t.TgZ(18,"div",17)(19,"div",18)(20,"span")(21,"mat-icon",19),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.getStaffClicked(a,4))}),t._uU(22,"room"),t.qZA(),t.TgZ(23,"mat-icon",20),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.getStaffClicked(a,5))}),t._uU(24,"forum"),t.qZA(),t.TgZ(25,"mat-icon",21),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.getStaffClicked(a,0))}),t._uU(26,"lock_open"),t.qZA(),t.TgZ(27,"mat-icon",22),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.getStaffClicked(a,1))}),t._uU(28,"edit"),t.qZA(),t.TgZ(29,"mat-icon",23),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.getStaffClicked(a,3))}),t._uU(30,"pending_actions"),t.qZA(),t.TgZ(31,"mat-icon",23),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.getStaffClicked(a,3))}),t._uU(32,"expand_more"),t.qZA(),t._uU(33," \xa0 "),t.TgZ(34,"mat-icon",24),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.getStaffClicked(a,2))}),t._uU(35,"delete"),t.qZA()()()(),t.YNc(36,p,9,1,"div",25),t.qZA()()}if(2&f){const e=L.$implicit,o=t.oxw();t.Q6J("ngStyle",t.VKq(8,x,o.getBackColor(e))),t.xp6(1),t.Q6J("src",o.getPicture(e),t.LSH),t.xp6(3),t.AsE("",e.names," ",e.lastnames||""," "),t.xp6(5),t.hij(" ",e.phone," "),t.xp6(4),t.hij(" ",e.email," "),t.xp6(4),t.hij(" ",e.stars," "),t.xp6(19),t.Q6J("ngIf","A1"===e.tag)}}const G=[{path:"",component:(()=>{class f{constructor(e,o,s,a,l,h,y){this.sharedvar=e,this.dtb=o,this.dg=s,this.snkBar=a,this.route=l,this.staffServ=h,this.notif=y,this.addApp=!1,this.reset=0,this.arol="K",this.loading=!1,this.staffList=[]}ngOnInit(){var e=this;return(0,A.Z)(function*(){e.sub=e.route.params.subscribe(function(){var o=(0,A.Z)(function*(s){e.filter={queryType:3,active:!0,stars:0,rol:e.arol},e.staffList=yield e.dtb.getStaffByFilterAsync(e.filter),e.staffServ.startAppointData(e.staffList),e.reset++,e.arol=s.rol});return function(s){return o.apply(this,arguments)}}()),e.notifSubs()})()}notifSubs(){var o,e=this;this.notifSub=this.notif.getNotif_obs().subscribe({next:(o=(0,A.Z)(function*(s){switch(s.collection){case"staff":break;case"ansgeoloc":if(!s.data)return;const a=e.staffList.find(E=>E._id===s.usert_id),h=[e.staffServ.staff2analitic(0,a,e.staffServ.appointBasic(a,"appoint"))];if(!h)return;h[0].geoLocStart=s.data.geoloc;const y={title:"Geo localizaci\xf3n",dgheigth:600,value:h};yield(0,b.z)(e.dg.aMap(y))}}),function(a){return o.apply(this,arguments)})})}ngOnDestroy(){this.sub&&this.sub.unsubscribe(),this.notifSub&&this.notifSub.unsubscribe()}getBackColor(e){return e.active?"white":"#ffffcc"}getPicture(e){return e.picture&&e.picture.length>0?e.picture:"../assets/images/favicon.png"}getClicked(e){var o=this;return(0,A.Z)(function*(){switch(e.index){case 1:"P"===o.arol&&o.filterDialog();break;case 2:o.onStaff();break;case 3:let s=document.getElementById("spanTrigger");s&&(s.style.display="",s.style.position="absolute",s.style.left=e.pageX+5+"px",s.style.top=e.pageY+5+"px",o.editControlTrigger.openMenu());break;case 4:o.staffList=yield o.dtb.getStaffByFilterAsync(o.filter)}})()}getStaffClicked(e,o){var s=this;switch(o){case 0:this.snkBar.open(`Reiniciar contrase\xf1a: ${e.names} ${e.lastnames||""}?.`,"Ok",{duration:5e3}).onAction().subscribe(l=>{e.password="",this.dtb.updateStaffAsync(e)});break;case 1:this.onStaff(e);break;case 2:if(this.sharedvar.staff._id===e._id)return void this.snkBar.open(`No es posible eliminar al propietario de \xe9sta sesi\xf3n: ${e.names} ${e.lastnames||""}?.`,"Ok",{duration:5e3});this.snkBar.open(`Eliminar tasker: ${e.names} ${e.lastnames||""}?.`,"Ok",{duration:5e3}).onAction().subscribe(function(){var l=(0,A.Z)(function*(h){if(e.active=!1,yield s.dtb.deleteStaffAsync(e._id)){const S=s.staffList.findIndex(E=>E._id===e._id);S>0&&s.staffList.splice(S,1)}});return function(h){return l.apply(this,arguments)}}());break;case 3:e.tag=e.tag="A1"===e.tag?"A0":"A1",this.addApp=!1,this.dtb.updateStaffAsync(e);break;case 4:this.notif.sendCommand({cmd:"geoloc",user_id:this.sharedvar.staff._id,usert_id:e._id,data:{appoint_id:"0"}});break;case 5:this.staffServ.onMessage2(e.names,e._id)}}onStaff(e=null){const o=JSON.parse(JSON.stringify(U));if("K"===this.arol){const l=o.controls.findIndex(h=>"rol"===h.name);l>=0&&o.controls.splice(l,1)}let s=!1;e||(e={},s=!0);let a={schema:o,value:e,title:"Datos del Administrador/Tasker",showImage:!0,image:e.picture,imgwidth:200,imgheight:200,newUsr:s};this.dg.aDefault(a).subscribe(l=>{l&&e&&(this.dg.updatePropResult(e,l),e.rol||(e.rol=[]),"K"===this.arol&&!e.rol.includes(this.arol)&&e.rol.push("K"),e.rol.includes("A")||e.rol.push("A"),a.image&&(e.picture=a.image),this.dtb.setStaff(e).subscribe({next:y=>{e=y;const S=this.staffList.findIndex(E=>E._id===y._id);S>=0?this.staffList[S]=y:this.staffList.push(y)}}),navigator.clipboard.writeText(`${this.sharedvar.TASKY_SERVER}tasker/?staff=${e.email}`).then(y=>{}).catch(y=>alert(y)),this.snkBar.open("V\xednculo al cliente copiado al portapapeles.","Ok",{duration:3e3}))})}onExcel2Dtb(e){this.excelUpload&&this.excelUpload.nativeElement.click()}onExcelFileSelected(e){const o=e.target.files[0];this.loading=!this.loading,this.dtb.upload2Excel("staff",o).subscribe({next:s=>{this.loading=!1,this.snkBar.open("Base de tasker/usuarios actualizada","Ok",{duration:1e4}).onAction().subscribe(a=>{location.reload()})}})}onchangefull(e){e.full=!e.full}onHtml2Pdf(e){var o=this;return(0,A.Z)(function*(){if(void 0===e.pollresult_id)return;const s=yield o.dtb.getPollResultAsync(e.pollresult_id);s&&o.dg.aPollResult({schema:{},value:s,title:"Datos de la encuesta: "+s.staff_name}).subscribe(l=>{})})()}getAppIcon(e){return e.full?"expand_less":"expand_more"}onDelAppoint(e,o){this.staffServ.onDelAppoint(e,o)}onAddEditAppoint(e,o){this.staffServ.onAddEditAppoint(e,o)}onFilter(e){}getPollGrpName(e){return this.getPollGrpName(e)}filterDialog(){var e=this;this.dg.aDefault({schema:{controls:[{name:"active",label:"Estado:",type:"select",validators:{},selectOptions:[{key:"1",value:"Activo"},{key:"0",value:"Inactivo"}]},{name:"rol",label:"Rol:",type:"select",validators:{},selectOptions:[{key:"F",value:"Administrador"},{key:"K",value:"Tasker"}]},{name:"email",label:"Correo electr\xf3nico:",type:"text",style:"w-full",validators:{}}]},title:"Filtros",dgwidth:300,dgheigth:400}).subscribe(function(){var a=(0,A.Z)(function*(l){l&&(e.filter={queryType:3,rol:l.rol,email:l.email},l.active&&(e.filter.active="1"===l.active),e.staffList=yield e.dtb.getStaffByFilterAsync(e.filter))});return function(l){return a.apply(this,arguments)}}())}static#t=this.\u0275fac=function(o){return new(o||f)(t.Y36(D.D),t.Y36(O.k),t.Y36(N.x),t.Y36(F.ux),t.Y36(T.gz),t.Y36(Z.x),t.Y36(R.$))};static#e=this.\u0275cmp=t.Xpm({type:f,selectors:[["app-staff-list"]],viewQuery:function(o,s){if(1&o&&(t.Gf(g,5),t.Gf(u,5)),2&o){let a;t.iGM(a=t.CRH())&&(s.editControlTrigger=a.first),t.iGM(a=t.CRH())&&(s.excelUpload=a.first)}},decls:15,vars:4,consts:[[1,"flex","flex-col","max-h-screen"],[3,"buttons","nav_menu","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"flex-1","flex","flex-col","gap-2","m-2","bg-gray-100","overflow-y-scroll"],["class","w-full p-1 flex flex-row border border-gray-300 rounded shadow-sm",3,"ngStyle",4,"ngFor","ngForOf"],["controlEdit","matMenu"],["mat-menu-item","",3,"click"],["type","file","accept",".xlsx",1,"invisible",3,"change"],["excelUpload",""],[1,"w-full","p-1","flex","flex-row","border","border-gray-300","rounded","shadow-sm",3,"ngStyle"],["alt","aja",1,"h-16","w-16","rounded-full","object-fill",3,"src"],[1,"flex-1","flex","flex-col","items-start","px-2"],[1,"h-6","w-48","overflow-hidden","font-medium","leading-tight"],[1,"flex","flex-row","h-6","mt-1"],[1,"pl-2","h-5","w-48","text-xs","overflow-hidden"],[1,"pl-2","h-5","w-60","text-xs","overflow-hidden"],[1,"w-full","h-8","px-1","border-t","border-gray-300","flex","flex-row","gap-x-4","justify-end","text-gray-300"],[1,"pt-1"],["matTooltip","Ubicaci\xf3n actual",1,"hover:text-violet-500",3,"click"],["matTooltip","Enviar mensaje",1,"hover:text-violet-500",3,"click"],["matTooltip","Reiniciar contrase\xf1a",1,"hover:text-violet-500",3,"click"],["matTooltip","Editar informaci\xf3n del usuario",1,"hover:text-violet-500",3,"click"],["matTooltip","Ver/Ocultar agenda",1,"hover:text-violet-500",3,"click"],["matTooltip","Eliminar usuario",1,"hover:text-red-500",3,"click"],["class","w-full mt-2 bg-gray-50 border-b border-gray-300",4,"ngIf"],[1,"w-full","mt-2","bg-gray-50","border-b","border-gray-300"],[1,"h-6","flex","flex-row","items-end","justify-end","bg-gray-200","text-sm"],[1,"flex-1","ml-1","pt-1","text-sky-700"],["matTooltip","Filtrar agenda",1,"mat-18",3,"click"],["matTooltip","Agregar agenda",1,"text-gray-400","hover:text-sky-700",3,"click"],[4,"ngFor","ngForOf"],[1,"pl-2","flex","flex-row","text-xs","text-sky-700","items-center"],[1,"flex-1","h-6",3,"click"],[1,"text-gray-300"],[1,"text-sm","hover:text-sky-700",3,"click"],[1,"hover:text-sky-700",3,"click"],["class","ml-4 mb-2 p-1 bg-slate-100 text-xs text-gray-600",4,"ngIf"],[1,"ml-4","mb-2","p-1","bg-slate-100","text-xs","text-gray-600"]],template:function(o,s){if(1&o&&(t.TgZ(0,"div",0)(1,"app-header",1),t.NdJ("onClicked",function(l){return s.getClicked(l)}),t.qZA(),t._UZ(2,"span",2,3),t.TgZ(4,"div",4),t.YNc(5,m,37,10,"div",5),t.qZA()(),t.TgZ(6,"mat-menu",null,6)(8,"button",7),t.NdJ("click",function(l){return s.onExcel2Dtb(l)}),t.TgZ(9,"mat-icon"),t._uU(10,"build"),t.qZA(),t._uU(11," Importar de Excel "),t.qZA(),t._UZ(12,"hr"),t.qZA(),t.TgZ(13,"input",8,9),t.NdJ("change",function(l){return s.onExcelFileSelected(l)}),t.qZA()),2&o){const a=t.MAs(7);t.xp6(1),t.Q6J("buttons","111110")("nav_menu",!1),t.xp6(1),t.Q6J("matMenuTriggerFor",a),t.xp6(3),t.Q6J("ngForOf",s.staffList)}},dependencies:[v.sg,v.O5,v.PC,i.VK,i.OP,i.p6,n.Hw,r.gM,d.G,v.uU]})}return f})()}];let $=(()=>{class f{static#t=this.\u0275fac=function(o){return new(o||f)};static#e=this.\u0275mod=t.oAB({type:f});static#i=this.\u0275inj=t.cJS({imports:[T.Bz.forChild(G),T.Bz]})}return f})();var B=c(769),I=c(7572);let K=(()=>{class f{static#t=this.\u0275fac=function(o){return new(o||f)};static#e=this.\u0275mod=t.oAB({type:f});static#i=this.\u0275inj=t.cJS({imports:[v.ez,$,i.Tx,n.Ps,r.AV,B.O,I.N]})}return f})()},4537:(P,M,c)=>{c.d(M,{x:()=>F});var v=c(3241),T=c(4344),A=c(7430),b=c(2283),w=c(4758),U=c(6806),t=c(1359),D=c(3638),O=c(3620),N=c(8035);let F=(()=>{class Z{constructor(i,n,r,d,g,u){this.sharedvar=i,this.dtb=n,this.snkBar=r,this.dg=d,this.ds=g,this.notif=u,this.schemaAppoint={controls:[{name:"staff",label:"Responsable:",type:"select",style:"w-full",selectOptions:[],validators:{required:!0}},{name:"pollgrp_id",label:"Tarea a ejecutar:",type:"select",style:"w-full",selectOptions:[],validators:{required:!0}},{name:"datetime",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}},{name:"dateend",label:"Fecha y hora final sugerida:",type:"datetime-local",sideBtn:"more_time",validators:{required:!0}},{name:"notes",label:"Notas:",type:"textarea",totalRows:4,style:"w-full",validators:{required:!0}},{name:"crm_costum_name",label:"Cliente",type:"text",sideBtn:"people",style:"w-full",disabled:!0,validators:{}},{name:"contact",label:"Contacto",type:"text",style:"w-full",validators:{}},{name:"address",label:"Direcci\xf3n",type:"text",style:"w-full",validators:{}},{name:"geoLoc",label:"Geolocalizaci\xf3n",type:"text",style:"w-full",sideBtn:"room",disabled:!0,validators:{}}]},this.messageSchema={controls:[{name:"message",label:"Mensaje:",type:"textarea",totalRows:4,style:"w-full",validators:{required:!0}}]},this.groupRefTrue=[],this.taskerData={picture:{title:"Foto",type:"blob-picture"},active:{title:"Activo",type:"boolean"},id:{title:"Identificaci\xf3n",type:"string"},names:{title:"Nombres",type:"string"},lastnames:{title:"Apellidos",type:"string"},age:{title:"Edad",type:"number"},address:{title:"Direcci\xf3n",type:"string"},city:{title:"Ciudad",type:"string"},email:{title:"Correo",type:"string"},phone:{title:"Tel\xe9fono",type:"string"},platform:{title:"Plataform pago",type:"string"},platform_phone:{title:"Tel\xe9fono plataforma",type:"string"},legal_age:{title:"Edad legal",type:"boolean"},stars:{title:"Estrellas",type:"number"},studyLevel:{title:"Nivel de estudio",type:"number"}}}startAppointData(i){if(this.staffList=i,this.getGroupRef(),this.schemaAppoint.controls){const n=this.schemaAppoint.controls.find(d=>"pollgrp_id"===d.name);n&&(n.selectOptions=this.groupRefTrue);const r=this.schemaAppoint.controls.find(d=>"staff"===d.name);r&&(r.selectOptions=[],i.forEach(d=>{d._id&&r.selectOptions?.push({key:d._id,value:`${d.names} ${d.lastnames||""}`})}))}}getPollGrpName(i){if(i){const n=this.groupRefTrue.find(r=>r.key===i);if(n)return n.value}return""}getGroupRef(){this.groupRefTrue=[],this.getRefNodeTrue(this.sharedvar.pollGroupIndex)}getRefNodeTrue(i){if(i.children)for(let n=0;n<i.children.length;n++){const r=i.children[n];if(r.ref)this.groupRefTrue.push({key:r.id,value:r.model_name||r.name});else if(r.children&&r.children.length>0)return this.getRefNodeTrue(r)}}onDelAppoint(i,n){!i.appoint||0===i.appoint.length||this.snkBar.open("Eliminar item de la agenda?.","Ok",{duration:5e3}).onAction().subscribe(r=>{i.appoint?.splice(n,1),this.dtb.updateStaffAsync(i)})}onAddEditAppoint(i,n,r=!0){var d=this;let g,u,C="Agenda ";const _=null===i||-1===n;if(null==i&&(i=this.staffList[0]),i.appoint||(i.appoint=[]),u=-1===n?this.appointBasic(i,"appoint"):i.appoint[n],C+=_?"Nueva":`${i.names} ${i.lastnames||""}`,this.schemaAppoint.controls){let x=-1;x=this.schemaAppoint.controls.findIndex(m=>"contact"===m.name),x>=0&&(this.schemaAppoint.controls[x].type="text"),x=this.schemaAppoint.controls.findIndex(m=>"staff"===m.name),this.schemaAppoint.controls[x].disabled=!_,x=this.schemaAppoint.controls.findIndex(m=>"geoLoc"===m.name),x>=0&&(this.schemaAppoint.controls[x].sideBtn=r?"room":"")}i.appoint&&u&&(g={staff:i._id,...u}),this.dg.aDefault({schema:this.schemaAppoint,title:C,value:g,dgwidth:400,function:[{name:"crm_costum_name",self:this,btn_source:!0,function:this.getCostumer1},{name:"datetime",self:this,btn_source:!1,function:this.updateEndTime},{name:"dateend",self:this,btn_source:!0,function:this.addTime},{name:"geoLoc",self:this,btn_source:!0,function:this.geolocation}]}).subscribe(function(){var x=(0,v.Z)(function*(m){if(m){const k=d.staffList.find(G=>G._id==m.staff);if(!k)return;k.appoint||(k.appoint=[]),m.dateend<=m.datetime&&(m.dateend=m.datetime+d.sharedvar.addMinutes(15)),m.staff_name=`${k.names} ${k.lastnames}`,delete m._btnEvent_,delete m._btnclick_,delete m._propName_,delete m._valid_,delete m.staff,d.dg.updatePropResult(u,m),d.selectedCostumer&&(u.contact===d.selectedCostumer.linkup_1?(u.email=d.selectedCostumer.email_1,u.phone=d.selectedCostumer.phone_1):(u.email=d.selectedCostumer.email_2,u.phone=d.selectedCostumer.phone_2),u.defa_values={crm_costum_id:d.selectedCostumer.id,crm_costum_name:d.selectedCostumer.name,crm_costum_contact:u.contact,crm_costum_email:u.email,crm_costum_phone:u.phone,crm_note:u.notes}),u.pollgrp_model_name=d.getPollGrpName(m.pollgrp_id),_?k.appoint.push(u):k.appoint[n]=u,d.dtb.updateStaffAsync(k)}});return function(m){return x.apply(this,arguments)}}())}onMessage2(i,n){var r=this;this.dg.aDefault({schema:this.messageSchema,title:"Mensaje a "+i||0,dgwidth:400,dgheigth:300}).subscribe(function(){var C=(0,v.Z)(function*(_){_&&r.notif.sendCommand({cmd:"message",user_id:r.sharedvar.staff._id,usert_id:n,data:{msg:{msg:_.message,who:r.sharedvar.staff.names||""},pollGrpName:r.sharedvar.staff.names||""}})});return function(_){return C.apply(this,arguments)}}())}getCostumer1(i,n,r){return(0,v.Z)(function*(){if(!n)return;const d=[],g=yield i.dtb.getActiveCRMCostumAsync();if(!g)return;g.forEach(_=>{_&&d.push({selected:!1,myid:_.id,name:_.name})});const u={title:"Seleccione Cliente",dgheigth:450,viewfilter:!0,viewAdd:!0,multiSelect:!1,valuelst:d},C=yield(0,T.z)(i.ds.aSelectDefault(u));if(C){if(!0===C.new){const p=yield i.newCostumer(i);if(!p)return{schema:r,value:n};i.selectedCostumer=p}else i.selectedCostumer=g.find(p=>p.name===C[0].name);n.crm_costum_name=i.selectedCostumer.name,n.address=i.selectedCostumer.address;const _=r.controls?.findIndex(p=>"contact"===p.name);if(_&&_>=0&&r.controls){const p=[];i.selectedCostumer?.linkup_1&&p.push({key:i.selectedCostumer.linkup_1,value:i.selectedCostumer.linkup_1}),i.selectedCostumer?.linkup_2&&p.push({key:i.selectedCostumer?.linkup_2,value:i.selectedCostumer?.linkup_2}),r.controls[_].type="select",r.controls[_].selectOptions=p}}return{schema:r,value:n}})()}newCostumer(i){return(0,v.Z)(function*(){let n={schema:A.Cn,title:"Datos del cliente",dgwidth:550,dgheigth:715};const r=yield(0,T.z)(i.dg.aDefault(n));return r?(delete r._valid_,delete r._btnEvent_,delete r._propName_,r.active=!0,yield i.dtb.createCostumAsync(r)):null})()}updateEndTime(i,n,r){return(0,v.Z)(function*(){if(n)return n.dateend=Number(n.datetime)+i.sharedvar.addMinutes(15),{schema:null,value:n}})()}addTime(i,n,r){return(0,v.Z)(function*(){if(n)return n.dateend=Number(n.dateend)+i.sharedvar.addMinutes(15),{schema:null,value:n}})()}geolocation(i,n,r){return(0,v.Z)(function*(){if(!n)return;(!n.geoLoc||0===n.geoLoc.length)&&(n.geoLoc=yield i.sharedvar.getLocalization());const g={title:"Geo localizaci\xf3n",dgheigth:600,value:[i.staff2analitic(0,n,n)]},u=yield(0,T.z)(i.dg.aMap(g));return u&&(n.geoLoc=u.geoLocStart),{schema:null,value:n}})()}onFilter(i){}staff2analitic(i,n,r){return{_id:`${n._id}:${i}`,date_ini:r.datetime,date_end:r.dateend,geoLocStart:r.geoLoc,tasker_id:n._id||"",tasker_name:n.names+" "+(n.lastnames||""),activity_id:r.pollgrp_id||"",activity_name:r.pollgrp_model_name||"No asignada",costumer_name:r.crm_costum_name||"",crm_products:[],ended:!1}}appointBasic(i,n){return{type:n,datetime:this.sharedvar.dateNow(),dateend:this.sharedvar.dateNow(),ended:!1,owner:this.sharedvar.staff._id||"",staff_name:`${i.names} ${i.lastnames}`}}static#t=this.\u0275fac=function(n){return new(n||Z)(b.LFG(w.D),b.LFG(U.k),b.LFG(t.ux),b.LFG(D.x),b.LFG(O.n),b.LFG(N.$))};static#e=this.\u0275prov=b.Yz7({token:Z,factory:Z.\u0275fac,providedIn:"root"})}return Z})()}}]);