"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[744],{5744:(xt,L,a)=>{a.r(L),a.d(L,{ProdListModule:()=>ft});var h=a(4070),g=a(781),p=a(3241),t=a(6339),y=a(6789),C=a(3016),N=a(1618),T=a(3792),Z=a(7254),D=a(5888),S=a(5180),I=a(9869),f=a(8137),v=a(4370),x=a(4156),U=a(8661),M=a(1781),O=a(1791),$=a(1030),b=a(4620);function B(s,u){if(1&s){const e=t.EpF();t.TgZ(0,"mat-chip-option",9),t.NdJ("removed",function(){const r=t.CHM(e).index,n=t.oxw();return t.KtG(n.removeCateg(r))})("click",function(){const r=t.CHM(e).$implicit,n=t.oxw();return t.KtG(n.editSelectCateg(r))}),t._uU(1),t.TgZ(2,"button",10)(3,"mat-icon"),t._uU(4,"cancel"),t.qZA()()()}if(2&s){const e=u.$implicit;t.xp6(1),t.hij(" ",e.value," ")}}function G(s,u){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"div",17)(2,"app-dynamic-form",18),t.NdJ("result",function(i){t.CHM(e);const r=t.oxw().index,n=t.oxw(2);return t.KtG(n.onGetProdEditCharData(i,r))}),t.qZA()()()}if(2&s){const e=t.oxw(3);t.xp6(2),t.Q6J("jsonFormData",e.prodEditCharDataSchema)("values",e.prodEditCharData)("reset",e.prodDataReset)("lookupvalues",e.lookupCharDatavalues)}}function H(s,u){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"div",13)(2,"div",14),t.NdJ("click",function(){const r=t.CHM(e).index,n=t.oxw(2);return t.KtG(n.expandElements(r))}),t._uU(3),t.qZA(),t.TgZ(4,"mat-icon",15),t.NdJ("click",function(){const r=t.CHM(e).index,n=t.oxw(2);return t.KtG(n.restartElements(r))}),t._uU(5,"autorenew"),t.qZA(),t.TgZ(6,"mat-icon",15),t.NdJ("click",function(){const r=t.CHM(e).index,n=t.oxw(2);return t.KtG(n.expandElements(r))}),t._uU(7,"expand_more"),t.qZA()(),t.YNc(8,G,3,4,"div",16),t.qZA()}if(2&s){const e=u.$implicit,o=u.index,i=t.oxw(2);t.xp6(3),t.Oqu(e.header),t.xp6(5),t.Q6J("ngIf",i.getElementVisible(o))}}function Y(s,u){if(1&s&&(t.TgZ(0,"div",11),t.YNc(1,H,9,2,"div",12),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.category2show.characterList)}}var m=(()=>{return(s=m||(m={}))[s.all=0]="all",s[s.product=1]="product",s[s.subproduct=2]="subproduct",m;var s})();let k=(()=>{class s{constructor(e,o,i,r,n,c,d){this.sharedvar=e,this.dtb=o,this.dg=i,this.snkBar=r,this.prodserv=n,this.ds=c,this.staffServ=d,this.prodEditCharDataSchema={controls:[]},this.showtype=m.all,this.show_area="",this.elementView=-1,this.prodEditCharData={},this.subFilter=[],this.prodDataReset=0,this.lookupCharDatavalues={}}ngOnChanges(){this.show_area="",this.category2show=null,this.elementView=-1}getTitle(){return this.showtype===m.product?"Detalles del Producto":this.showtype===m.subproduct?"Campos de filtro subproductos":"Productos y Subproductos"}removeCateg(e){var o=this;return(0,p.Z)(function*(){o.snkBar.open(`\xbfEliminar ${o.product.categIds[e].value}?`,"Ok",{duration:5e3}).onAction().subscribe(function(){var i=(0,p.Z)(function*(r){const n=o.product.categIds&&o.product.categIds[e].key?o.product.categIds[e].key:"";if(n.length>0&&o.product.optList){let c=0;for(;c<o.product.optList.length;){const d=o.product.optList[c];d.catid&&d.catid!==n?c++:o.product.optList.splice(c,1)}}o.product.categIds?.splice(e,1),yield o.prodserv.updateProd(o.product)});return function(r){return i.apply(this,arguments)}}())})()}getCategList(){var e=this;return(0,p.Z)(function*(){let i={value:yield e.prodserv.getAllShortCategAsync(),title:"Seleccione Categor\xeda",dgwidth:400,dgheigth:600};const n=(yield e.dg.aNestedSelect(i)).data;if(n&&n.length>0){let c=[];n.forEach(l=>c.push(l.key)),(yield e.prodserv.getCategListAsync(c.join(","))).forEach(l=>{e.product.optList||(e.product.optList=[]),l.characterList.forEach(_=>{-1===e.product.optList.findIndex(w=>w.catid==l._id)&&(e.product.optList=[...e.product.optList,...e.setElem(_)])})}),e.product.categIds=[...e.product.categIds,...n],e.product.categIds=e.avoidGRDdup(e.product.categIds),yield e.prodserv.updateProd(e.product)}})()}onGetProdEditCharData(e,o){var i=this;return(0,p.Z)(function*(){const r=e._propName_,n=i.category2show.characterList[o].data.find(d=>d.id===r);if(0===r.length||!i.product.optList||!n)return;let c=i.product.optList.find(d=>d.optid===r);if(!c){const d=i.prodserv.getOpt2Product(i.category2show._id,"",r,n.name||"",e[r]);i.product.optList.push(d),c=i.product.optList[i.product.optList.length-1]}if(e._btnclick_){const d=i.category2show.characterList[o].data.find(l=>e._propName_===l.id);if(c&&d)if(d.type.includes("prod_owner")){const l=d.type.split("_")[1],_=yield i.addOwner(c,l);c.lookup=_[0].name,c.value=_[0].hide1,i.lookupCharDatavalues[e._propName_]=c.lookup,i.lookupCharDatavalues={...i.lookupCharDatavalues},i.prodEditCharData[e._propName_]=c.value,e[r]=_[0].hide1}else"geo"===d.type&&(e[r]=yield i.getGeoLoc(),c.value=e[r],c.lookup=JSON.stringify(e[r]),i.lookupCharDatavalues[e._propName_]=c.lookup,i.lookupCharDatavalues={...i.lookupCharDatavalues},i.prodEditCharData[e._propName_]=c.value);i.prodDataReset++}else c.value=e[r];!0===n?.add2subfilter&&(i.product.prodXFilterList||(i.product.prodXFilterList=[]),i.product.prodXFilterList.forEach(d=>{-1!==d.indexOf(`ct_${n?.name}:`)&&i.product.prodXFilterList.splice(i.product.prodXFilterList.indexOf(d),1)}),e[r].array.forEach(d=>{-1===i.product.prodXFilterList.indexOf(`ct_${n?.name}:${d.value}`)&&i.product.prodXFilterList.push(`ct_${n?.name}:${d.value}`)})),i.setValue2Table(i.product,n?.type,e[r]),console.log(i.product),yield i.prodserv.updateProd(i.product)})()}editSelectCateg(e){var o=this;return(0,p.Z)(function*(){o.elementView=-1,o.category2show=yield o.prodserv.getCategAsync(e.key)})()}getGeoLoc(){var e=this;return(0,p.Z)(function*(){return yield e.sharedvar.getLocalization()})()}updaSetElem(e,o=[]){const i=[];return e.data.forEach(r=>{o.findIndex(d=>d.optid===r.id);const c=this.prodserv.getOpt2Product(e.cat_id,e.id,r.id,r.name,r.type,this.getDataSource(r.type));i.push(c)}),i}restartElements(e){this.product.optList=this.updaSetElem(this.category2show.characterList[e],this.product.optList),this.expandElements(e)}expandElements(e){if(e===this.elementView)this.elementView=-1;else{const o=this.category2show.characterList[e];this.prodEditCharDataSchema.controls=[];let i=!1;o.data.forEach(r=>{if(!0===r.add2subfilter&&this.showtype===m.product||!1===r.add2subfilter&&this.showtype===m.subproduct)return;const n=r.id;let c=this.getCharCtrl(r);const d=this.getValueFromTable(this.product,r,this.prodEditCharData[n]);this.prodEditCharData[r.id]=d.value,i=d.tosave||i,d.lookupvalue&&(this.lookupCharDatavalues[r.id]=d.lookupvalue),this.prodEditCharDataSchema.controls?.push(c)}),this.elementView=e,i&&this.prodserv.updateProd(this.product)}}getValueFromTable(e,o,i){let r=!1;if(o.type.includes("prod_"))switch(o.type){case"prod_price":r=e.price?.toString()!==i,i=this.getFieldValue(e,"price",o.id,i);break;case"prod_tax_p":r=e.tax_p?.toString()!==i,i=this.getFieldValue(e,"tax_p",o.id,i);break;case"prod_stock":r=e.stock?.toString()!==i,i=this.getFieldValue(e,"stock",o.id,i);break;case"prod_stars":r=e.stars?.toString()!==i,i=this.getFieldValue(e,"stars",o.id,i);break;case"prod_chip":r=e.chip?.toString()!==i,i=this.getFieldValue(e,"chip",o.id,i);break;case"prod_code":r=e.code?.toString()!==i,i=this.getFieldValue(e,"code",o.id,i);break;case"prod_description":r=e.description?.toString()!==i,i=this.getFieldValue(e,"description",o.id,i);break;case"prod_description_long":r=e.description_long?.toString()!==i,i=this.getFieldValue(e,"description_long",o.id,i);break;case"prod_owner":r=e.prod_owner?.toString()!==i,i=this.getFieldValue(e,"prod_owner",o.id,i);break;case"prod_owner1":r=e.prod_owner1?.toString()!==i,i=this.getFieldValue(e,"prod_owner1",o.id,i);break;case"prod_owner2":r=e.prod_owner2?.toString()!==i,i=this.getFieldValue(e,"prod_owner2",o.id,i)}else i=this.getValue(e,o.id,i);const n=e.optList?.find(c=>c.optid===o.id)?.lookup;return{value:i,lookupvalue:n,tosave:r}}getFieldValue(e,o="",i,r){const n=e.optList?.find(d=>d.optid===i),c=e[o];return c?(n.value=c,c):n?.value?(e[o]=n.value,n.value):(n.value=r,e[o]=r,r)}getValue(e,o,i){const r=e.optList?.find(n=>n.optid===o);return r?r?.value?r.value:(r.value=i,i):i}setValue2Table(e,o,i){if(o&&o.includes("prod_"))switch(o){case"prod_price":return e.price=+i;case"prod_tax_p":return e.tax_p=+i;case"prod_stock":return e.stock=+i;case"prod_stars":return e.stars=+i;case"prod_chip":return e.chip=i?.toString();case"prod_code":return e.code=i?.toString();case"prod_description":return e.description=i?.toString();case"prod_description_long":return e.description_long=i?.toString();case"prod_owner":return e.prod_owner=i?.toString();case"prod_owner1":return e.prod_owner1=i?.toString();case"prod_owner2":return e.prod_owner2=i?.toString()}}getElementVisible(e){return this.elementView===e}getCharCtrl(e){let i="textarea",r="",n="",c="",d="w-full",l={},P=[],w=!1;switch(e.type){case"prod_code":case"prod_name":case"text":case"box":i="text";break;case"prod_owner":case"prod_owner1":case"prod_owner2":i="text",r="add",w=!0;break;case"image":c=`Editar: ${e.title}      `,d="w-full font-medium",r="add",n="delete",i="picture",l.pictheight="500",l.pictwidth="500";break;case"image_carrousel":i="header",c=`Editar: ${e.title}      `,d="w-full font-medium",r="description",n="photo_library";break;case"circle":i="picture",l.pictheight="100",l.pictwidth="100",r="add",n="delete";break;case"geo":i="text",r="place",w=!1;break;case"checkbox":i="checkbox",r="",d="";break;case"prod_stock":case"prod_tax_p":case"prod_price":case"prod_star":case"number":i="number"}return e.selectlist&&e.selectlist.length>0&&(P=this.fillSelectlist(e.selectlist),i="multiselect",r="list"),this.subFilter.findIndex(vt=>vt.subfilterlist.includes(e.id))>-1&&(n="menu_open"),{name:e.id,type:i,label:e.title,default:c,validators:{required:!0},selectOptions:P,tags:l,style:d,totalRows:5,sideBtn:r,sideBtn2:n,disabled:w}}fillSelectlist(e){const o=[];return e.forEach(i=>o.push({key:i,value:i})),o}setElem(e){const o=[];return e.data.forEach(i=>{o.push(this.prodserv.getOpt2Product(e.cat_id,e.id,i.id,i.name,"",this.getDataSource(i.type)))}),o}getDataSource(e){return e&&e.includes("prod_")?e.substring(5,e.length):"none"}avoidGRDdup(e){return e.filter((o,i)=>{const r=o.key;return i===e.findIndex(n=>n.key===r)})}addOwner(e,o){var i=this;return(0,p.Z)(function*(){if(!e)return;const r=[],n=yield i.dtb.getActiveCRMCostumAsync();if(!n)return;n.forEach(l=>{l&&l.ownertype.includes(o)&&r.push({selected:!1,myid:l.id,name:l.name,hide1:l._id})});const c={title:"Seleccione Cliente",dgheigth:450,viewfilter:!0,viewAdd:!0,multiSelect:!1,valuelst:r};let d=yield(0,U.z)(i.ds.aSelectDefault(c));if(d){if(!0===d.new){const l=yield i.staffServ.newCostumer(i,o);return d={hide1:l._id,name:l.name},d}return d}return e.value})()}SelCharOptionList(e,o){return(0,p.Z)(function*(){})()}static#t=this.\u0275fac=function(o){return new(o||s)(t.Y36(y.D),t.Y36(C.k),t.Y36(T.x),t.Y36(Z.ux),t.Y36(S.M),t.Y36(M.n),t.Y36(O.x))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-prod-cat-deta"]],inputs:{product:"product",showtype:"showtype"},features:[t.TTD],decls:14,vars:3,consts:[[1,"px-2","flex","flex-col","gap-2","bg-gray-100","overflow-auto"],[1,"flex","items-center","font-medium"],[1,"grow","ml-2","border-t","border-gray-500"],[1,"flex","ml-2","h-12"],[1,"grow"],[3,"removed","click",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],["color","primary"],["class","ml-4",4,"ngIf"],[3,"removed","click"],["matChipRemove",""],[1,"ml-4"],[4,"ngFor","ngForOf"],[1,"flex","justify-start","p-1","text-violet-900","font-medium","bg-violet-200","hover:text-violet-400"],[1,"grow",3,"click"],[3,"click"],[4,"ngIf"],[1,"ml-2","p-1","bg-gray-100","text-sm"],[1,"flex-1","p-1","mt-2",3,"jsonFormData","values","reset","lookupvalues","result"]],template:function(o,i){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div"),t._uU(3),t.qZA(),t._UZ(4,"div",2),t.qZA(),t.TgZ(5,"div",3)(6,"div",4)(7,"mat-chip-listbox"),t.YNc(8,B,5,1,"mat-chip-option",5),t.qZA()(),t.TgZ(9,"div")(10,"button",6),t.NdJ("click",function(){return i.getCategList()}),t.TgZ(11,"mat-icon",7),t._uU(12,"list"),t.qZA()()()(),t.YNc(13,Y,2,1,"div",8),t.qZA()),2&o&&(t.xp6(3),t.Oqu(i.getTitle()),t.xp6(5),t.Q6J("ngForOf",i.product.categIds),t.xp6(5),t.Q6J("ngIf",i.category2show))},dependencies:[h.sg,h.O5,f.Hw,$.r,v.lW,b.z2,b.iO,b.qH]})}return s})();var V=a(2224),E=a(7826);function q(s,u){if(1&s){const e=t.EpF();t.TgZ(0,"div",9)(1,"mat-checkbox",10),t.NdJ("change",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.onShowSelected(i.checked))}),t._uU(2,"Mostrar seleccionados"),t.qZA()()}}let A=(()=>{class s{constructor(e,o){this.dtb=e,this.sharedvar=o,this.changePictProduct=new t.vpe,this.changePictSubproduct=new t.vpe,this.showAll=!0,this.imageSchema={controls:[{label:"Subir Imagen/Foto",name:"picture",validators:{},type:"picture",tags:{pictheight:"500",pictwidth:"500"}},{label:"Desde v\xednculo remoto",name:"remote_link",validators:{},type:"text",style:"w-full"}]},this.reset=0,this.valueList=[],this.ngOnChanges()}ngOnChanges(){this.valueList=[],this.product&&(this.product.pictures&&this.product.pictures.length>0?this.data2Show():(this.valueList.push({picture:"",remote_link:""}),this.reset++),this.subproduct&&this.imageSchema.controls.length<=2&&(this.imageSchema.controls.push({label:"Incluir imagen/Foto",name:"select",validators:{},type:"checkbox"}),this.getSubprodPictlist()),!this.subproduct&&this.imageSchema.controls.length>2&&this.imageSchema.controls.splice(2,1))}data2Show(){return this.valueList=[],this.showAll&&this.product.pictures&&this.product.pictures.length>0?this.product.pictures.forEach(e=>this.valueList.push({picture:e,remote_link:e})):!this.showAll&&this.subproduct&&this.subproduct.pictures&&this.subproduct.pictures.length>0&&this.subproduct.pictures.forEach(e=>this.valueList.push({picture:e,remote_link:e,select:!0})),this.valueList}onHeaderAddClick(){this.valueList.push({picture:"",remote_link:""}),this.valueList=JSON.parse(JSON.stringify(this.valueList)),console.log(this.valueList)}onGetData(e){var o=this;return(0,p.Z)(function*(){if(!0===e.state.delete){const i=e.valueList[e.index].picture;yield o.dtb.deleteFiles(i),e.valueList.splice(e.index,1),o.setSubprodPictlist(e)}if(e._propName_&&"picture"===e._propName_){let i="";e.valueList[e.index].remote_link.includes(o.sharedvar.TASKY_SERVER)&&(i=e.valueList[e.index].remote_link);const r=yield o.uploadImage(e.valueList[e.index].picture,i);e.valueList[e.index].remote_link=r,e.valueList[e.index].picture=r}e._propName_&&"select"===e._propName_&&o.setSubprodPictlist(e),e.index>=0&&(o.valueList=JSON.parse(JSON.stringify(e.valueList))),o.changePictProduct.emit(e)})()}uploadImage(e,o=""){var i=this;return(0,p.Z)(function*(){o.length>0&&(yield i.dtb.deleteFiles(o));let r=`P_${i.product._id}_${i.sharedvar.getSerialKey(2,4)}.jpeg`,n="";const c=e.indexOf("base64,")+7;return n=e.substring(c,e.length),yield i.dtb.uploadFiles("products",[{file_name:`products/${r}`,data:i.sharedvar.b64toBlob(n,"image/jpeg")}]),`${i.sharedvar.TASKY_SERVER}${i.sharedvar.TASKY_PICTURES_2IO}products${i.sharedvar.SLASH_ESCAPE}${r}`})()}setSubprodPictlist(e){this.subproduct&&this.valueList.length>0&&(this.subproduct.pictures=[],this.valueList.forEach(o=>{!0===o.select&&this.subproduct.pictures.push(o.picture)}),this.changePictSubproduct.emit(e))}getSubprodPictlist(){this.subproduct&&this.subproduct.pictures&&this.valueList&&this.valueList.forEach(e=>{e.select=this.subproduct.pictures.includes(e.picture)})}onShowSelected(e){this.showAll=!e,this.data2Show()}static#t=this.\u0275fac=function(o){return new(o||s)(t.Y36(C.k),t.Y36(y.D))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-prod-image-list"]],inputs:{product:"product",subproduct:"subproduct"},outputs:{changePictProduct:"changePictProduct",changePictSubproduct:"changePictSubproduct"},features:[t.TTD],decls:12,vars:6,consts:[[1,"px-2","flex","flex-col","gap-2","bg-gray-100","overflow-auto"],[1,"flex","flex-row","items-center","font-medium"],[1,"grow","ml-2","border-t","border-gray-500"],[1,"flex","flex-row","justify-end"],["class","grow",4,"ngIf"],["mat-stroked-button","",3,"click"],["matTooltip","Agregar"],[1,"flex-1","px-2","pt-3","mt-1","overflow-auto"],[3,"schema","valuesList","reset","setValueByIndex","delButton","resultByIndex"],[1,"grow"],[3,"change"]],template:function(o,i){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div"),t._uU(3,"Lista de im\xe1genes"),t.qZA(),t._UZ(4,"div",2),t.qZA(),t.TgZ(5,"div",3),t.YNc(6,q,3,0,"div",4),t.TgZ(7,"button",5),t.NdJ("click",function(){return i.onHeaderAddClick()}),t.TgZ(8,"mat-icon",6),t._uU(9,"add"),t.qZA()()(),t.TgZ(10,"div",7)(11,"app-multi-dynamic",8),t.NdJ("resultByIndex",function(n){return i.onGetData(n)}),t.qZA()()()),2&o&&(t.xp6(6),t.Q6J("ngIf",i.subproduct),t.xp6(5),t.Q6J("schema",i.imageSchema)("valuesList",i.valueList)("reset",i.reset)("setValueByIndex",i.setValueByIndex)("delButton","delete"))},dependencies:[h.O5,f.Hw,V.MultiDynamicComponent,v.lW,E.oG]})}return s})();var Q=a(1842);const R=["editControlTrigger"],K=["excelUpload"],j=["imagesUpload"];function z(s,u){if(1&s){const e=t.EpF();t.TgZ(0,"div",21),t._UZ(1,"img",22),t.TgZ(2,"div",23)(3,"div"),t._uU(4),t.qZA(),t.TgZ(5,"div",24)(6,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,r=t.oxw();return t.KtG(r.SetExpand(i,"prodeta"))}),t._uU(7,"edit"),t.qZA(),t.TgZ(8,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,r=t.oxw();return t.KtG(r.SetExpand(i,"subproducts"))}),t._uU(9,"list"),t.qZA(),t.TgZ(10,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,r=t.oxw();return t.KtG(r.SetExpand(i,"imagelist"))}),t._uU(11,"collections"),t.qZA(),t.TgZ(12,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,r=t.oxw();return t.KtG(r.SetExpand(i,"calculate"))}),t._uU(13,"add_shopping_cart"),t.qZA(),t._uU(14," \xa0 "),t.TgZ(15,"mat-icon",26),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(),r=i.index,n=i.$implicit,c=t.oxw();return t.KtG(c.deleteProduct(r,n._id))}),t._uU(16,"delete"),t.qZA()()()()}if(2&s){const e=t.oxw().$implicit,o=t.oxw();t.xp6(1),t.Q6J("src",o.getPicture(e),t.LSH),t.xp6(3),t.Oqu(e.description),t.xp6(2),t.Tol(o.getButtonStyle(e._id,"prodeta",!1)),t.xp6(2),t.Tol(o.getButtonStyle(e._id,"subproducts",!1)),t.xp6(2),t.Tol(o.getButtonStyle(e._id,"imagelist",!1)),t.xp6(2),t.Tol(o.getButtonStyle(e._id,"calculate",!1))}}function X(s,u){if(1&s&&(t.TgZ(0,"div",27),t._UZ(1,"app-prod-cat-deta",28),t.qZA()),2&s){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("product",e)("showtype",1)}}function W(s,u){if(1&s){const e=t.EpF();t.TgZ(0,"div",21),t._UZ(1,"img",22),t.TgZ(2,"div",23)(3,"div"),t._uU(4),t.qZA(),t.TgZ(5,"div",24)(6,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,r=t.oxw(3);return t.KtG(r.setSubExpand(i._id,"prodeta"))}),t._uU(7,"edit"),t.qZA(),t.TgZ(8,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,r=t.oxw(3);return t.KtG(r.setSubExpand(i._id,"filter"))}),t._uU(9,"account_tree"),t.qZA(),t.TgZ(10,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,r=t.oxw(3);return t.KtG(r.setSubExpand(i._id,"imagelist"))}),t._uU(11,"collections"),t.qZA(),t._uU(12," \xa0 "),t.TgZ(13,"mat-icon",37),t._uU(14,"delete"),t.qZA()()()()}if(2&s){const e=t.oxw().$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("src",o.getPicture(e),t.LSH),t.xp6(3),t.Oqu(e.description),t.xp6(2),t.Tol(o.getButtonStyle(e._id,"prodeta",!0)),t.xp6(2),t.Tol(o.getButtonStyle(e._id,"filter",!0)),t.xp6(2),t.Tol(o.getButtonStyle(e._id,"imagelist",!0))}}function tt(s,u){if(1&s&&(t.TgZ(0,"div",27),t._UZ(1,"app-prod-cat-deta",28),t.qZA()),2&s){const e=t.oxw().$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("product",e)("showtype",o.getSubType())}}function et(s,u){if(1&s){const e=t.EpF();t.TgZ(0,"div",29)(1,"div",38)(2,"app-prod-image-list",39),t.NdJ("changePictProduct",function(i){t.CHM(e);const r=t.oxw(3).$implicit,n=t.oxw();return t.KtG(n.editPictProduct(i,r))})("changePictSubproduct",function(i){t.CHM(e);const r=t.oxw().$implicit,n=t.oxw(3);return t.KtG(n.editPictSubproduct(i,r))}),t.qZA()()()}if(2&s){const e=t.oxw().$implicit,o=t.oxw(2).$implicit;t.xp6(2),t.Q6J("product",o)("subproduct",e)}}function it(s,u){if(1&s&&(t.TgZ(0,"div",35)(1,"div",36),t.YNc(2,W,15,8,"div",18),t.YNc(3,tt,2,2,"div",19),t.YNc(4,et,3,2,"div",20),t.qZA()()),2&s){const e=u.$implicit,o=t.oxw(3);t.xp6(2),t.Q6J("ngIf",o.getSubprodFilter(e)),t.xp6(1),t.Q6J("ngIf",o.getSubExpand(e._id,"filter_prodeta")),t.xp6(1),t.Q6J("ngIf",o.getSubExpand(e._id,"imagelist"))}}function ot(s,u){if(1&s){const e=t.EpF();t.TgZ(0,"div",29)(1,"div",30)(2,"div"),t._uU(3,"Sub productos"),t.qZA(),t._UZ(4,"div",31),t.qZA(),t.TgZ(5,"div",32)(6,"button",33),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().index,r=t.oxw();return t.KtG(r.addSubProduct(i))}),t.TgZ(7,"mat-icon",8),t._uU(8,"add"),t.qZA()()(),t.YNc(9,it,5,3,"div",34),t.qZA()}if(2&s){const e=t.oxw(2);t.xp6(9),t.Q6J("ngForOf",e.subprodList)}}function rt(s,u){if(1&s){const e=t.EpF();t.TgZ(0,"div",29)(1,"div",38)(2,"app-prod-image-list",40),t.NdJ("changePictProduct",function(i){t.CHM(e);const r=t.oxw().$implicit,n=t.oxw();return t.KtG(n.editPictProduct(i,r))}),t.qZA()()()}if(2&s){const e=t.oxw().$implicit;t.xp6(2),t.Q6J("product",e)}}function st(s,u){if(1&s){const e=t.EpF();t.TgZ(0,"div",29)(1,"div",38)(2,"app-shopping-cond",41),t.NdJ("change",function(i){t.CHM(e);const r=t.oxw().$implicit,n=t.oxw();return t.KtG(n.editShoppingProduct(i,r))}),t.qZA()()()}if(2&s){const e=t.oxw().$implicit,o=t.oxw();t.xp6(2),t.Q6J("product",e)("category",o.category2show)("subfilterlist",o.categ2SubFilter)("categList",o.categ_list)}}function nt(s,u){if(1&s&&(t.TgZ(0,"div",17),t.YNc(1,z,17,10,"div",18),t.YNc(2,X,2,2,"div",19),t.YNc(3,ot,10,1,"div",20),t.YNc(4,rt,3,1,"div",20),t.YNc(5,st,3,4,"div",20),t.qZA()),2&s){const e=u.$implicit,o=t.oxw();t.xp6(1),t.Q6J("ngIf",o.getProdFilter(e)),t.xp6(1),t.Q6J("ngIf",o.getExpand(e._id,"prodeta")),t.xp6(1),t.Q6J("ngIf",o.getExpand(e._id,"subproducts")),t.xp6(1),t.Q6J("ngIf",o.getExpand(e._id,"imagelist")),t.xp6(1),t.Q6J("ngIf",o.getExpand(e._id,"calculate"))}}const ct=[{path:"",component:(()=>{class s{constructor(e,o,i,r,n,c,d){this.sharedvar=e,this.dtb=o,this.sanitizer=i,this.dg=r,this.snkBar=n,this.data2excel=c,this.prodserv=d,this.prodEditCharDataSchema={controls:[]},this.newproduct={controls:[{name:"code",label:"C\xf3digo:",type:"text",style:"w-full",validators:{}},{name:"description",label:"Nombre:",type:"text",style:"w-full",validators:{}},{name:"description_long",label:"Descripci\xf3n:",type:"text",style:"w-full",validators:{}},{name:"price",label:"Precio:",type:"number",validators:{}},{name:"tax_p",label:"Impuesto %:",type:"number",validators:{}},{name:"stock",label:"Existencia:",type:"number",validators:{}}]},this.prodList=[],this.subprodList=[],this.show_product="",this.show_area="",this.elementView=-1,this.prodEditCharData={},this.subFilter=[],this.categ_list=[],this.categ2SubFilter=[],this.prodDataReset=0,this.show_subprod="",this.show_subprod_area=""}ngOnInit(){var e=this;return(0,p.Z)(function*(){e.prodList=yield e.prodserv.getAllCRMProdAsync("parent"),e.categ_list=yield e.prodserv.getCategories()})()}getClicked(e){switch(e.index){case 2:this.newProduct();break;case 4:let o=document.getElementById("spanTrigger");o&&(o.style.display="",o.style.position="absolute",o.style.left=e.pageX+5+"px",o.style.top=e.pageY+5+"px",this.editControlTrigger.openMenu())}}newProduct(){var e=this;return(0,p.Z)(function*(){let o={schema:e.newproduct,value:{},title:"Nuevo producto",dgwidth:550,dgheigth:615};const i=yield e.dg.aDefault(o);if(i){delete i._valid_,delete i._propName_,i.parent_id="",i.optList=[],i.opt2List=[],i.pictures=[];const r=yield e.prodserv.createProdAsync(i);e.prodList.push(r)}})()}getPicture(e){return"../assets/images/favicon.png"}deleteProduct(e,o=""){var i=this;return(0,p.Z)(function*(){i.snkBar.open("Eliminar producto?","Ok",{duration:5e3}).onAction().subscribe(function(){var r=(0,p.Z)(function*(n){yield i.prodserv.deleteProdAsync(o),i.prodList.splice(e,1)});return function(n){return r.apply(this,arguments)}}())})()}SetExpand(e,o){var i=this;return(0,p.Z)(function*(){i.show_product===e._id&&i.show_area===o||(i.show_product!==e._id&&(i.subprodList=yield i.prodserv.getAllCRMProdAsync(`subproduct/${e._id}`),i.show_product=e._id,i.prodResult=e,i.getCateg2SubFilter(),""===i.prodResult.code&&(i.prodResult.code=i.prodResult._id||"NONE")),i.show_area=i.show_area!==o?o:"")})()}setSubExpand(e="",o){this.show_subprod!==e||this.show_subprod_area!==o?(this.show_subprod=e,this.show_subprod_area=o):this.show_subprod=""}getButtonStyle(e="",o,i){if(i){if(this.show_subprod_area===o&&this.show_subprod===e)return"hover:text-violet-800 text-violet-500"}else if(this.show_area===o&&this.show_product===e)return"hover:text-violet-800 text-violet-500";return"hover:text-violet-500"}getSubExpand(e="",o){return this.show_subprod===e&&!(!o.includes(this.show_subprod_area)&&this.show_subprod_area!==o)}getSubType(){return"prodeta"===this.show_subprod_area?1:2}getProdFilter(e){return!0}getSubprodFilter(e){return!0}getExpand(e,o){return this.show_product===e&&this.show_area===o}addSubProduct(e){var o=this;return(0,p.Z)(function*(){if(e>=0){const i=o.prodList[e];if(i){const r={...i};delete r._id,r.parent_id=i._id||"";const n=yield o.prodserv.createProdAsync(r);o.subprodList.push(n)}}})()}editPictProduct(e,o){var i=this;return(0,p.Z)(function*(){e.index<0||(o.pictures=[],e.valueList.forEach(r=>{o.pictures?.push(r.remote_link)}),yield i.prodserv.updateProd(o))})()}editShoppingProduct(e,o){var i=this;return(0,p.Z)(function*(){yield i.prodserv.updateProd(o)})()}editPictSubproduct(e,o){var i=this;return(0,p.Z)(function*(){e.index<0||(o.pictures=[],e.valueList.forEach(r=>{!0===r.select&&o.pictures.push(r.remote_link)}),yield i.prodserv.updateProd(o))})()}getCateg2SubFilter(){return this.categ2SubFilter=[],this.prodResult.categIds.forEach(e=>{e.key&&this.categ2SubFilter.push(e.key)}),this.categ2SubFilter}onExcel2Dtb(e){this.excelUpload&&this.excelUpload.nativeElement.click()}onDtb2Excel(){}onAllImgs(){return(0,p.Z)(function*(){})()}onFolder2Dtb(e){this.excelUpload&&this.excelUpload.nativeElement.click()}onExcelFileSelected(e){}fileImagesChangeEvent(e){}static#t=this.\u0275fac=function(o){return new(o||s)(t.Y36(y.D),t.Y36(C.k),t.Y36(N.H7),t.Y36(T.x),t.Y36(Z.ux),t.Y36(D.Z),t.Y36(S.M))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-prod-list"]],viewQuery:function(o,i){if(1&o&&(t.Gf(R,5),t.Gf(K,5),t.Gf(j,5)),2&o){let r;t.iGM(r=t.CRH())&&(i.editControlTrigger=r.first),t.iGM(r=t.CRH())&&(i.excelUpload=r.first),t.iGM(r=t.CRH())&&(i.imagesUpload=r.first)}},decls:30,vars:4,consts:[[1,"flex","flex-col","max-h-screen"],[3,"buttons","nav_menu","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"flex-1","px-2","flex","flex-col","gap-2","bg-gray-100","overflow-auto"],["class","p-1 flex flex-col justify-between border border-gray-300 rounded shadow-sm bg-white",4,"ngFor","ngForOf"],["products","matMenu"],[1,"font-medium"],["color","primary"],["mat-menu-item","",1,"pl-4",3,"click"],[1,"label"],["type","file","required","","multiple","","accept",".png,.jpg,.gif,.jpeg",3,"change"],[1,"pl-4","my-2"],["color","primary",1,"mt-1"],["mat-menu-item","",3,"click"],["type","file","accept",".xlsx",1,"invisible",3,"change"],["excelUpload",""],[1,"p-1","flex","flex-col","justify-between","border","border-gray-300","rounded","shadow-sm","bg-white"],["class","flex justify-start",4,"ngIf"],["class","p-2 bg-gray-50",4,"ngIf"],["class","px-2 bg-gray-50",4,"ngIf"],[1,"flex","justify-start"],["alt","Product",1,"h-16","w-16","rounded-full","object-fill",3,"src"],[1,"flex-1","flex","flex-col","items-start","px-2","grow"],[1,"text-gray-300"],[3,"click"],[1,"hover:text-red-300",3,"click"],[1,"p-2","bg-gray-50"],[3,"product","showtype"],[1,"px-2","bg-gray-50"],[1,"flex","items-center","font-medium"],[1,"grow","ml-2","border-t","border-gray-500"],[1,"mb-2","flex","justify-end"],["mat-stroked-button","",3,"click"],["class","flex flex-col mb-2",4,"ngFor","ngForOf"],[1,"flex","flex-col","mb-2"],[1,"ml-5","p-1","flex","flex-col","justify-between","border","border-gray-300","rounded","shadow-sm","bg-white"],[1,"hover:text-red-300"],[1,"flex-1","px-2","pt-3","mt-1","overflow-auto"],[3,"product","subproduct","changePictProduct","changePictSubproduct"],[3,"product","changePictProduct"],[3,"product","category","subfilterlist","categList","change"]],template:function(o,i){if(1&o&&(t.TgZ(0,"div",0)(1,"app-header",1),t.NdJ("onClicked",function(n){return i.getClicked(n)}),t.qZA(),t._UZ(2,"span",2,3),t.TgZ(4,"div",4),t.YNc(5,nt,6,5,"div",5),t.qZA(),t.TgZ(6,"mat-menu",null,6)(8,"div",7)(9,"mat-icon",8),t._uU(10,"cloud_upload"),t.qZA(),t._uU(11," Base remota "),t.qZA(),t.TgZ(12,"button",9),t.NdJ("click",function(n){return i.onExcel2Dtb(n)}),t._uU(13," Excel hacia DtBase "),t.qZA(),t.TgZ(14,"label",10)(15,"input",11),t.NdJ("change",function(n){return i.fileImagesChangeEvent(n)}),t.qZA(),t.TgZ(16,"span",12),t._uU(17,"Im\xe1genes hacia DtBase"),t.qZA(),t._uU(18,"\xa0\xa0 "),t.qZA(),t._UZ(19,"hr"),t.TgZ(20,"div",7)(21,"mat-icon",13),t._uU(22,"edit"),t.qZA(),t._uU(23," Base local "),t.qZA(),t.TgZ(24,"button",14),t.NdJ("click",function(){return i.onDtb2Excel()}),t._uU(25," Data base hacia Excel "),t.qZA(),t.TgZ(26,"button",14),t.NdJ("click",function(){return i.onAllImgs()}),t._uU(27," Lista de im\xe1genes en la base "),t.qZA()(),t.TgZ(28,"input",15,16),t.NdJ("change",function(n){return i.onExcelFileSelected(n)}),t.qZA()()),2&o){const r=t.MAs(7);t.xp6(1),t.Q6J("buttons","111111")("nav_menu",!1),t.xp6(1),t.Q6J("matMenuTriggerFor",r),t.xp6(3),t.Q6J("ngForOf",i.prodList)}},dependencies:[h.sg,h.O5,I.G,f.Hw,v.lW,x.VK,x.OP,x.p6,k,A,Q.y]})}return s})()}];let dt=(()=>{class s{static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[g.Bz.forChild(ct),g.Bz]})}return s})();var F=a(5425),J=a(7774);const at=[{path:"",component:k}];let lt=(()=>{class s{static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[g.Bz.forChild(at),g.Bz]})}return s})(),pt=(()=>{class s{static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[h.ez,lt,F.O,f.Ps,J.N,v.ot,x.Tx,b.Hi]})}return s})();const ut=[{path:"",component:A}];let _t=(()=>{class s{static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[g.Bz.forChild(ut),g.Bz]})}return s})();var ht=a(9967);let mt=(()=>{class s{static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[h.ez,_t,f.Ps,ht.r,v.ot,E.p9]})}return s})();var gt=a(6532);let ft=(()=>{class s{static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[h.ez,dt,F.O,f.Ps,J.N,v.ot,x.Tx,b.Hi,pt,mt,gt.U]})}return s})()}}]);