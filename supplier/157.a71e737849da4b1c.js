"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[157],{6157:(O,h,s)=>{s.r(h),s.d(h,{AppointListModule:()=>q});var _=s(7087),g=s(3759),d=s(3241),t=s(2283),b=s(4758),Z=s(4537),L=s(6806),k=s(6510),C=s(1682),v=s(1359),x=s(3578),m=s(9347),T=s(8464),F=s(9554);const U=["editControlTrigger"],D=["chartTrigger"];function N(a,f){1&a&&(t.TgZ(0,"mat-icon"),t._uU(1,"done"),t.qZA())}function M(a,f){1&a&&(t.TgZ(0,"mat-icon"),t._uU(1,"done"),t.qZA())}function J(a,f){1&a&&(t.TgZ(0,"mat-icon"),t._uU(1,"done"),t.qZA())}function S(a,f){1&a&&(t.TgZ(0,"mat-icon"),t._uU(1,"done"),t.qZA())}const G=[{path:"",component:(()=>{class a{constructor(i,o,e,n,l,p){this.sharedvar=i,this.staffServ=o,this.dtb=e,this.dg=n,this.data2excel=l,this.snkBar=p,this.staffList=[],this.pivot=0,this.bartype=1,this.chunk="D",this.graphtypeName="Linea de tiempo apilado",this.mpos={x:-1,y:-1},this.bar_txt=""}ngOnInit(){var i=this;return(0,d.Z)(function*(){i.staffList=yield i.dtb.getStaffByFilterAsync({queryType:1,active:!0,stars:0,rol:"P"}),i.staffServ.startAppointData(i.staffList);const o=new Date,e=o.setHours(0,0,0,0),n=o.setHours(23,59,59,999);i.localFilter={crm:"T",staff__id:[],pollGrpData:[],costumers:[],products:[],products_name_sel:[],date_ini:e,date_end:n},i.executeFilter()})()}ngOnDestroy(){this.resultSub&&this.resultSub.unsubscribe()}executeFilter(){this.dataList=[],this.getTitleText(),this.staffList.forEach(i=>{if(i.appoint&&(0===this.localFilter.staff__id.length||-1!==this.localFilter.staff__id.findIndex(o=>i._id===o)))for(let o=0;o<i.appoint.length;o++){let e=!0;const n=i.appoint[o];e=0===this.localFilter.pollGrpData.length||this.localFilter.pollGrpData.findIndex(p=>p===n.pollgrp_id)>-1,e=0===this.localFilter.costumers.length||this.localFilter.costumers.findIndex(p=>p===n.costumer)>-1,e=this.localFilter.date_ini>=n.datetime&&this.localFilter.date_end<=n.dateend,this.dataList.push({_id:`${i._id}:${o}`,date_ini:n.datetime,date_end:n.dateend,geoLocStart:n.geoLoc,tasker_id:i._id||"",tasker_name:i.names+" "+i.lastnames,activity_id:n.pollgrp_id||"",activity_name:n.pollgrp_model_name||"No asignada",costumer_name:n.costumer||"",crm_products:[]})}})}getClicked(i){var o=this;return(0,d.Z)(function*(){switch(i.index){case 1:o.filterDialog();break;case 2:o.addAppoint();break;case 3:let e=document.getElementById("spanTrigger");e&&(e.style.display="",e.style.position="absolute",e.style.left=i.pageX+5+"px",e.style.top=i.pageY+5+"px",o.editControlTrigger.openMenu());break;case 4:yield o.executeFilter()}})()}addAppoint(){this.staffServ.onAddEditAppoint(null,-1)}getTitleText(){this.bar_txt="",this.localFilter.pollGrpData.length>0&&(this.bar_txt+="Modelos - "),this.localFilter.staff__id.length>0&&(this.bar_txt+="Tasker - "),this.localFilter.costumers.length>0&&(this.bar_txt+="Clientes - "),this.localFilter.products.length>0&&(this.bar_txt+="Productos - "),this.bar_txt+=`Fecha desde ${this.sharedvar.formatNumber2Date(this.localFilter.date_ini||0,"/")}\n     hasta ${this.sharedvar.formatNumber2Date(this.localFilter.date_end||0,"/")}`}filterDialog(){var i=this;return(0,d.Z)(function*(){i.sharedvar.wait=!0;let o=[],e=[],n=[],l=[];(yield i.dtb.getStaffByFilterAsync({queryType:3,active:!0,stars:0,rol:"K"})).forEach(c=>{o.push({key:c._id,value:`${c.names||c.email} ${c.lastnames||""}`})}),(yield i.dtb.getPollGrpActiveAsync()).forEach(c=>{"index"!==c.id&&e.push({key:c._id,value:c.name})}),(yield i.dtb.getActiveCRMCostumAsync()).forEach(c=>{n.push({key:c.id,value:c.name})}),(yield i.dtb.getAllCRMProdAsync()).forEach(c=>{l.push({key:c.id,value:c.name})}),i.dg.aDefault({schema:{controls:[{name:"staff__id",label:"Taskers:",type:"multiselect",placeholder:"Todos",style:"w-full",validators:{},selectOptions:o},{name:"pollGrpData",label:"Modelos:",type:"multiselect",placeholder:"Todos",style:"w-full",validators:{},selectOptions:e},{name:"costumers",label:"Clientes:",type:"multiselect",placeholder:"Todos",style:"w-full",validators:{},selectOptions:n},{name:"products",label:"Productos:",type:"multiselect",placeholder:"Todos",style:"w-full",validators:{},selectOptions:l},{name:"date_ini",label:"Fecha inicio:",type:"date",validators:{}},{name:"date_end",label:"Fecha final:",type:"date",validators:{}}]},title:"Filtros",dgheigth:615,dgwidth:550,value:i.localFilter}).subscribe(function(){var c=(0,d.Z)(function*(r){if(i.sharedvar.wait=!1,r){if(r.alldates)r.date_ini=0,r.date_end=0;else{let u=new Date(r.date_ini||0);r.date_ini=u.setHours(0,0,0,0),u=new Date(r.date_end||0),r.date_end=u.setHours(23,59,59,999)}const A=[];r.products&&r.products.length>0&&r.products.forEach(u=>{const y=l.find(B=>B.key===u);y&&A.push(y.value)}),i.localFilter={crm:"T",staff__id:r.staff__id,pollGrpData:r.pollGrpData,costumers:r.costumers,products:r.products,date_ini:r.date_ini,date_end:r.date_end,products_name_sel:[...A]},yield i.executeFilter()}});return function(r){return c.apply(this,arguments)}}())})()}mousepos(i){this.mpos.x=i.clientX,this.mpos.y=i.clientY}onSelect(i){var o=this;return(0,d.Z)(function*(){let e=document.getElementById("chartTrigger");e&&(o.graphevent=i,e.style.display="",e.style.position="absolute",e.style.left=o.mpos.x+5+"px",e.style.top=o.mpos.y+5+"px",o.chartTrigger.openMenu())})()}getGraphInfo(i){var o=this;return(0,d.Z)(function*(){const e=o.graphevent.meta.split(":"),n=o.staffList.find(p=>p._id===e[0]);if(n?.appoint&&n.appoint[Number(e[1])])switch(i){case 0:case 1:case 2:break;case 4:o.staffServ.onAddEditAppoint(n,Number(e[1]))}})()}onExportexcel(){const i=`Reporte CRM fechas ${this.sharedvar.formatNumber2Date(this.localFilter.date_ini||0,"-")} - \n    ${this.sharedvar.formatNumber2Date(this.localFilter.date_end||0,"-")}`;this.data2excel.excelExport(this.dataList,i,"CRM",this.header,[])}onSelPivot(i){this.pivot=i}getPivotName(){switch(this.pivot){case 0:return"Tasker";case 1:return"Actividades";case 2:return"Clientes";case 3:return"Productos"}return""}static#t=this.\u0275fac=function(o){return new(o||a)(t.Y36(b.D),t.Y36(Z.x),t.Y36(L.k),t.Y36(k.x),t.Y36(C.Z),t.Y36(v.ux))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-appoint-list"]],viewQuery:function(o,e){if(1&o&&(t.Gf(U,5),t.Gf(D,5)),2&o){let n;t.iGM(n=t.CRH())&&(e.editControlTrigger=n.first),t.iGM(n=t.CRH())&&(e.chartTrigger=n.first)}},decls:57,vars:12,consts:[[1,"flex","flex-col","max-h-screen"],[3,"buttons","nav_menu","bar_text","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"flex-1","m-2","bg-gray-100","overflow-scroll",3,"mousemove"],[1,"border","border-gray-200","rounded-sm","shadow-lg"],[3,"data","pivot","bartype","onSelect"],["id","chartTrigger",3,"matMenuTriggerFor"],["chartTrigger","matMenuTrigger"],["controlEdit","matMenu"],[1,"ml-3"],["mat-menu-item","",3,"click"],[4,"ngIf"],[1,"ml-1","mt-1","text-violet-500","text-lg","font-medium"],["mat-menu-item",""],["graphMenu","matMenu"]],template:function(o,e){if(1&o&&(t.TgZ(0,"div",0)(1,"app-header",1),t.NdJ("onClicked",function(l){return e.getClicked(l)}),t.qZA(),t._UZ(2,"span",2,3),t.TgZ(4,"div",4),t.NdJ("mousemove",function(l){return e.mousepos(l)}),t.TgZ(5,"div",5)(6,"app-time-line",6),t.NdJ("onSelect",function(l){return e.onSelect(l)}),t.qZA()(),t._UZ(7,"span",7,8),t.qZA()(),t.TgZ(9,"mat-menu",null,9)(11,"div",10)(12,"button",11),t.NdJ("click",function(){return e.onSelPivot(0)}),t.YNc(13,N,2,0,"mat-icon",12),t._uU(14," Tasker "),t.qZA(),t.TgZ(15,"button",11),t.NdJ("click",function(){return e.onSelPivot(1)}),t.YNc(16,M,2,0,"mat-icon",12),t._uU(17," Actividad "),t.qZA(),t.TgZ(18,"button",11),t.NdJ("click",function(){return e.onSelPivot(2)}),t.YNc(19,J,2,0,"mat-icon",12),t._uU(20," Cliente "),t.qZA(),t.TgZ(21,"button",11),t.NdJ("click",function(){return e.onSelPivot(3)}),t.YNc(22,S,2,0,"mat-icon",12),t._uU(23," Producto "),t.qZA()(),t._UZ(24,"hr"),t.TgZ(25,"h2",13)(26,"mat-icon"),t._uU(27,"file_download"),t.qZA(),t._uU(28,"\xa0Exportar"),t.qZA(),t.TgZ(29,"div",10)(30,"button",11),t.NdJ("click",function(){return e.onExportexcel()}),t._uU(31," Exportar Informe a Excel. "),t.qZA(),t.TgZ(32,"button",14),t._uU(33," Enviar Informe a Google Spread Sheet "),t.qZA()()(),t.TgZ(34,"mat-menu",null,15)(36,"button",11),t.NdJ("click",function(){return e.getGraphInfo(0)}),t.TgZ(37,"mat-icon"),t._uU(38,"task_alt"),t.qZA(),t._uU(39," Datos de la encuesta "),t.qZA(),t.TgZ(40,"button",11),t.NdJ("click",function(){return e.getGraphInfo(1)}),t.TgZ(41,"mat-icon"),t._uU(42,"perm_identity"),t.qZA(),t._uU(43," Datos del tasker "),t.qZA(),t.TgZ(44,"button",11),t.NdJ("click",function(){return e.getGraphInfo(2)}),t.TgZ(45,"mat-icon"),t._uU(46,"forum"),t.qZA(),t._uU(47," Conversar con el tasker "),t.qZA(),t.TgZ(48,"button",11),t.NdJ("click",function(){return e.getGraphInfo(3)}),t.TgZ(49,"mat-icon"),t._uU(50,"room"),t.qZA(),t._uU(51," Ubicaci\xf3n "),t.qZA(),t._UZ(52,"hr"),t.TgZ(53,"button",11),t.NdJ("click",function(){return e.getGraphInfo(4)}),t.TgZ(54,"mat-icon"),t._uU(55,"room"),t.qZA(),t._uU(56," Editar Agenda "),t.qZA()()),2&o){const n=t.MAs(10),l=t.MAs(35);t.xp6(1),t.Q6J("buttons","111111")("nav_menu",!1)("bar_text",e.bar_txt),t.xp6(1),t.Q6J("matMenuTriggerFor",n),t.xp6(4),t.Q6J("data",e.dataList)("pivot",e.pivot)("bartype",e.bartype),t.xp6(1),t.Q6J("matMenuTriggerFor",l),t.xp6(6),t.Q6J("ngIf",0===e.pivot),t.xp6(3),t.Q6J("ngIf",1===e.pivot),t.xp6(3),t.Q6J("ngIf",2===e.pivot),t.xp6(3),t.Q6J("ngIf",3===e.pivot)}},dependencies:[_.O5,x.G,m.VK,m.OP,m.p6,T.Hw,F.g]})}return a})()}];let I=(()=>{class a{static#t=this.\u0275fac=function(o){return new(o||a)};static#e=this.\u0275mod=t.oAB({type:a});static#i=this.\u0275inj=t.cJS({imports:[g.Bz.forChild(G),g.Bz]})}return a})();var E=s(769),P=s(3279),Y=s(6483);let q=(()=>{class a{static#t=this.\u0275fac=function(o){return new(o||a)};static#e=this.\u0275mod=t.oAB({type:a});static#i=this.\u0275inj=t.cJS({imports:[_.ez,I,E.O,v.ZX,P.X,m.Tx,T.Ps,Y.q]})}return a})()}}]);