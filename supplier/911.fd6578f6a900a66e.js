"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[911],{911:($,h,a)=>{a.r(h),a.d(h,{PollCrmModule:()=>F});var f=a(7087),v=a(3759),u=a(3241),t=a(2283),x=a(4758),C=a(3620),_=a(6806),Z=a(4537),y=a(9666),T=a(3578),m=a(9347),g=a(8464);const P=["editControlTrigger"];function A(r,p){if(1&r){const e=t.EpF();t.TgZ(0,"div",12)(1,"div",13),t._uU(2),t.qZA(),t.TgZ(3,"div",14),t._uU(4,"Contacto:"),t.qZA(),t._uU(5,"\xa0 "),t.TgZ(6,"div",15),t._uU(7),t.qZA(),t._UZ(8,"div",16),t.TgZ(9,"div",14),t._uU(10,"Tel\xe9fono:"),t.qZA(),t._uU(11,"\xa0 "),t.TgZ(12,"div",17),t._uU(13),t.qZA(),t.TgZ(14,"mat-icon",18),t.NdJ("click",function(){const s=t.CHM(e).index,c=t.oxw(2);return t.KtG(c.onDeleteCost(s))}),t._uU(15,"delete"),t.qZA()()}if(2&r){const e=p.$implicit,o=t.oxw(2);t.xp6(2),t.Oqu(o.getStrData(1,e)),t.xp6(5),t.Oqu(o.getStrData(3,e)),t.xp6(6),t.Oqu(o.getStrData(4,e))}}function S(r,p){if(1&r&&(t.TgZ(0,"div")(1,"div",10),t.YNc(2,A,16,3,"div",11),t.qZA()()),2&r){const e=t.oxw();t.xp6(2),t.Q6J("ngForOf",e.sharedvar.pollGrpExecuted.costumerList)}}function b(r,p){if(1&r){const e=t.EpF();t.TgZ(0,"div",20)(1,"div",21),t._uU(2),t.qZA(),t.TgZ(3,"div",13),t._uU(4),t.qZA(),t.TgZ(5,"mat-icon",18),t.NdJ("click",function(){const s=t.CHM(e).index,c=t.oxw(2);return t.KtG(c.onDeleteProd(s))}),t._uU(6,"delete"),t.qZA()()}if(2&r){const e=p.$implicit,o=t.oxw(2);t.xp6(2),t.Oqu(o.getStrData(0,e)),t.xp6(2),t.Oqu(o.getStrData(1,e))}}function G(r,p){if(1&r&&(t.TgZ(0,"div")(1,"div",10),t.YNc(2,b,7,2,"div",19),t.qZA()()),2&r){const e=t.oxw();t.xp6(2),t.Q6J("ngForOf",e.sharedvar.pollGrpExecuted.productList)}}const E=[{path:"",component:(()=>{class r{constructor(e,o,n,s,c){this.sharedvar=e,this.ds=o,this.dtb=n,this.staffServ=s,this.prodserv=c,this.tabSelected=0,this.tabSelectedName="Lista de Clientes"}getClicked(e){switch(e.index){case 2:0===this.tabSelected?this.onSelCost():this.onSelProd();break;case 3:let o=document.getElementById("spanTrigger");o&&(o.style.display="",o.style.position="absolute",o.style.left=e.pageX+5+"px",o.style.top=e.pageY+5+"px",this.editControlTrigger.openMenu())}}selCostumer(){this.tabSelected=0,this.tabSelectedName="Lista de Clientes"}selProd(){this.tabSelected=1,this.tabSelectedName="Lista de Productos"}onSelProd(){var e=this;return(0,u.Z)(function*(){const o=[],n=yield e.prodserv.getAllCRMProdAsync("parent");n&&(n.forEach(c=>{c&&o.push({selected:!1,myid:c.code,name:c.description,hide1:c._id})}),e.ds.aSelectDefault({title:"Seleccione Productos",dgheigth:450,viewfilter:!0,viewAdd:!1,multiSelect:!0,valuelst:o}).subscribe(function(){var c=(0,u.Z)(function*(i){i&&(i.forEach(d=>{e.sharedvar.pollGrpExecuted.productList?.includes(d.myid)||e.sharedvar.pollGrpExecuted.productList?.push(`${d.myid}:${d.name}:${d.hide1}`)}),yield e.dtb.updatePollGroupAsync(e.sharedvar.pollGrpExecuted))});return function(i){return c.apply(this,arguments)}}()))})()}onDeleteProd(e){var o=this;return(0,u.Z)(function*(){o.sharedvar.pollGrpExecuted.productList?.splice(e,1),yield o.dtb.updatePollGroupAsync(o.sharedvar.pollGrpExecuted)})()}getStrData(e,o){return o.split(":")[e]||""}onSelCost(){var e=this;return(0,u.Z)(function*(){const o=[],n=yield e.dtb.getActiveCRMCostumAsync();n&&(n.forEach(c=>{if(c){const i=c;0===e.sharedvar.pollGrpExecuted.costumerList?.filter(l=>l.split(":")[0].includes(i.id))?.length&&o.push({selected:!1,myid:i.id,name:i.name,hide1:i._id,hide2:i.linkup_1,hide3:i.phone_1,hide4:i.email_1})}}),e.ds.aSelectDefault({title:"Seleccione Clientes",dgheigth:450,viewfilter:!0,viewAdd:!0,multiSelect:!0,valuelst:o}).subscribe(function(){var c=(0,u.Z)(function*(i){if(i){let d="";if(!0===i.new){const l=yield e.staffServ.newCostumer(e.staffServ);if(!l)return;d=`${l.id}:${l.name}:${l._id}:${l.linkup_1}:${l.phone_1}`,e.sharedvar.pollGrpExecuted.costumerList?.push(d)}else i.forEach(l=>{d=`${l.myid}:${l.name}:${l.hide1}:${l.hide2}:${l.hide3}`,e.sharedvar.pollGrpExecuted.costumerList?.push(d)});e.sharedvar.pollGrpExecuted.costumerList?.sort((l,L)=>l.split(":")[1].localeCompare(L.split(":")[1])),yield e.dtb.updatePollGroupAsync(e.sharedvar.pollGrpExecuted)}});return function(i){return c.apply(this,arguments)}}()))})()}onDeleteCost(e){var o=this;return(0,u.Z)(function*(){o.sharedvar.pollGrpExecuted.costumerList?.splice(e,1),yield o.dtb.updatePollGroupAsync(o.sharedvar.pollGrpExecuted)})()}static#t=this.\u0275fac=function(o){return new(o||r)(t.Y36(x.D),t.Y36(C.n),t.Y36(_.k),t.Y36(Z.x),t.Y36(y.M))};static#e=this.\u0275cmp=t.Xpm({type:r,selectors:[["app-poll-crm"]],viewQuery:function(o,n){if(1&o&&t.Gf(P,5),2&o){let s;t.iGM(s=t.CRH())&&(n.editControlTrigger=s.first)}},decls:22,vars:7,consts:[[1,"flex","flex-col","max-h-screen"],[3,"buttons","nav_menu","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"h-10","flex","items-center","justify-center","bg-slate-100","text-xl"],[3,"matMenuTriggerFor"],[1,"flex-1","m-2","overflow-scroll"],[4,"ngIf"],["controlEdit","matMenu"],["mat-menu-item","",3,"click"],[1,"flex-col","flex-wrap","p-2","gap-1"],["class","h-7 flex gap-1 mt-1 border-b border-gray-100 font-thin text-sm",4,"ngFor","ngForOf"],[1,"h-7","flex","gap-1","mt-1","border-b","border-gray-100","font-thin","text-sm"],[1,"flex-1","font-medium"],[1,"font-thin"],[1,"w-60","font-thin","text-gray-400"],[1,"w-2"],[1,"w-28","font-thin","text-gray-400"],[1,"text-gray-200","hover:text-violet-500",3,"click"],["class","h-10 flex gap-1 border-b border-gray-100 font-thin text-sm",4,"ngFor","ngForOf"],[1,"h-10","flex","gap-1","border-b","border-gray-100","font-thin","text-sm"],[1,"w-16"]],template:function(o,n){if(1&o&&(t.TgZ(0,"div",0)(1,"app-header",1),t.NdJ("onClicked",function(c){return n.getClicked(c)}),t.qZA(),t._UZ(2,"span",2,3),t.TgZ(4,"div",4)(5,"div"),t._uU(6),t.qZA(),t.TgZ(7,"mat-icon",5),t._uU(8,"arrow_drop_down"),t.qZA()(),t.TgZ(9,"div",6),t.YNc(10,S,3,1,"div",7),t.YNc(11,G,3,1,"div",7),t.qZA(),t.TgZ(12,"mat-menu",null,8)(14,"button",9),t.NdJ("click",function(){return n.selCostumer()}),t.TgZ(15,"mat-icon"),t._uU(16,"people"),t.qZA(),t._uU(17," Seleccionar Clientes "),t.qZA(),t.TgZ(18,"button",9),t.NdJ("click",function(){return n.selProd()}),t.TgZ(19,"mat-icon"),t._uU(20,"shopping_cart"),t.qZA(),t._uU(21," Seleccionar Productos "),t.qZA()()()),2&o){const s=t.MAs(13);t.xp6(1),t.Q6J("buttons","101100")("nav_menu",!0),t.xp6(1),t.Q6J("matMenuTriggerFor",s),t.xp6(4),t.Oqu(n.tabSelectedName),t.xp6(1),t.Q6J("matMenuTriggerFor",s),t.xp6(3),t.Q6J("ngIf",0===n.tabSelected),t.xp6(1),t.Q6J("ngIf",1===n.tabSelected)}},dependencies:[f.sg,f.O5,T.G,m.VK,m.OP,m.p6,g.Hw]})}return r})()}];let U=(()=>{class r{static#t=this.\u0275fac=function(o){return new(o||r)};static#e=this.\u0275mod=t.oAB({type:r});static#o=this.\u0275inj=t.cJS({imports:[v.Bz.forChild(E),v.Bz]})}return r})();var M=a(769);let F=(()=>{class r{static#t=this.\u0275fac=function(o){return new(o||r)};static#e=this.\u0275mod=t.oAB({type:r});static#o=this.\u0275inj=t.cJS({imports:[f.ez,U,M.O,m.Tx,g.Ps]})}return r})()}}]);