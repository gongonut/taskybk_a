"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[794],{1842:(M,f,s)=>{s.d(f,{y:()=>d});var c=s(3241),t=s(6339),v=s(1781),_=s(7254),O=s(5180),u=s(4070),x=s(1173),m=s(5534),g=s(506),T=s(8137),C=s(1030);const y=["eval_string"];function E(r,h){if(1&r){const n=t.EpF();t.TgZ(0,"div",9)(1,"div",10)(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"span",11)(5,"mat-icon",12),t.NdJ("click",function(){t.CHM(n);const o=t.oxw().index,e=t.oxw();return t.KtG(e.setExpand(o))}),t._uU(6,"edit"),t.qZA()(),t.TgZ(7,"span",13)(8,"mat-icon",12),t.NdJ("click",function(){t.CHM(n);const o=t.oxw().index,e=t.oxw();return t.KtG(e.deleteShoppingCondition(o))}),t._uU(9,"delete"),t.qZA()()(),t.TgZ(10,"div",14)(11,"div")(12,"span",15),t._uU(13,"Variable base: "),t.qZA(),t.TgZ(14,"span"),t._uU(15),t.qZA()(),t.TgZ(16,"div",15),t._uU(17,"Evaluaci\xf3n:"),t.qZA(),t.TgZ(18,"div",16),t._uU(19),t.qZA()()()}if(2&r){const n=t.oxw().$implicit;t.xp6(3),t.Oqu(n.title),t.xp6(12),t.Oqu(n.name),t.xp6(4),t.Oqu(n.eval_string)}}function A(r,h){if(1&r){const n=t.EpF();t.TgZ(0,"div",17)(1,"span",18)(2,"mat-icon",12),t.NdJ("click",function(){t.CHM(n);const o=t.oxw().index,e=t.oxw();return t.KtG(e.setExpand(o))}),t._uU(3,"expand_less"),t.qZA()(),t._UZ(4,"div",19),t.TgZ(5,"app-dynamic-form",20),t.NdJ("result",function(o){t.CHM(n);const e=t.oxw().index,p=t.oxw();return t.KtG(p.onGetData(o,e))}),t.qZA(),t.TgZ(6,"div",21)(7,"mat-form-field",22)(8,"mat-label"),t._uU(9,"Evaluar"),t.qZA(),t.TgZ(10,"textarea",23,24),t.NdJ("ngModelChange",function(o){t.CHM(n);const e=t.oxw().$implicit;return t.KtG(e.eval_string=o)})("change",function(o){t.CHM(n);const e=t.oxw().index,p=t.oxw();return t.KtG(p.onEvalStringChange(o,e))}),t.qZA()(),t.TgZ(12,"button",25),t.NdJ("click",function(){t.CHM(n);const o=t.oxw(2);return t.KtG(o.selectNamesOptions())}),t.TgZ(13,"mat-icon"),t._uU(14,"expand_more"),t.qZA()(),t.TgZ(15,"button",25),t.NdJ("click",function(){t.CHM(n);const o=t.oxw(2);return t.KtG(o.selectCategOptions())}),t.TgZ(16,"mat-icon"),t._uU(17,"list"),t.qZA()()()()}if(2&r){const n=t.oxw().$implicit,i=t.oxw();t.xp6(5),t.Q6J("jsonFormData",i.condSchema)("values",n),t.xp6(5),t.Q6J("ngModel",n.eval_string)}}function P(r,h){if(1&r&&(t.TgZ(0,"div"),t.YNc(1,E,20,3,"div",7),t.YNc(2,A,18,3,"div",8),t.qZA()),2&r){const n=h.index,i=t.oxw();t.xp6(1),t.Q6J("ngIf",!i.getExpand(n)),t.xp6(1),t.Q6J("ngIf",i.getExpand(n))}}let d=(()=>{class r{constructor(n,i,o){this.ds=n,this.snkBar=i,this.prodserv=o,this.subfilterlist=[],this.categList=[],this.onChangeCond=new t.vpe,this.condSchema={controls:[{label:"T\xedtulo",name:"title",validators:{},type:"text",style:"w-96"},{label:"Nombre",name:"name",validators:{},type:"select",style:"w-96",selectOptions:[]}]},this.reset=0,this.expandedIndex=-1,this.shoppingConditions=[],this.ngOnChanges()}ngOnChanges(){if(!this.category&&!this.product)return;const n=this.condSchema.controls?.find(i=>"name"===i.name);n&&(this.product?(n.selectOptions=[{key:"@CANTIDAD_POR_PRODUCTO",value:"@CANTIDAD_POR_PRODUCTO"},{key:"@DESCUENTO_POR_PRODUCTO",value:"@DESCUENTO_POR_PRODUCTO"},{key:"@IMPUESTO_POR_PRODUCTO",value:"@IMPUESTO_POR_PRODUCTO"},{key:"@OFERTA_POR_PRODUCTO",value:"@OFERTA_POR_PRODUCTO"},{key:"@PRECIO_POR_PRODUCTO",value:"@PRECIO_POR_PRODUCTO"}],this.shoppingConditions=JSON.parse(JSON.stringify(this.product.shoppingConditions?this.product.shoppingConditions:[]))):(n.selectOptions=[{key:"@CANTIDAD_TOTAL",value:"@CANTIDAD_TOTAL"},{key:"@CUPON_TOTAL",value:"@CUPON_TOTAL"},{key:"@DESCUENTO_TOTAL",value:"@DESCUENTO_TOTAL"},{key:"@IMPUESTO_TOTAL",value:"@IMPUESTO_TOTAL"},{key:"@OFERTA_TOTAL",value:"@OFERTA_TOTAL"},{key:"@PRECIO_TOTAL",value:"@PRECIO_TOTAL"}],this.shoppingConditions=JSON.parse(JSON.stringify(this.category.shoppingConditions?this.category.shoppingConditions:[]))),n.selectOptions.push({key:"@INFORMATION",value:"@INFORMACI\xd3N"}))}ngOnDestroy(){this.onChangeCond.emit(this.product||this.category||null)}onHeaderAddClick(){this.category&&!this.category.shoppingConditions&&(this.shoppingConditions=[]),this.product&&!this.product.shoppingConditions&&(this.shoppingConditions=[]),this.shoppingConditions.push({name:"",title:"",eval_string:""}),this.expandedIndex=this.shoppingConditions.length-1}selectCategOptions(){var n=this;return(0,c.Z)(function*(){const i=[];for(let e=0;e<n.categList.length;e++){if(-1===n.subfilterlist.findIndex(a=>a===n.categList[e]._id))continue;const p=n.categList[e];for(let a=0;a<p.characterList.length;a++){const l=p.characterList[a];for(let D=0;D<l.data.length;D++){const U=l.data[D];i.push({myid:U.id,name:`${p.name} - ${l.header} - ${U.title}`})}}}n.ds.aSelectDefault({title:"Propiedades afectadas por el filtro.",dgheigth:450,viewfilter:!0,viewAdd:!1,viewEdit:!1,viewDel:!1,multiSelect:!1,valuelst:i}).subscribe(function(){var e=(0,c.Z)(function*(p){p&&n.setTextToCurrentPos(`@${p[0].name}`)});return function(p){return e.apply(this,arguments)}}())})()}selectNamesOptions(){var n=this;return(0,c.Z)(function*(){const i=[],e=n.condSchema.controls?.find(a=>"name"===a.name)?.selectOptions?.map(a=>a.key);e&&e.length>0&&e.forEach(a=>i.push({selected:!1,myid:a,name:a})),n.ds.aSelectDefault({title:"Nombres de la canasta.",dgheigth:450,viewfilter:!0,viewAdd:!1,viewEdit:!1,viewDel:!1,multiSelect:!1,valuelst:i}).subscribe(function(){var a=(0,c.Z)(function*(l){l&&n.setTextToCurrentPos(l[0].name)});return function(l){return a.apply(this,arguments)}}())})()}setExpand(n){this.expandedIndex=n===this.expandedIndex?-1:n,this.onChangeCond.emit(this.product||this.category||null)}getExpand(n){return n===this.expandedIndex}onGetData(n,i){!n._propName_||""===n._propName_||(this.product&&this.product.shoppingConditions&&(this.product.shoppingConditions=this.shoppingConditions,"name"===n._propName_&&(this.product.shoppingConditions[i].eval_string=n.name,this.shoppingConditions[i].eval_string=n.name)),this.category&&this.category.shoppingConditions&&(this.category.shoppingConditions=this.shoppingConditions,"name"===n._propName_&&(this.category.shoppingConditions[i].eval_string=n.name,this.shoppingConditions[i].eval_string=n.name)))}onEvalStringChange(n,i){this.product&&this.product.shoppingConditions&&(this.product.shoppingConditions[i].eval_string=this.shoppingConditions[i].eval_string),this.category&&this.category.shoppingConditions&&(this.category.shoppingConditions[i].eval_string=this.shoppingConditions[i].eval_string)}setTextToCurrentPos(n){const i=this._eval_string.nativeElement,o=i.selectionStart;let e=this.shoppingConditions[this.expandedIndex].eval_string||"";this.shoppingConditions[this.expandedIndex].eval_string=e.slice(0,o)+n+e.slice(o),i.focus(),i.setSelectionRange(o,0)}deleteShoppingCondition(n){var i=this;this.snkBar.open(`\xbfEliminar ${this.shoppingConditions[n].title}?`,"Ok",{duration:5e3}).onAction().subscribe(function(){var o=(0,c.Z)(function*(e){i.shoppingConditions.splice(n,1),i.product&&i.product.shoppingConditions&&i.product.shoppingConditions.splice(n,1),i.category&&i.category.shoppingConditions&&i.category.shoppingConditions.splice(n,1),i.onChangeCond.emit(i.product||i.category||null)});return function(e){return o.apply(this,arguments)}}())}static#t=this.\u0275fac=function(i){return new(i||r)(t.Y36(v.n),t.Y36(_.ux),t.Y36(O.M))};static#n=this.\u0275cmp=t.Xpm({type:r,selectors:[["app-shopping-cond"]],viewQuery:function(i,o){if(1&i&&t.Gf(y,5),2&i){let e;t.iGM(e=t.CRH())&&(o._eval_string=e.first)}},inputs:{product:"product",category:"category",subfilterlist:"subfilterlist",categList:"categList"},outputs:{onChangeCond:"onChangeCond"},features:[t.TTD],decls:10,vars:1,consts:[[1,"px-2","flex","flex-col","gap-2","bg-gray-100","overflow-auto"],[1,"flex","flex-row","align-middle"],[1,"grow","flex","flex-row","items-center","justify-center","text-sky-200"],[1,"text-center","font-medium","text-black"],[1,"hover:text-sky-500",3,"click"],[1,"flex-1","px-2","pt-3","mt-1","overflow-auto"],[4,"ngFor","ngForOf"],["class","border-t border-gray-300 p-2 m-2 max-h-56 overflow-auto",4,"ngIf"],["class","bg-gray-200 p-2 ",4,"ngIf"],[1,"border-t","border-gray-300","p-2","m-2","max-h-56","overflow-auto"],[1,"font-medium","text-lg","text-gray-800"],[1,"text-sky-200","ml-4","hover:text-sky-500"],[3,"click"],[1,"text-red-200","ml-4","hover:text-red-500"],[1,"pl-4"],[1,"font-medium"],[1,"border","border-gray-400","bg-gray-50","rounded-md","p-2"],[1,"bg-gray-200","p-2"],[1,"flex-1","text-sky-700","hover:text-sky-400"],[1,"h-1"],[1,"flex-1","p-1",3,"jsonFormData","values","result"],[1,"flex"],["appearance","outline",1,"w-full","bg-white"],["matInput","",3,"ngModel","ngModelChange","change"],["eval_string",""],[1,"ml-1","mb-6","h-[3.4rem]","w-14","bg-white","font-semibold","text-violet-500","border","border-gray-200","rounded","shadow-sm",3,"click"]],template:function(i,o){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t._uU(4,"Condiciones del carrito de compras"),t.qZA(),t._uU(5," \xa0\xa0\xa0 "),t.TgZ(6,"mat-icon",4),t.NdJ("click",function(){return o.onHeaderAddClick()}),t._uU(7,"add"),t.qZA()()(),t.TgZ(8,"div",5),t.YNc(9,P,3,2,"div",6),t.qZA()()),2&i&&(t.xp6(9),t.Q6J("ngForOf",o.shoppingConditions))},dependencies:[u.sg,u.O5,x.Nt,m.KE,m.hX,g.Fj,g.JJ,g.On,T.Hw,C.r]})}return r})()},6532:(M,f,s)=>{s.d(f,{U:()=>P});var c=s(4070),t=s(781),v=s(1842),_=s(6339);const O=[{path:"",component:v.y}];let u=(()=>{class d{static#t=this.\u0275fac=function(n){return new(n||d)};static#n=this.\u0275mod=_.oAB({type:d});static#i=this.\u0275inj=_.cJS({imports:[t.Bz.forChild(O),t.Bz]})}return d})();var x=s(8137),m=s(4370),g=s(7826),T=s(5534),C=s(506),y=s(1173),E=s(7774),A=s(7254);let P=(()=>{class d{static#t=this.\u0275fac=function(n){return new(n||d)};static#n=this.\u0275mod=_.oAB({type:d});static#i=this.\u0275inj=_.cJS({imports:[c.ez,y.c,C.UX,T.lN,C.u5,u,x.Ps,E.N,m.ot,g.p9,A.ZX]})}return d})()}}]);