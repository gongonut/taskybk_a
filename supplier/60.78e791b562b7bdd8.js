"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[60],{7355:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{p:()=>PollDetailComponent});var C_Users_Juan_Carlos_Documents_proyectos_tasky_tasky_supplier_node_modules_pnpm_babel_runtime_7_20_13_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3241),_angular_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6339),src_app_shared_var_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(6789),src_app_dialog_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3792),_angular_material_snack_bar__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7254),src_app_database_service__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(3016),_angular_common__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(4070),_components_dynamic_form_dynamic_form_component__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(1030),_angular_material_menu__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(4156),_angular_material_icon__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(8137),_angular_material_tooltip__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(4179);const _c0=["editControlTrigger"];function PollDetailComponent_div_2_Template(s,i){if(1&s){const l=_angular_core__WEBPACK_IMPORTED_MODULE_1__.EpF();_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(0,"div",9)(1,"app-dynamic-form",10),_angular_core__WEBPACK_IMPORTED_MODULE_1__.NdJ("result",function(p){_angular_core__WEBPACK_IMPORTED_MODULE_1__.CHM(l);const m=_angular_core__WEBPACK_IMPORTED_MODULE_1__.oxw();return _angular_core__WEBPACK_IMPORTED_MODULE_1__.KtG(m.onGetData(p))})("dropped",function(p){_angular_core__WEBPACK_IMPORTED_MODULE_1__.CHM(l);const m=_angular_core__WEBPACK_IMPORTED_MODULE_1__.oxw();return _angular_core__WEBPACK_IMPORTED_MODULE_1__.KtG(m.onDrop(p))}),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA()()}if(2&s){const l=_angular_core__WEBPACK_IMPORTED_MODULE_1__.oxw();_angular_core__WEBPACK_IMPORTED_MODULE_1__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_1__.Q6J("jsonFormData",l.sharedvar.pollSelected.schema)("editButton","more_horiz")("commands",l.commandIcon)}}let PollDetailComponent=(()=>{class _PollDetailComponent{constructor(s,i,l,c){this.sharedvar=s,this.dg=i,this.snkBar=l,this.dtb=c,this.deleteDrop=!1,this.commandIcon=""}ngOnInit(){return(0,C_Users_Juan_Carlos_Documents_proyectos_tasky_tasky_supplier_node_modules_pnpm_babel_runtime_7_20_13_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)(function*(){})()}ngOnDestroy(){}getClicked(s){2===s.index&&this.onAddEditControl(-1)}onAddEditControl(s=-1){var i=this;return(0,C_Users_Juan_Carlos_Documents_proyectos_tasky_tasky_supplier_node_modules_pnpm_babel_runtime_7_20_13_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)(function*(){if(!i.sharedvar.pollSelected)return void i.snkBar.open("Seleccione un formulario.","Ok",{duration:5e3});let c,l="";i.sharedvar.pollSelected.schema.controls||(i.sharedvar.pollSelected.schema.controls=[]),s>=0&&(c=JSON.parse(JSON.stringify(i.sharedvar.pollSelected.schema.controls[s])),l=i.sharedvar.pollSelected.schema.controls[s].name);const p=yield i.dg.aDinamycDialog(c);if(p){if(!p._valid_)return void i.snkBar.open("Debe ingresar la informaci\xf3n solicitada.","Ok",{duration:5e3});let m=JSON.parse(JSON.stringify(i.sharedvar.pollSelected?.schema));const e=i.buildPollItem(p);if(l!==e.name){if(e.name=i.sharedvar.validateName(e.name),!e.name)return void i.snkBar.open("El nombre del control debe estar compuesto por texto y/o n\xfameros y linea abajo, su extenci\xf3n m\xe1xima es de 125 caracteres.","Ok",{duration:1e4});e.name=i.sharedvar.getUniqueName("",e.name,i.sharedvar.pollGrpExecuted.pollList)}c?m.controls[s]=e:(m.controls.push(e),s=m.controls.length-1),i.sharedvar.pollSelected&&(i.sharedvar.pollSelected.schema=m)}})()}buildPollItem(item){const ctrl={name:item.name,label:item.label,type:item.type,validators:item.validators||{}};return item.default&&(ctrl.default=item.default),item.style&&(ctrl.style=item.style),item.default&&(ctrl.default=item.default),item.selectOptions&&(ctrl.selectOptions=eval(item.selectOptions)),item.totalRows&&(ctrl.totalRows=item.totalRows),item.avalue&&(ctrl.avalue=item.avalue),item.description&&(ctrl.description=item.description),item.tags&&(ctrl.tags=item.tags),item.required?ctrl.validators.required=!0:ctrl.validators.nullValidator=!0,item.sideBtn&&(ctrl.sideBtn=item.sideBtn),item.sideBtn2&&(ctrl.sideBtn2=item.sideBtn2),item.disabled&&(ctrl.disabled=item.disabled),ctrl}onGetData(s){this.result=s;const i=this.result._propName_;if(this.sharedvar.pollSelected&&this.sharedvar.pollSelected.schema.controls){const l=this.sharedvar.pollSelected.schema.controls.findIndex(c=>c.name===i);if(l>=0)if("delete"===this.result._command_)this.sharedvar.pollSelected.schema.controls.splice(l,1),this.ctrlSel=-1;else{this.ctrlSel=l;let c=document.getElementById("spanTrigger");c&&(c.style.display="",c.style.position="absolute",c.style.left=s._btnEvent_.pageX+5+"px",c.style.top=s._btnEvent_.pageY+5+"px",this.editControlTrigger.openMenu())}}}onGetGeneralData(s){this.dg.updatePropResult(this.sharedvar.pollSelected,s)}onEditCtrl(){this.onAddEditControl(this.ctrlSel)}onHelpCtrl(){var s=this;return(0,C_Users_Juan_Carlos_Documents_proyectos_tasky_tasky_supplier_node_modules_pnpm_babel_runtime_7_20_13_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)(function*(){if(s.sharedvar.pollSelected&&s.sharedvar.pollSelected.schema&&s.sharedvar.pollSelected.schema.controls){const i=s.sharedvar.pollSelected.schema.controls[s.ctrlSel],c={title:"Ayuda/Tips",schema:{controls:[{name:"help",label:"Ayuda:",type:"textarea",style:"w-full",totalRows:5,validators:{}}]},value:{help:i.tags?i.tags.help:""},dgheigth:315},p=yield s.dg.aDefault(c);p&&(i.tags||(i.tags=[]),i.tags.help=p.help)}})()}onDupCtrl(){if(this.sharedvar.pollSelected&&this.sharedvar.pollSelected.schema.controls){const s={...this.sharedvar.pollSelected.schema.controls[this.ctrlSel]};this.AddCtrl(s)}}onCopyCtrl(){if(this.sharedvar.pollSelected&&this.sharedvar.pollSelected.schema.controls){const i=JSON.stringify({objectname:"controls",controls:[this.sharedvar.pollSelected.schema.controls[this.ctrlSel]]});navigator.clipboard.writeText(i).then(l=>{}).catch(l=>alert(l)),this.snkBar.open("copiado al portapapeles.","Ok",{duration:3e3})}}onCopyModel(){if(this.sharedvar.pollSelected&&this.sharedvar.pollSelected.schema.controls){const i=JSON.stringify({objectname:"controls",controls:this.sharedvar.pollSelected.schema.controls});navigator.clipboard.writeText(i).then(l=>{}).catch(l=>alert(l)),this.snkBar.open("copiado al portapapeles.","Ok",{duration:3e3})}}onPasteControlModel(){var s=this;this.snkBar.open("Esta acci\xf3n agrega controles desde el portapapeles","Continuar",{duration:3e3}).onAction().subscribe(function(){var i=(0,C_Users_Juan_Carlos_Documents_proyectos_tasky_tasky_supplier_node_modules_pnpm_babel_runtime_7_20_13_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)(function*(l){navigator.clipboard.readText().then(function(){var c=(0,C_Users_Juan_Carlos_Documents_proyectos_tasky_tasky_supplier_node_modules_pnpm_babel_runtime_7_20_13_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__.Z)(function*(p){try{const m=JSON.parse(p);if(!m.objectname||"controls"!==m.objectname)return;m.controls.forEach(O=>{s.AddCtrl(O)})}catch(m){console.error("wrong file type: ",m)}});return function(p){return c.apply(this,arguments)}}()).catch(c=>{console.error("Cannot read clipboard text: ",c)})});return function(l){return i.apply(this,arguments)}}())}AddCtrl(s){s.name=this.sharedvar.getUniqueName("",s.name,this.sharedvar.pollGrpExecuted.pollList),this.sharedvar.pollSelected.schema.controls.push(s)}onDrop(s){if(!0===this.deleteDrop){console.log("dropped",s);const i=this.sharedvar.pollSelected.schema.controls.findIndex(l=>l.name===s);i>-1&&this.sharedvar.pollSelected.schema.controls.splice(i,1)}}onMouseover(s){this.deleteDrop=!0}onMouseexit(s){this.deleteDrop=!1}onDeleteControls(){this.commandIcon=""===this.commandIcon?"delete":""}static#_=this.\u0275fac=function s(i){return new(i||_PollDetailComponent)(_angular_core__WEBPACK_IMPORTED_MODULE_1__.Y36(src_app_shared_var_service__WEBPACK_IMPORTED_MODULE_3__.D),_angular_core__WEBPACK_IMPORTED_MODULE_1__.Y36(src_app_dialog_service__WEBPACK_IMPORTED_MODULE_0__.x),_angular_core__WEBPACK_IMPORTED_MODULE_1__.Y36(_angular_material_snack_bar__WEBPACK_IMPORTED_MODULE_4__.ux),_angular_core__WEBPACK_IMPORTED_MODULE_1__.Y36(src_app_database_service__WEBPACK_IMPORTED_MODULE_5__.k))};static#_2=this.\u0275cmp=_angular_core__WEBPACK_IMPORTED_MODULE_1__.Xpm({type:_PollDetailComponent,selectors:[["app-poll-detail"]],viewQuery:function s(i,l){if(1&i&&_angular_core__WEBPACK_IMPORTED_MODULE_1__.Gf(_c0,5),2&i){let c;_angular_core__WEBPACK_IMPORTED_MODULE_1__.iGM(c=_angular_core__WEBPACK_IMPORTED_MODULE_1__.CRH())&&(l.editControlTrigger=c.first)}},decls:41,vars:3,consts:[["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],["class","p-2 flex flex-col items-stretch",4,"ngIf"],["matTooltip","Eliminar el control.",1,"fixed","z-1500","bottom-8","right-28","border-solid","border-2","bg-white","w-16","h-16","rounded-full","drop-shadow-lg","flex","justify-center","items-center","text-violet-700","hover:bg-gray-200",3,"mouseover","mouseout","click"],[1,"fixed","z-1000","bottom-8","right-10","border-solid","border-2","bg-white","w-16","h-16","rounded-full","drop-shadow-lg","flex","justify-center","items-center","text-violet-700","hover:bg-gray-200",3,"matMenuTriggerFor"],["controlEditByCtrl","matMenu"],["mat-menu-item","",3,"click"],[1,"mat-18"],["controlEdit","matMenu"],[1,"p-2","flex","flex-col","items-stretch"],[3,"jsonFormData","editButton","commands","result","dropped"]],template:function s(i,l){if(1&i&&(_angular_core__WEBPACK_IMPORTED_MODULE_1__._UZ(0,"span",0,1),_angular_core__WEBPACK_IMPORTED_MODULE_1__.YNc(2,PollDetailComponent_div_2_Template,2,3,"div",2),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(3,"div",3),_angular_core__WEBPACK_IMPORTED_MODULE_1__.NdJ("mouseover",function(p){return l.onMouseover(p)})("mouseout",function(p){return l.onMouseexit(p)})("click",function(){return l.onDeleteControls()}),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(4,"mat-icon"),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(5,"delete"),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA()(),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(6,"button",4)(7,"mat-icon"),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(8,"menu"),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA()(),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(9,"mat-menu",null,5)(11,"button",6),_angular_core__WEBPACK_IMPORTED_MODULE_1__.NdJ("click",function(){return l.onEditCtrl()}),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(12,"mat-icon",7),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(13,"edit"),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(14," Editar "),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(15,"button",6),_angular_core__WEBPACK_IMPORTED_MODULE_1__.NdJ("click",function(){return l.onHelpCtrl()}),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(16,"mat-icon",7),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(17,"question_mark"),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(18," Ayuda/Tips "),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(19,"button",6),_angular_core__WEBPACK_IMPORTED_MODULE_1__.NdJ("click",function(){return l.onDupCtrl()}),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(20,"mat-icon",7),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(21,"content_copy"),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(22," Duplicar "),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(23,"button",6),_angular_core__WEBPACK_IMPORTED_MODULE_1__.NdJ("click",function(){return l.onCopyCtrl()}),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(24,"mat-icon",7),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(25,"content_copy"),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(26," Copiar "),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA()(),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(27,"mat-menu",null,8)(29,"button",6),_angular_core__WEBPACK_IMPORTED_MODULE_1__.NdJ("click",function(){return l.onAddEditControl()}),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(30,"mat-icon"),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(31,"add"),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(32," Agregar "),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(33,"button",6),_angular_core__WEBPACK_IMPORTED_MODULE_1__.NdJ("click",function(){return l.onCopyModel()}),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(34,"mat-icon"),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(35,"folder_copy"),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(36," Copiar Formulario "),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(37,"button",6),_angular_core__WEBPACK_IMPORTED_MODULE_1__.NdJ("click",function(){return l.onPasteControlModel()}),_angular_core__WEBPACK_IMPORTED_MODULE_1__.TgZ(38,"mat-icon"),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(39,"content_paste"),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_1__._uU(40," Agregar controles desde portapapeles "),_angular_core__WEBPACK_IMPORTED_MODULE_1__.qZA()()),2&i){const c=_angular_core__WEBPACK_IMPORTED_MODULE_1__.MAs(10),p=_angular_core__WEBPACK_IMPORTED_MODULE_1__.MAs(28);_angular_core__WEBPACK_IMPORTED_MODULE_1__.Q6J("matMenuTriggerFor",c),_angular_core__WEBPACK_IMPORTED_MODULE_1__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_1__.Q6J("ngIf",l.sharedvar.pollSelected&&l.sharedvar.pollSelected.schema),_angular_core__WEBPACK_IMPORTED_MODULE_1__.xp6(4),_angular_core__WEBPACK_IMPORTED_MODULE_1__.Q6J("matMenuTriggerFor",p)}},dependencies:[_angular_common__WEBPACK_IMPORTED_MODULE_6__.O5,_components_dynamic_form_dynamic_form_component__WEBPACK_IMPORTED_MODULE_7__.r,_angular_material_menu__WEBPACK_IMPORTED_MODULE_8__.VK,_angular_material_menu__WEBPACK_IMPORTED_MODULE_8__.OP,_angular_material_menu__WEBPACK_IMPORTED_MODULE_8__.p6,_angular_material_icon__WEBPACK_IMPORTED_MODULE_9__.Hw,_angular_material_tooltip__WEBPACK_IMPORTED_MODULE_10__.gM]})}return _PollDetailComponent})()},3060:(s,i,l)=>{l.r(i),l.d(i,{PollListEditModule:()=>oe});var c=l(4070),p=l(781),m=l(3241),e=l(6339),O=l(6789),r=l(3016),u=l(3792),h=l(7254),g=l(8466),f=l(9869),D=l(5429),P=l(1341);let v=(()=>{class n{constructor(t){this.sharedvar=t}readSpreadsheetData(t){return new Promise((o,a)=>{const _=new FileReader;_.onload=d=>{const E=P.ij(d.target.result,{type:"array"}),A=[];E.SheetNames.forEach(w=>{const L=E.Sheets[w];if(0===Object.keys(L).length)return;const W=[],y=P.P6.decode_range(L["!ref"]?.toString()||"");for(let x=y.s.r;x<=y.e.r;x++){const R={};for(let k=y.s.c;k<=y.e.c;k++){const I=P.P6.encode_cell({r:x,c:k}),G=void 0===L[I]?"":L[I].v;if(I.includes("A")&&0===G.length)break;R[P.P6.encode_col(k)]=G}Object.keys(R).length>0&&W.push(R)}A.push({name:w,data:W})}),o(A)},_.onerror=d=>{a(d)},_.readAsArrayBuffer(t)})}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(O.D))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var M=l(4370),T=l(8137),C=l(4179),b=l(4156);const F=["fromexcel"],N=["parent"];function J(n,B){if(1&n){const t=e.EpF();e.TgZ(0,"div",13)(1,"div",14),e._uU(2),e.TgZ(3,"mat-icon",15),e.NdJ("click",function(){const _=e.CHM(t).index,d=e.oxw();return e.KtG(d.onAddEditPoll(_))}),e._uU(4,"edit"),e.qZA()(),e.TgZ(5,"p",16),e._uU(6),e.qZA(),e.TgZ(7,"div",17)(8,"div",18)(9,"div",19)(10,"input",20),e.NdJ("change",function(a){const d=e.CHM(t).$implicit,E=e.oxw();return e.KtG(E.setBoolStartState(d,a))}),e.qZA(),e.TgZ(11,"label",21),e._uU(12,"Inicio"),e.qZA()(),e.TgZ(13,"div",22)(14,"input",23),e.NdJ("change",function(a){const d=e.CHM(t).$implicit,E=e.oxw();return e.KtG(E.setBoolEndState(d,a))}),e.qZA(),e.TgZ(15,"label",24),e._uU(16,"Fin"),e.qZA()()(),e.TgZ(17,"div",25)(18,"div",26),e.NdJ("click",function(){const _=e.CHM(t).index,d=e.oxw();return e.KtG(d.onDelete(_))}),e.TgZ(19,"mat-icon"),e._uU(20,"delete"),e.qZA()(),e.TgZ(21,"div",27),e.NdJ("click",function(){const _=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.onDetaill(_))}),e.TgZ(22,"div",28),e._uU(23,"Detalle"),e.qZA(),e._uU(24," \xa0 "),e.TgZ(25,"div",29)(26,"mat-icon"),e._uU(27,"east"),e.qZA()()()()()()}if(2&n){const t=B.$implicit,o=e.oxw();e.Q6J("ngClass",o.getClass(t)),e.xp6(2),e.hij("",t.title," "),e.xp6(4),e.Oqu(t.description),e.xp6(4),e.Q6J("checked",t.allowStart),e.xp6(4),e.Q6J("checked",t.allowEnd)}}let K=(()=>{class n{constructor(t,o,a,_,d,E,A){this.sharedvar=t,this.dtb=o,this.dg=a,this.snkBar=_,this.nvg=d,this.excel2json=E,this.pollServ=A,this.onSelected=new e.vpe,this.onUpdatedAll=new e.vpe,this.flexHeightClass="overflow-auto flex flex-row flex-wrap p-2 gap-2",this.leftPos=420,this.formData={controls:[{name:"title",label:"Nombre del Formulario:",type:"text",style:"w-full",validators:{required:!0}},{name:"description",label:"Descripci\xf3n:",type:"textarea",totalRows:4,style:"w-full",validators:{}},{name:"allowStart",label:"Iniciar",type:"checkbox",validators:{}},{name:"allowEnd",label:"Finalizar",type:"checkbox",validators:{}}]},this.formDataOnStartEnd={controls:[{name:"sendMail2",label:"Enviar a correos electr\xf3nicos:",type:"textarea",totalRows:4,style:"w-full",validators:{}},{name:"sendCRMMail",label:"Agregar correo del cliente CRM",type:"checkbox",validators:{}},{name:"geoLoc",label:"Agregar ubicaci\xf3n",type:"checkbox",validators:{}}]}}ngOnInit(){return(0,m.Z)(function*(){})()}ngAfterViewInit(){let t=this.parentEl.nativeElement.getBoundingClientRect();this.leftPos!==t.left&&(this.leftPos=t.left)}getLeftButtonPos(){return`fixed z-90 bottom-8 left-[${Math.trunc(this.leftPos+8)}px] border-solid border-2 bg-white w-16 h-16 rounded-full drop-shadow-lg flex justify-center items-center text-violet-700 hover:bg-gray-200`}getClicked(t){2===t.index&&this.onAddEditPoll()}getClass(t){let o="h-[12rem] w-80 rounded-md p-3 shadow-lg ";return this.sharedvar.pollSelected?.id===t.id?o+"bg-yellow-100 ":o+"bg-white "}onAddEditPoll(t=-1){var o=this;return(0,m.Z)(function*(){let a=o.pollServ.newPoll();t>=0&&(a=o.sharedvar.pollGrpExecuted.pollList[t]);const _={title:"Formulario",schema:o.formData,dgwidth:300,dgheigth:450,value:a},d=yield o.dg.aDefault(_);if(d){if(!d._valid_)return void o.snkBar.open("Debe ingresar la informaci\xf3n solicitada.","Ok",{duration:5e3});o.dg.updatePropResult(a,d),t<0?o.sharedvar.pollGrpExecuted.pollList.push(a):o.sharedvar.pollGrpExecuted.pollList[t]=a,o.sharedvar.pollSelected=a}})()}onCopyFromPollList(){if(this.sharedvar.pollSelected&&this.sharedvar.pollSelected.schema.controls){const o=JSON.stringify({objectname:"polllist",controls:this.sharedvar.pollGrpExecuted.pollList});navigator.clipboard.writeText(o).then(a=>{}).catch(a=>alert(a)),this.snkBar.open("copiado al portapapeles.","Ok",{duration:3e3})}}onPasteFromPollList(){var t=this;this.snkBar.open("Esta acci\xf3n reemplazar\xe1 todos los formularios de \xe9ste grupo.","Continuar",{duration:7e3}).onAction().subscribe(function(){var o=(0,m.Z)(function*(a){navigator.clipboard.readText().then(function(){var _=(0,m.Z)(function*(d){try{const E=JSON.parse(d);if(!E.objectname||"polllist"!==E.objectname)return;t.sharedvar.pollGrpExecuted.pollList=E.controls,t.onUpdatedAll.emit(t.sharedvar.pollGrpExecuted.pollList)}catch(E){console.error("wrong file type: ",E)}});return function(d){return _.apply(this,arguments)}}()).catch(_=>{console.error("Cannot read clipboard text: ",_)})});return function(a){return o.apply(this,arguments)}}())}onParseFromPollList(){this.fromexcel.nativeElement.click()}onExcelSelected(t){var o=this;t.target.files.length>0&&this.snkBar.open("Esta agregar\xe1 los formularios de la hoja de c\xe1lculo a su proyecto.","Continuar",{duration:7e3}).onAction().subscribe(function(){var a=(0,m.Z)(function*(_){const d=t.target.files[0],E=yield o.excel2json.readSpreadsheetData(d);return o.pollServ.parsePollList(o.sharedvar.pollGrpExecuted,E),console.log(o.sharedvar.pollGrpExecuted),E});return function(_){return a.apply(this,arguments)}}())}onBackupFromPollList(){var t=this;this.sharedvar.pollSelected&&this.sharedvar.pollSelected.schema.controls&&this.snkBar.open("Esta acci\xf3n genera un backup local del estado actual de los formularios.","Continuar",{duration:7e3}).onAction().subscribe(function(){var o=(0,m.Z)(function*(a){t.dtb.saveLocalBKpollList(t.sharedvar.pollGrpExecuted.id,t.sharedvar.pollGrpExecuted.pollList),t.snkBar.open("Backup actualizado en base de datos local.","Ok",{duration:3e3})});return function(a){return o.apply(this,arguments)}}())}onRestoreFromPollList(){var t=this;return(0,m.Z)(function*(){t.snkBar.open("Esta acci\xf3n reemplazar\xe1 todos los formularios de \xe9ste grupo.","Continuar",{duration:7e3}).onAction().subscribe(function(){var o=(0,m.Z)(function*(a){console.log(t.sharedvar.pollGrpExecuted.id);const _=JSON.parse(yield t.dtb.loadLocalBKpollList(t.sharedvar.pollGrpExecuted.id));!_.objectname||"polllist"!==_.objectname||(t.sharedvar.pollGrpExecuted.pollList=_.controls,t.onUpdatedAll.emit(t.sharedvar.pollGrpExecuted.pollList))});return function(a){return o.apply(this,arguments)}}())})()}setBoolStartState(t,o){t.allowStart=o.target.checked,this.sharedvar.pollGrpExecuted.pollList.sort((a,_)=>Number(_.allowStart)-Number(a.allowStart))}setBoolEndState(t,o){t.allowEnd=o.target.checked}setBool(t){t.allowStart&&this.sharedvar.pollGrpExecuted.pollList.forEach(o=>{o.id!==t.id&&(t.allowStart=!1)})}onStarEndData(t){var o=this;return(0,m.Z)(function*(){let a;a=t?o.sharedvar.pollGrpExecuted.onStart:o.sharedvar.pollGrpExecuted.onEnd;let _={schema:o.formDataOnStartEnd,value:a,title:"Actividades autom\xe1ticas",dgwidth:350,dgheigth:375};const d=yield o.dg.aDefault(_);d&&(t?o.sharedvar.pollGrpExecuted.onStart=d:o.sharedvar.pollGrpExecuted.onEnd=d)})()}onDetaill(t){this.onSelected.emit(t)}onDelete(t){this.onSelected.emit(this.sharedvar.pollGrpExecuted.pollList[t]),this.snkBar.open(`Eliminar: ${this.sharedvar.pollGrpExecuted.pollList[t].title}.`,"Eliminar",{duration:5e3}).onAction().subscribe(o=>{this.sharedvar.pollGrpExecuted.pollList.splice(t,1),this.sharedvar.pollSelected=null})}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(O.D),e.Y36(r.k),e.Y36(u.x),e.Y36(h.ux),e.Y36(D.$),e.Y36(v),e.Y36(g.n))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["app-poll-list"]],viewQuery:function(o,a){if(1&o&&(e.Gf(F,5),e.Gf(N,5)),2&o){let _;e.iGM(_=e.CRH())&&(a.fromexcel=_.first),e.iGM(_=e.CRH())&&(a.parentEl=_.first)}},outputs:{onSelected:"onSelected",onUpdatedAll:"onUpdatedAll"},decls:49,vars:6,consts:[["parent",""],[1,"flex","flex-col","gap-1"],["matTooltip","Inicio del proceso: Agregar ubicaci\xf3n y listado de correos de notificaci\xf3n",1,"flex","items-center","justify-start","h-12","w-80","rounded-md","bg-white","p-3","shadow-lg",3,"click"],[1,"flex-1","mt-1","mb-2","font-medium","leading-tight","overflow-hidden"],["mat-stroked-button","","color","primary"],["matTooltip","Final del proceso: Agregar ubicaci\xf3n y listado de correos de notificaci\xf3n",1,"flex","items-center","justify-start","h-12","w-80","rounded-md","bg-white","p-3","shadow-lg",3,"click"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"matMenuTriggerFor"],["controlEdit","matMenu"],["mat-menu-item","",3,"click"],["mat-menu-item","","jsondata2PollsFromExcel","",3,"click"],["type","file","accept",".xlsx",1,"invisible",3,"change"],["fromexcel",""],[3,"ngClass"],[1,"mb-2","font-medium","leading-tight","overflow-hidden"],[1,"text-violet-500","ml-2",3,"click"],[1,"mb-4","h-12","pl-3","overflow-hidden"],[1,"flex","items-center","justify-start"],[1,"grow"],[1,"flex","items-center","mb-1"],["id","inicio","type","checkbox","matTooltip","Punto de inicio del proceso",1,"w-4","h-4","text-violet-500","bg-gray-100","border-gray-300","rounded","dark:focus:ring-violet-500","dark:ring-offset-gray-800","focus:ring-2","dark:bg-gray-700","dark:border-gray-600",3,"checked","change"],["for","inicio",1,"ml-2","text-sm","font-medium","text-gray-900","dark:text-gray-300"],[1,"flex","items-center"],["checked","","id","fin","type","checkbox","matTooltip","Punto de finalizaci\xf3n del proceso",1,"w-4","h-4","text-violet-500","bg-gray-100","border-gray-300","rounded","dark:focus:ring-violet-500","dark:ring-offset-gray-800","focus:ring-2","dark:bg-gray-700","dark:border-gray-600",3,"checked","change"],["for","fin",1,"ml-2","text-sm","font-medium","text-gray-900","dark:text-gray-300"],[1,"flex","gap-1","text-violet-500","text-sm"],["matTooltip","Elimina formulario",1,"w-9","h-9","p-1","border","border-gray-300","rounded-sm","hover:bg-yellow-50",3,"click"],["matTooltip","Controles asignados al formulario",1,"flex","h-9","p-","border","border-gray-300","rounded-sm","hover:bg-yellow-50",3,"click"],[1,"mt-[0.2rem]","p-1"],[1,"mt-[0.3rem]"]],template:function(o,a){if(1&o&&(e.TgZ(0,"div",null,0)(2,"div",1)(3,"div",2),e.NdJ("click",function(){return a.onStarEndData(!0)}),e.TgZ(4,"div",3),e._uU(5,"Actividades comienzo"),e.qZA(),e.TgZ(6,"div")(7,"button",4),e._uU(8," Detalle "),e.qZA()()(),e.TgZ(9,"div",5),e.NdJ("click",function(){return a.onStarEndData(!1)}),e.TgZ(10,"div",3),e._uU(11,"Actividades Fin"),e.qZA(),e.TgZ(12,"div")(13,"button",4),e._uU(14," Detalle "),e.qZA()()(),e.YNc(15,J,28,5,"div",6),e.qZA(),e.TgZ(16,"button",7)(17,"mat-icon"),e._uU(18,"menu"),e.qZA()()(),e.TgZ(19,"mat-menu",null,8)(21,"button",9),e.NdJ("click",function(){return a.onAddEditPoll()}),e.TgZ(22,"mat-icon"),e._uU(23,"add"),e.qZA(),e._uU(24," Agregar "),e.qZA(),e._UZ(25,"hr"),e.TgZ(26,"button",9),e.NdJ("click",function(){return a.onCopyFromPollList()}),e.TgZ(27,"mat-icon"),e._uU(28,"folder_copy"),e.qZA(),e._uU(29," Copiar lista de formularios "),e.qZA(),e.TgZ(30,"button",9),e.NdJ("click",function(){return a.onPasteFromPollList()}),e.TgZ(31,"mat-icon"),e._uU(32,"content_paste"),e.qZA(),e._uU(33," Pegar desde portapapeles "),e.qZA(),e.TgZ(34,"button",10),e.NdJ("click",function(){return a.onParseFromPollList()}),e.TgZ(35,"mat-icon"),e._uU(36,"content_paste"),e.qZA(),e._uU(37," Importar de hoja de c\xe1lculo... "),e.qZA(),e._UZ(38,"hr"),e.TgZ(39,"button",9),e.NdJ("click",function(){return a.onBackupFromPollList()}),e.TgZ(40,"mat-icon"),e._uU(41,"folder_copy"),e.qZA(),e._uU(42," Crear backup local. "),e.qZA(),e.TgZ(43,"button",9),e.NdJ("click",function(){return a.onRestoreFromPollList()}),e.TgZ(44,"mat-icon"),e._uU(45,"content_paste"),e.qZA(),e._uU(46," Restaurar backup local "),e.qZA()(),e.TgZ(47,"input",11,12),e.NdJ("change",function(d){return a.onExcelSelected(d)}),e.qZA()),2&o){const _=e.MAs(20);e.Tol(a.flexHeightClass),e.xp6(15),e.Q6J("ngForOf",a.sharedvar.pollGrpExecuted.pollList),e.xp6(1),e.Tol(a.getLeftButtonPos()),e.Q6J("matMenuTriggerFor",_)}},dependencies:[c.mk,c.sg,M.lW,T.Hw,C.gM,b.VK,b.OP,b.p6]})}return n})();var Z=l(7355);function q(n,B){1&n&&e._UZ(0,"app-poll-list")}function j(n,B){if(1&n){const t=e.EpF();e.TgZ(0,"div",5)(1,"div",6)(2,"app-poll-list",7),e.NdJ("onSelected",function(a){e.CHM(t);const _=e.oxw();return e.KtG(_.onSelected(a))})("onUpdatedAll",function(a){e.CHM(t);const _=e.oxw();return e.KtG(_.onUpdatedAll(a))}),e.qZA()(),e.TgZ(3,"div",8),e._UZ(4,"app-poll-detail"),e.qZA()()}}const z=[{path:"",component:(()=>{class n{constructor(t,o,a,_,d){this.sharedvar=t,this.dtb=o,this.dg=a,this.snkBar=_,this.pollServ=d,this.screenSplit=!0,this.formData={controls:[{name:"title",label:"Nombre del Formulario:",type:"text",style:"w-full",validators:{required:!0}},{name:"description",label:"Descripci\xf3n:",type:"textarea",style:"w-full h-36",totalRows:5,validators:{}},{name:"allowStart",label:"Iniciar",type:"checkbox",validators:{}},{name:"allowEnd",label:"Finalizar",type:"checkbox",validators:{}}]}}ngOnInit(){this.sharedvar.pollSelected=this.sharedvar.pollGrpExecuted.pollList.length>0?this.sharedvar.pollGrpExecuted.pollList[0]:null}onSelected(t){this.sharedvar.pollSelected=t}onUpdatedAll(t){this.sharedvar.pollSelected=t[0]}onAddEditPoll(t=-1){var o=this;return(0,m.Z)(function*(){let a=o.pollServ.newPoll();t>=0&&(a=o.sharedvar.pollGrpExecuted.pollList[t]);const _={title:"Formulario",schema:o.formData,dgwidth:300,dgheigth:450,value:a},d=yield o.dg.aDefault(_);if(d){if(!d._valid_)return void o.snkBar.open("Debe ingresar la informaci\xf3n solicitada.","Ok",{duration:5e3});o.dg.updatePropResult(a,d),t<0?o.sharedvar.pollGrpExecuted.pollList.push(a):o.sharedvar.pollGrpExecuted.pollList[t]=a}})()}onHeaderClick(t){101==t.index&&this.sharedvar.pollSelected&&this.dtb.saveLocalBKpollList(this.sharedvar.pollGrpExecuted.id,this.sharedvar.pollGrpExecuted.pollList)}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(O.D),e.Y36(r.k),e.Y36(u.x),e.Y36(h.ux),e.Y36(g.n))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["app-poll-list-edit"]],decls:5,vars:4,consts:[[1,"flex","flex-col","max-h-screen"],[3,"buttons","nav_menu","onClicked"],[1,"flex-1","m-2","overflow-scroll"],[4,"ngIf"],["class","flex max-h-screen",4,"ngIf"],[1,"flex","max-h-screen"],[1,"overflow-y-visible","h-screen","w-96","bg-slate-200"],[3,"onSelected","onUpdatedAll"],[1,"overflow-y-visible","h-screen","w-3/5","p-2"]],template:function(o,a){1&o&&(e.TgZ(0,"div",0)(1,"app-header",1),e.NdJ("onClicked",function(d){return a.onHeaderClick(d)}),e.qZA(),e.TgZ(2,"div",2),e.YNc(3,q,1,0,"app-poll-list",3),e.YNc(4,j,5,0,"div",4),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("buttons","110101")("nav_menu",!0),e.xp6(2),e.Q6J("ngIf",!a.screenSplit),e.xp6(1),e.Q6J("ngIf",a.screenSplit))},dependencies:[c.O5,f.G,K,Z.p]})}return n})()}];let Y=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#o=this.\u0275inj=e.cJS({imports:[p.Bz.forChild(z),p.Bz]})}return n})();var U=l(5425),S=l(7774);const H=[{path:"",component:K}];let Q=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#o=this.\u0275inj=e.cJS({imports:[p.Bz.forChild(H),p.Bz]})}return n})();var $=l(7826);let V=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#o=this.\u0275inj=e.cJS({imports:[c.ez,Q,U.O,M.ot,T.Ps,$.p9,C.AV,b.Tx]})}return n})();const X=[{path:"",component:Z.p}];let ee=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#o=this.\u0275inj=e.cJS({imports:[p.Bz.forChild(X),p.Bz]})}return n})(),te=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#o=this.\u0275inj=e.cJS({imports:[c.ez,ee,h.ZX,S.N,U.O,b.Tx,T.Ps,C.AV]})}return n})(),oe=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#o=this.\u0275inj=e.cJS({imports:[c.ez,Y,U.O,S.N,V,te]})}return n})()},8466:(s,i,l)=>{l.d(i,{n:()=>m});var c=l(6339),p=l(6789);let m=(()=>{class e{constructor(r){this.sharedvar=r,this.groupRefTrue=[]}parsePollList(r,u){for(let h=0;h<u.length;h++){const g=u[h];r.pollList.push(this.newPoll(g.name));const f=r.pollList[r.pollList.length-1].schema;for(let D=1;D<g.data.length;D++)f.controls.push(this.data2control(g.data[D]))}return u}data2control(r){const u=this.sharedvar.getUniqueName("",r.A,this.sharedvar.pollGrpExecuted.pollList),h=this.getTypeFromData(r.B),g=this.getEvidenceFromData(r.E),f={dtbase:r.F,type:h,evidence:g,help:r.H},D={required:r.D};let P=[];h.includes("select")&&r.C.split(";").forEach(T=>{const C=T.split(":");P.push({key:C[0],value:C[1]})});const v={name:u,label:r.A,type:h,style:this.getStyleFromData(r.G),tags:f,selectOptions:P,validators:D};return this.getSideBtn(v),v}getTypeFromData(r){switch(r){case"Agenda":return"appoint";case"Area de Texto":return"textarea";case"Texto":return"text";case"Contrase\xf1a":return"password";case"CRM Clientes":return"costumer";case"CRM Clientes (Editable)":return"costumer_edit";case"CRM Productos":return"product";case"Dibujo":return"draw";case"Duplicar Grupo":return"duplicate";case"Fecha":return"date";case"Fecha-Hora":return"datetime-local";case"Foto":return"picture";case"Geolocalizaci\xf3n":return"geolocation";case"Ir a...":return"goto";case"N\xfamero":return"number";case"Selecci\xf3n":return"select";case"Selecci\xf3n Multiple":return"multiselect";case"Caja de verificaci\xf3n":return"checkbox";case"T\xedtulo":return"header";default:return""}}getStyleFromData(r){return r&&0!==r.length?r.split(",").map(u=>u.trim()):["w-full"]}getEvidenceFromData(r){let u=[];if(0===r.length)return u;const h=r.split(",");return h.includes("Sin evidencia")||h.forEach(g=>{switch(g.trim()){case"Nota":u.push("note");break;case"Foto":u.push("picture");break;case"Firma":u.push("draw");break;case"Adjunto":u.push("attach")}}),u}getSideBtn(r){switch(r.type){case"appoint":r.type="text",r.sideBtn="pending_actions",r.disabled=!0;break;case"costumer":case"costumer_edit":r.type="text",r.sideBtn="people",r.disabled=!0;break;case"geolocation":r.type="text",r.sideBtn="terrain",r.disabled=!0;break;case"header":r.default=r.label,r.disabled=!0;break;case"goto":r.type="select",r.sideBtn="east";break;case"draw":r.type="text",r.sideBtn="edit",r.disabled=!0;break;case"picture":r.type="text",r.sideBtn="photo_camera",r.disabled=!0;break;case"product":r.type="text",r.sideBtn="shopping_cart",r.disabled=!0;break;case"duplicate":r.type="select",r.sideBtn="add",r.sideBtn2="navigate_next",r.tags.dupactivity=r.dupactivity||"";break;case"textarea":case"text":r.sideBtn="mic_none"}return r}getUniqueTitle(r,u){let h=0,g="";const f=u.split(" ");let D=Number(f[f.length-1]);""!=f[f.length-1]&&!isNaN(D)&&(f.splice(f.length-1,1),u=f.join(" "));for(let P=0;P<this.sharedvar.pollGrpExecuted.pollList.length;P++){const v=this.sharedvar.pollGrpExecuted.pollList[P].schema.controls||[];for(let M=0;M<v.length;M++)if(v[M].label.toUpperCase().includes(`${u}${g}`.toUpperCase())&&v[M].name!==r){g="_"+h++,P=-1;break}}return`${u}${g}`}getGroupRef(){return this.groupRefTrue=[],this.getRefNodeTrue(this.sharedvar.pollGroupIndex),this.groupRefTrue}getRefNodeTrue(r){if(r.children)for(let u=0;u<r.children.length;u++){const h=r.children[u];if(h.ref)this.groupRefTrue.push({key:h.id,value:h.model_name||h.name});else if(h.children&&h.children.length>0)return this.getRefNodeTrue(h)}}newPoll(r="Actividad"){return{id:this.sharedvar.getSerialKey(3,4,"_"),title:r,allowStart:!1,allowEnd:!1,duplicated:!1,totalDup:0,dupTotal:0,schema:{controls:[]},values:{_valid_:!0}}}static#e=this.\u0275fac=function(u){return new(u||e)(c.LFG(p.D))};static#t=this.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})()}}]);