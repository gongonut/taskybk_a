"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[811],{9811:(H,x,r)=>{r.r(x),r.d(x,{StaffListModule:()=>G});var p=r(4070),g=r(781),f=r(3241),C=r(1348),k=r.t(C,2),t=r(6339),A=r(6789),y=r(3016),S=r(3792),T=r(7254),Z=r(1791),b=r(2615),m=r(4156),h=r(8137),v=r(4179),U=r(9869);const w=["editControlTrigger"],L=["excelUpload"];function E(a,_){if(1&a&&(t.TgZ(0,"div",38)(1,"div")(2,"strong"),t._uU(3,"Cliente:"),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div")(6,"strong"),t._uU(7,"Contacto:"),t.qZA(),t._uU(8),t.qZA(),t.TgZ(9,"div")(10,"strong"),t._uU(11,"Correo:"),t.qZA(),t._uU(12),t.qZA(),t.TgZ(13,"div")(14,"strong"),t._uU(15,"Tel\xe9fono:"),t.qZA(),t._uU(16),t.qZA(),t.TgZ(17,"div")(18,"strong"),t._uU(19,"Compromiso:"),t.qZA(),t._uU(20),t.qZA()()),2&a){const e=t.oxw().$implicit;t.xp6(4),t.hij(" ",e.crm_costum_name,""),t.xp6(4),t.hij(" ",e.contact,""),t.xp6(4),t.hij(" ",e.email,""),t.xp6(4),t.hij(" ",e.phone,""),t.xp6(4),t.hij(" ",e.notes,"")}}function M(a,_){if(1&a){const e=t.EpF();t.TgZ(0,"div")(1,"div",32)(2,"div",33),t.NdJ("click",function(){const n=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.onHtml2Pdf(n))}),t._uU(3),t.ALo(4,"date"),t.qZA(),t.TgZ(5,"div",34)(6,"mat-icon",35),t.NdJ("click",function(){const n=t.CHM(e).index,s=t.oxw(2).$implicit,l=t.oxw();return t.KtG(l.onDelAppoint(s,n))}),t._uU(7,"delete_otuline"),t.qZA(),t.TgZ(8,"mat-icon",35),t.NdJ("click",function(){const n=t.CHM(e).index,s=t.oxw(2).$implicit,l=t.oxw();return t.KtG(l.onAddEditAppoint(s,n))}),t._uU(9,"edit"),t.qZA(),t.TgZ(10,"mat-icon",36),t.NdJ("click",function(){const n=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.onchangefull(n))}),t._uU(11),t.qZA()()(),t.YNc(12,E,21,5,"div",37),t.qZA()}if(2&a){const e=_.$implicit,i=t.oxw(3);t.xp6(3),t.lnq(" ",t.xi3(4,5,e.datetime,"MMM dd, yyy hh:mm a")," - ",e.pollgrp_model_name," - Estado: ",i.getAppointState(e)," "),t.xp6(8),t.Oqu(i.getAppIcon(e)),t.xp6(1),t.Q6J("ngIf",e.full)}}function F(a,_){if(1&a){const e=t.EpF();t.TgZ(0,"div",26)(1,"div",27)(2,"div",28),t._uU(3," AGENDA "),t.qZA(),t.TgZ(4,"mat-icon",29),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,n=t.oxw();return t.KtG(n.onFilter(o))}),t._uU(5,"tune"),t.qZA(),t.TgZ(6,"mat-icon",30),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,n=t.oxw();return t.KtG(n.onAddEditAppoint(o,-1))}),t._uU(7,"add"),t.qZA()(),t.YNc(8,M,13,8,"div",31),t.qZA()}if(2&a){const e=t.oxw().$implicit;t.xp6(8),t.Q6J("ngForOf",e.appoint)}}const $=function(a){return{"background-color":a}};function J(a,_){if(1&a){const e=t.EpF();t.TgZ(0,"div",10),t._UZ(1,"img",11),t.TgZ(2,"div",12)(3,"div",13),t._uU(4),t.qZA(),t.TgZ(5,"div",14)(6,"div",15)(7,"strong"),t._uU(8,"M\xf3vil:"),t.qZA(),t._uU(9),t.qZA(),t.TgZ(10,"div",16)(11,"strong"),t._uU(12,"Email:"),t.qZA(),t._uU(13),t.qZA(),t.TgZ(14,"div",15)(15,"strong"),t._uU(16,"Calificaci\xf3n:"),t.qZA(),t._uU(17),t.qZA()(),t.TgZ(18,"div",17)(19,"div",18)(20,"span")(21,"mat-icon",19),t.NdJ("click",function(){const n=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.getStaffClicked(n,4))}),t._uU(22,"room"),t.qZA(),t.TgZ(23,"mat-icon",20),t.NdJ("click",function(){const n=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.getStaffClicked(n,5))}),t._uU(24,"forum"),t.qZA(),t.TgZ(25,"mat-icon",21),t.NdJ("click",function(){const n=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.getStaffClicked(n,0))}),t._uU(26,"lock_open"),t.qZA(),t.TgZ(27,"mat-icon",22),t.NdJ("click",function(){const n=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.getStaffClicked(n,1))}),t._uU(28,"edit"),t.qZA(),t.TgZ(29,"mat-icon",23),t.NdJ("click",function(){const n=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.getStaffClicked(n,3))}),t._uU(30,"pending_actions"),t.qZA(),t.TgZ(31,"mat-icon",23),t.NdJ("click",function(){const n=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.getStaffClicked(n,3))}),t._uU(32,"expand_more"),t.qZA(),t._uU(33," \xa0 "),t.TgZ(34,"mat-icon",24),t.NdJ("click",function(){const n=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.getStaffClicked(n,2))}),t._uU(35,"delete"),t.qZA()()()(),t.YNc(36,F,9,1,"div",25),t.qZA()()}if(2&a){const e=_.$implicit,i=t.oxw();t.Q6J("ngStyle",t.VKq(8,$,i.getBackColor(e))),t.xp6(1),t.Q6J("src",i.getPicture(e),t.LSH),t.xp6(3),t.AsE("",e.names," ",e.lastnames||""," "),t.xp6(5),t.hij(" ",e.phone," "),t.xp6(4),t.hij(" ",e.email," "),t.xp6(4),t.hij(" ",e.stars," "),t.xp6(19),t.Q6J("ngIf",i.appointVisible(e._id))}}const N=[{path:"",component:(()=>{class a{constructor(e,i,o,n,s,l,d){this.sharedvar=e,this.dtb=i,this.dg=o,this.snkBar=n,this.route=s,this.staffServ=l,this.notif=d,this.addApp=!1,this.reset=0,this.appointIdExpandState="",this.arol="K",this.loading=!1,this.staffList=[]}ngOnInit(){var e=this;return(0,f.Z)(function*(){e.sub=e.route.params.subscribe(function(){var i=(0,f.Z)(function*(o){e.filter={queryType:3,active:!0,stars:0,rol:e.arol},e.staffList=yield e.dtb.getStaffByFilterAsync(e.filter),e.staffServ.startAppointData(e.staffList),e.reset++,e.arol=o.rol});return function(o){return i.apply(this,arguments)}}()),e.notifSubs()})()}notifSubs(){var i,e=this;this.notifSub=this.notif.getNotif_obs().subscribe({next:(i=(0,f.Z)(function*(o){switch(o.mycollection){case"staff":break;case"ansgeoloc":if(!o.data)return;const n=e.staffList.find(u=>u._id===o.usert_id),l=[e.staffServ.staff2analitic(0,n,e.staffServ.appointBasic(n,"appoint"))];if(!l)return;l[0].geoLocStart=o.data.geoloc;const d={title:"Geo localizaci\xf3n",dgheigth:600,value:l};yield e.dg.aMap(d)}}),function(n){return i.apply(this,arguments)})})}ngOnDestroy(){this.sub&&this.sub.unsubscribe(),this.notifSub&&this.notifSub.unsubscribe()}getBackColor(e){return e.active?"white":"#ffffcc"}getPicture(e){return e.picture&&e.picture.length>0?e.picture:"../assets/images/favicon.png"}getClicked(e){var i=this;return(0,f.Z)(function*(){switch(e.index){case 1:"P"===i.arol&&i.filterDialog();break;case 2:i.onStaff();break;case 3:let o=document.getElementById("spanTrigger");o&&(o.style.display="",o.style.position="absolute",o.style.left=e.pageX+5+"px",o.style.top=e.pageY+5+"px",i.editControlTrigger.openMenu());break;case 4:i.staffList=yield i.dtb.getStaffByFilterAsync(i.filter)}})()}getStaffClicked(e,i){var o=this;switch(i){case 0:this.snkBar.open(`Reiniciar contrase\xf1a: ${e.names} ${e.lastnames||""}?.`,"Ok",{duration:5e3}).onAction().subscribe(s=>{e.password="",this.dtb.updateStaffAsync(e)});break;case 1:this.onStaff(e);break;case 2:if(this.sharedvar.staff._id===e._id)return void this.snkBar.open(`No es posible eliminar al propietario de \xe9sta sesi\xf3n: ${e.names} ${e.lastnames||""}?.`,"Ok",{duration:5e3});this.snkBar.open(`Eliminar tasker: ${e.names} ${e.lastnames||""}?.`,"Ok",{duration:5e3}).onAction().subscribe(function(){var s=(0,f.Z)(function*(l){if(e.active=!1,yield o.dtb.deleteStaffAsync(e._id)){const c=o.staffList.findIndex(u=>u._id===e._id);c>0&&o.staffList.splice(c,1)}});return function(l){return s.apply(this,arguments)}}());break;case 3:this.appointIdExpandState=this.appointIdExpandState=this.appointIdExpandState===e._id?"":e._id||"";break;case 4:this.notif.sendCommand({cmd:"geoloc",user_id:this.sharedvar.staff._id,usert_id:e._id,data:{appoint_id:"0"}});break;case 5:this.staffServ.onMessage2(e.names,e._id)}}appointVisible(e){return e===this.appointIdExpandState}onStaff(e=null){var i=this;return(0,f.Z)(function*(){const o=JSON.parse(JSON.stringify(k));if("K"===i.arol){const d=o.controls.findIndex(c=>"rol"===c.name);d>=0&&o.controls.splice(d,1)}let n=!1;e||(e={},n=!0);let s={schema:o,value:e,title:"Datos del Administrador/Tasker",showImage:!0,image:e.picture,imgwidth:200,imgheight:200,newUsr:n};const l=yield i.dg.aDefault(s);if(l&&e){i.dg.updatePropResult(e,l),e.rol||(e.rol=[]),"K"===i.arol&&!e.rol.includes(i.arol)&&e.rol.push("K"),e.rol.includes("A")||e.rol.push("A"),s.image&&(e.picture=s.image),i.dtb.setStaff(e).subscribe({next:c=>{e=c;const u=i.staffList.findIndex(I=>I._id===c._id);u>=0?i.staffList[u]=c:i.staffList.push(c)}});let d=`${i.sharedvar.TASKY_SERVER}tasker/?staff=${e.email}`;i.sharedvar.DEV_STATUS&&(d=`${i.sharedvar.TASKY_LOCAL}?staff=${e.email}`),navigator.clipboard.writeText(d).then(c=>{}).catch(c=>alert(c)),i.snkBar.open("V\xednculo al cliente copiado al portapapeles.","Ok",{duration:3e3})}})()}onExcel2Dtb(e){this.excelUpload&&this.excelUpload.nativeElement.click()}onExcelFileSelected(e){const i=e.target.files[0];this.loading=!this.loading,this.dtb.upload2Excel("staff",i).subscribe({next:o=>{this.loading=!1,this.snkBar.open("Base de tasker/usuarios actualizada","Ok",{duration:1e4}).onAction().subscribe(n=>{location.reload()})}})}onchangefull(e){e.full=!e.full}onHtml2Pdf(e){var i=this;return(0,f.Z)(function*(){if(void 0===e.pollresult_id)return;const o=yield i.dtb.getPollResultAsync(e.pollresult_id);if(!o)return;let n={schema:{},value:o,title:"Datos de la encuesta: "+o.staff_name};yield i.dg.aPollResult(n)})()}getAppointState(e){let i="Pendiente.";!0===e.ended&&(i="Finalizado.");const o=(new Date).getTime();e.dateend<o&&(i="No efectuado.");let n="";switch(e.sche_schedule){case"d":n=" Di\xe1rio.";break;case"s":n=" Semanal.";break;case"m":n=" Mensual.";break;case"o":n=` Cada ${e.sche_other} d\xedas.`}return i+n}getAppIcon(e){return e.full?"expand_less":"expand_more"}onDelAppoint(e,i){this.staffServ.onDelAppoint(e,i)}onAddEditAppoint(e,i){this.staffServ.onAddEditAppoint(e,i)}onFilter(e){}filterDialog(){var e=this;return(0,f.Z)(function*(){const n=yield e.dg.aDefault({schema:{controls:[{name:"active",label:"Estado:",type:"select",validators:{},selectOptions:[{key:"1",value:"Activo"},{key:"0",value:"Inactivo"}]},{name:"rol",label:"Rol:",type:"select",validators:{},selectOptions:[{key:"F",value:"Administrador"},{key:"K",value:"Tasker"}]},{name:"email",label:"Correo electr\xf3nico:",type:"text",style:"w-full",validators:{}}]},title:"Filtros",dgwidth:300,dgheigth:400});n&&(e.filter={queryType:3,rol:n.rol,email:n.email},n.active&&(e.filter.active="1"===n.active),e.staffList=yield e.dtb.getStaffByFilterAsync(e.filter))})()}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(A.D),t.Y36(y.k),t.Y36(S.x),t.Y36(T.ux),t.Y36(g.gz),t.Y36(Z.x),t.Y36(b.$))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-staff-list"]],viewQuery:function(i,o){if(1&i&&(t.Gf(w,5),t.Gf(L,5)),2&i){let n;t.iGM(n=t.CRH())&&(o.editControlTrigger=n.first),t.iGM(n=t.CRH())&&(o.excelUpload=n.first)}},decls:15,vars:4,consts:[[1,"flex","flex-col","max-h-screen"],[3,"buttons","nav_menu","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"flex-1","flex","flex-col","gap-2","m-2","bg-gray-100","overflow-y-scroll"],["class","w-full p-1 flex flex-row border border-gray-300 rounded shadow-sm",3,"ngStyle",4,"ngFor","ngForOf"],["controlEdit","matMenu"],["mat-menu-item","",3,"click"],["type","file","accept",".xlsx",1,"invisible",3,"change"],["excelUpload",""],[1,"w-full","p-1","flex","flex-row","border","border-gray-300","rounded","shadow-sm",3,"ngStyle"],["alt","aja",1,"h-16","w-16","rounded-full","object-fill",3,"src"],[1,"flex-1","flex","flex-col","items-start","px-2"],[1,"h-6","w-48","overflow-hidden","font-medium","leading-tight"],[1,"flex","flex-row","h-6","mt-1"],[1,"pl-2","h-5","w-48","text-xs","overflow-hidden"],[1,"pl-2","h-5","w-60","text-xs","overflow-hidden"],[1,"w-full","h-8","px-1","border-t","border-gray-300","flex","flex-row","gap-x-4","justify-end","text-gray-300"],[1,"pt-1"],["matTooltip","Ubicaci\xf3n actual",1,"hover:text-violet-500",3,"click"],["matTooltip","Enviar mensaje",1,"hover:text-violet-500",3,"click"],["matTooltip","Reiniciar contrase\xf1a",1,"hover:text-violet-500",3,"click"],["matTooltip","Editar informaci\xf3n del usuario",1,"hover:text-violet-500",3,"click"],["matTooltip","Ver/Ocultar agenda",1,"hover:text-violet-500",3,"click"],["matTooltip","Eliminar usuario",1,"hover:text-red-500",3,"click"],["class","w-full mt-2 bg-gray-50 border-b border-gray-300",4,"ngIf"],[1,"w-full","mt-2","bg-gray-50","border-b","border-gray-300"],[1,"h-6","flex","flex-row","items-end","justify-end","bg-gray-200","text-sm"],[1,"flex-1","ml-1","pt-1","text-sky-700"],["matTooltip","Filtrar agenda",1,"mat-18",3,"click"],["matTooltip","Agregar agenda",1,"text-gray-400","hover:text-sky-700",3,"click"],[4,"ngFor","ngForOf"],[1,"pl-2","flex","flex-row","text-xs","text-sky-700","items-center"],[1,"flex-1","h-6",3,"click"],[1,"text-gray-300"],[1,"text-sm","hover:text-sky-700",3,"click"],[1,"hover:text-sky-700",3,"click"],["class","ml-4 mb-2 p-1 bg-slate-100 text-xs text-gray-600",4,"ngIf"],[1,"ml-4","mb-2","p-1","bg-slate-100","text-xs","text-gray-600"]],template:function(i,o){if(1&i&&(t.TgZ(0,"div",0)(1,"app-header",1),t.NdJ("onClicked",function(s){return o.getClicked(s)}),t.qZA(),t._UZ(2,"span",2,3),t.TgZ(4,"div",4),t.YNc(5,J,37,10,"div",5),t.qZA()(),t.TgZ(6,"mat-menu",null,6)(8,"button",7),t.NdJ("click",function(s){return o.onExcel2Dtb(s)}),t.TgZ(9,"mat-icon"),t._uU(10,"build"),t.qZA(),t._uU(11," Importar de Excel "),t.qZA(),t._UZ(12,"hr"),t.qZA(),t.TgZ(13,"input",8,9),t.NdJ("change",function(s){return o.onExcelFileSelected(s)}),t.qZA()),2&i){const n=t.MAs(7);t.xp6(1),t.Q6J("buttons","111110")("nav_menu",!1),t.xp6(1),t.Q6J("matMenuTriggerFor",n),t.xp6(3),t.Q6J("ngForOf",o.staffList)}},dependencies:[p.sg,p.O5,p.PC,m.VK,m.OP,m.p6,h.Hw,v.gM,U.G,p.uU]})}return a})()}];let q=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275mod=t.oAB({type:a});static#i=this.\u0275inj=t.cJS({imports:[g.Bz.forChild(N),g.Bz]})}return a})();var K=r(5425),O=r(7774);let G=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275mod=t.oAB({type:a});static#i=this.\u0275inj=t.cJS({imports:[p.ez,q,m.Tx,h.Ps,v.AV,K.O,O.N]})}return a})()}}]);