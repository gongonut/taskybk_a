"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[770],{5770:(O,m,l)=>{l.r(m),l.d(m,{PlayPollModule:()=>N});var r=l(7087),h=l(3759),g=l(3241),_=l(1348),C=l.t(_,2),t=l(2283),b=l(4758),T=l(8046),k=l(6655),I=l(8878),v=l(1359),Z=l(2249),x=l(3578),u=l(9347),p=l(8464);function P(o,f){if(1&o){const i=t.EpF();t.TgZ(0,"div",8),t.NdJ("click",function(){t.CHM(i);const a=t.oxw();return t.KtG(a.onClick(2))}),t.TgZ(1,"span")(2,"mat-icon"),t._uU(3,"lock_open"),t.qZA()()()}}function L(o,f){if(1&o){const i=t.EpF();t.TgZ(0,"div",8),t.NdJ("click",function(){t.CHM(i);const a=t.oxw();return t.KtG(a.onClick(3))}),t.TgZ(1,"span")(2,"mat-icon"),t._uU(3,"forum"),t.qZA()()()}}const w=function(o){return{"background-color":o}};let y=(()=>{class o{constructor(){this.onClicked=new t.vpe}getLastChat(){return this.chatItem.chats&&this.chatItem.chats.length>0&&this.chatItem.chats[this.chatItem.chats.length-1].msg||"Esperando..."}getBackColor(){return this.chatItem.ended?"#C6DEFF":this.chatItem.chats&&this.chatItem.chats.length>0&&"W"===this.chatItem.chats[this.chatItem.chats.length-1].type?"white":"#ffffcc"}getPicture(){return this.chatItem.staff_picture&&this.chatItem.staff_picture.length>0?this.chatItem.staff_picture:"https://hips.hearstapps.com/hmg-prod/images/how-to-shave-your-face-at-home-1648149510.png?crop=0.505xw:1.00xh;0.228xw,0.00408xh&resize=1200:*"}onClick(i){this.onClicked.emit({chatItem:this.chatItem,cmd:i})}static#t=this.\u0275fac=function(e){return new(e||o)};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-chat"]],inputs:{chatItem:"chatItem"},outputs:{onClicked:"onClicked"},decls:21,vars:8,consts:[[1,"h-24","w-64","flex","flex-col","rounded","border","border-gray-200","p-1","shadow-sm",3,"ngStyle"],[1,"flex","flex-row"],["alt","chatItem.staff_name",1,"h-12","w-12","rounded-full","object-fill",3,"src"],[1,"flex","flex-col","items-start","px-2"],[1,"h-6","w-48","overflow-hidden","font-medium","leading-tight"],[1,"h-5","w-48","overflow-hidden","text-justify","font-thin"],[1,"h-3"],[1,"w-48","h-6","px-1","border-t","border-violet-300","flex","flex-row","gap-x-2","justify-end","text-gray-200"],[1,"pt-1","hover:border-violet-500","hover:text-violet-500",3,"click"],["class","pt-1 hover:border-violet-500 hover:text-violet-500",3,"click",4,"ngIf"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"img",2),t.TgZ(3,"div",3)(4,"div",4),t._uU(5),t.qZA(),t.TgZ(6,"div",5),t._uU(7),t.qZA(),t._UZ(8,"div",6),t.TgZ(9,"div",7)(10,"div",8),t.NdJ("click",function(){return a.onClick(0)}),t.TgZ(11,"span")(12,"mat-icon"),t._uU(13,"delete"),t.qZA()()(),t._uU(14," \xa0 "),t.TgZ(15,"div",8),t.NdJ("click",function(){return a.onClick(1)}),t.TgZ(16,"span")(17,"mat-icon"),t._uU(18,"perm_identity"),t.qZA()()(),t.YNc(19,P,4,0,"div",9),t.YNc(20,L,4,0,"div",9),t.qZA()()()()),2&e&&(t.Q6J("ngStyle",t.VKq(6,w,a.getBackColor())),t.xp6(2),t.Q6J("src",a.getPicture(),t.LSH),t.xp6(3),t.Oqu(a.chatItem.staff_name),t.xp6(2),t.Oqu(a.getLastChat()),t.xp6(12),t.Q6J("ngIf",a.chatItem.ended),t.xp6(1),t.Q6J("ngIf",!a.chatItem.ended))},dependencies:[r.O5,r.PC,p.Hw]})}return o})();const A=["editControlTrigger"];function E(o,f){if(1&o){const i=t.EpF();t.TgZ(0,"div")(1,"app-chat",7),t.NdJ("onClicked",function(a){t.CHM(i);const s=t.oxw();return t.KtG(s.onChatItemClicked(a))}),t.qZA()()}if(2&o){const i=f.$implicit;t.xp6(1),t.Q6J("chatItem",i)}}const S=[{path:"",component:(()=>{class o{constructor(i,e,a,s,n,d){this.sharedvar=i,this.nvg=e,this.dtb=a,this.dg=s,this.snkBar=n,this.notif=d,this.selResultId="",this.headerList=[],this.filterTasker={filter:1,status:2,pollGrp_id:"",date_ini:0,date_end:0},this.ctrlList=this.sharedvar.pollSelected&&this.sharedvar.pollSelected.schema?this.sharedvar.pollSelected.schema:{controls:[]}}ngOnInit(){this.nvg.playing=!0,this.headerList.push({name:"staff_name",label:"Tasker",type:"text",pos:"tasker"}),this.headerList.push({name:"staffId",label:"Identificaci\xf3n",type:"text",pos:"tasker"}),this.headerList.push({name:"",label:"Plataforma",type:"text",pos:"tasker"}),this.headerList.push({name:"",label:"Calificaci\xf3n",type:"number",pos:"tasker"}),this.sharedvar.pollActivity.pollList.forEach(e=>{e.schema.controls?.forEach(a=>{a.tags&&a.tags.dtbase&&this.headerList.push({name:a.name,label:a.label,type:a.tags.type,pos:"data"})})}),this.headerList.push({name:"date_ini",label:"Hora de inicio",type:"datetime-local",pos:"Info. Encuesta"}),this.headerList.push({name:"geoLocStart",label:"Geo ubicaci\xf3n inicio",type:"geolocation",pos:"Info. Encuesta"}),this.headerList.push({name:"date_end",label:"Hora final",type:"datetime-local",pos:"Info. Encuesta"}),this.headerList.push({name:"geoLocEnd",label:"Geo ubicaci\xf3n final",type:"geolocation",pos:"Info. Encuesta"}),this.filterTasker.pollGrp_id=this.sharedvar.pollActivity._id||"";const i=this.dtb.getPollResultByFilter(this.filterTasker).subscribe({next:e=>{this.pollResultList=[],this.pollResultList=e},complete:()=>{i&&i.unsubscribe()}});this.chatSub=this.notif.dtb_notification().subscribe({next:e=>{if("chat"===e.collection&&e.field_id){const a=this.pollResultList.findIndex(s=>s._id===e.field_id);a>=0&&this.setPollResultState(a,e)}if("pollresult"===e.collection){const a=this.pollResultList.findIndex(s=>s._id===e.field_id);a>=0&&this.filterTasker.status!==e.data.status?this.pollResultList.splice(a,1):e.data&&this.sharedvar.pollActivity._id===e.data.pollGrp_id&&this.setPollResultState(a,e)}},complete(){}})}setPollResultState(i,e){var a=this;return(0,g.Z)(function*(){const s=yield a.dtb.getPollResultAsync(e.field_id),n=s.chats.length-1;s.status_date=Date.now(),a.pollResultList[i]=s,n>=0&&"T"===s.chats[n].type&&a.snkBar.open(`Mensaje de ${e.staff__id}.`,"Ok",{duration:3e3})})()}getClicked(i){if(3===i.index){let e=document.getElementById("spanTrigger");e&&(e.style.display="",e.style.position="absolute",e.style.left=i.pageX+5+"px",e.style.top=i.pageY+5+"px",this.editControlTrigger.openMenu())}}onSend2Mobil(){navigator.clipboard.writeText(`https://epoll-cli.firebaseapp.com/?pollexec=${this.sharedvar.pollActivity.id}`).then(e=>{}).catch(e=>alert(e)),this.snkBar.open("V\xednculo copiado al portapapeles.","Ok",{duration:3e3})}onChatItemClicked(i){var e=this;return(0,g.Z)(function*(){switch(i.cmd){case 1:const a=yield e.dtb.getStaffById(i.chatItem.staff__id);e.dg.aDefault({schema:C,value:a,title:"Datos del Tasker"}).subscribe(c=>{c&&(e.dg.updatePropResult(a,c),e.dtb.setStaff(a))});break;case 2:const n=yield e.dtb.getStaffById(i.chatItem.staff__id);e.dg.aPollResult({schema:{},value:i.chatItem,title:"Datos de la encuesta: "+n.names}).subscribe(c=>{});break;case 3:e.selResultId=i.chatItem.id,e.dg.aChat({title:"Chat",dgwidth:400,value:i.chatItem||[]}).subscribe(c=>{c&&c.value.length>0&&(i.staff.chats=c.value,e.dtb.updatePollResultAsync(i.staff)),e.selResultId=""})}})()}csvStream(){let i="",e="";return this.headerList.forEach(a=>{e===a.pos?i+="\t":(e=a.pos,i+=`${a.pos}\t`)}),i+="\n",this.headerList.forEach(a=>i+=`${a.label}\t`),i+="\n",this.pollResultList.forEach(a=>{i+="\n",this.headerList.forEach(s=>{"tasker"===s.pos&&(i+=a[s.name]?a[s.name]:"",i+="\t")}),this.headerList.forEach(s=>{"data"===s.pos&&(i+=a.values&&a.values[s.name]?a.values[s.name]:"",i+="\t")}),this.headerList.forEach(s=>{if("Info. Encuesta"===s.pos){if(a[s.name])if("datetime-local"===s.type){let n=Number(a[s.name]),d=new Date(n).toLocaleString();i+=d}else i+=a[s.name];else i+="";i+="\t"}}),i+="\n"}),i}jsonStream(){let i=[];const e=this.headerList.reduce((a,s)=>({...a,[s.name]:s.label}),{});return i.push(e),this.pollResultList.forEach(a=>{if(a.values){const s=[a.values];i=[...i,...s]}}),i}downloadFile(){const i=JSON.stringify(this.jsonStream());var e=this.encode(i),a=new Blob([e],{type:"application/octet-stream"}),s=URL.createObjectURL(a);window.open(s)}encode(i){for(var e=[],a=0;a<i.length;a++)e[a]=i.charCodeAt(a);return new Uint16Array(e)}downloadTable2Excel(){const i=new Blob([this.csvStream()],{type:"text/csv;charset=utf-8"});var e=URL.createObjectURL(i);window.open(e)}static#t=this.\u0275fac=function(e){return new(e||o)(t.Y36(b.D),t.Y36(T.$),t.Y36(k.k),t.Y36(I.x),t.Y36(v.ux),t.Y36(Z.$))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-play-poll"]],viewQuery:function(e,a){if(1&e&&t.Gf(A,5),2&e){let s;t.iGM(s=t.CRH())&&(a.editControlTrigger=s.first)}},decls:24,vars:4,consts:[[3,"buttons","nav_menu","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"p-1","flex","flex-row","flex-wrap","gap-1"],[4,"ngFor","ngForOf"],["controlEdit","matMenu"],["mat-menu-item","",3,"click"],[3,"chatItem","onClicked"]],template:function(e,a){if(1&e&&(t.TgZ(0,"app-header",0),t.NdJ("onClicked",function(n){return a.getClicked(n)}),t.qZA(),t._UZ(1,"span",1,2),t.TgZ(3,"div",3),t.YNc(4,E,2,1,"div",4),t.qZA(),t.TgZ(5,"mat-menu",null,5)(7,"button",6),t.NdJ("click",function(){return a.onSend2Mobil()}),t.TgZ(8,"mat-icon"),t._uU(9,"build"),t.qZA(),t._uU(10," Ejecutar Modelo en Modo de Prueba "),t.qZA(),t._UZ(11,"hr"),t.TgZ(12,"button",6),t.NdJ("click",function(){return a.downloadFile()}),t.TgZ(13,"mat-icon"),t._uU(14,"file_download"),t.qZA(),t._uU(15," Exportar Informe a Json. "),t.qZA(),t.TgZ(16,"button",6),t.NdJ("click",function(){return a.downloadTable2Excel()}),t.TgZ(17,"mat-icon"),t._uU(18,"file_download"),t.qZA(),t._uU(19," Exportar Informe a xls. "),t.qZA(),t.TgZ(20,"button",6),t.NdJ("click",function(){return a.downloadFile()}),t.TgZ(21,"mat-icon"),t._uU(22,"insights"),t.qZA(),t._uU(23," Enviar Informe a Google Spread Sheet "),t.qZA()()),2&e){const s=t.MAs(6);t.Q6J("buttons","11010")("nav_menu",!0),t.xp6(1),t.Q6J("matMenuTriggerFor",s),t.xp6(3),t.Q6J("ngForOf",a.pollResultList)}},dependencies:[r.sg,x.G,u.VK,u.OP,u.p6,p.Hw,y]})}return o})()}];let R=(()=>{class o{static#t=this.\u0275fac=function(e){return new(e||o)};static#e=this.\u0275mod=t.oAB({type:o});static#a=this.\u0275inj=t.cJS({imports:[h.Bz.forChild(S),h.Bz]})}return o})();var J=l(769),U=l(7572);const F=[{path:"",component:y}];let M=(()=>{class o{static#t=this.\u0275fac=function(e){return new(e||o)};static#e=this.\u0275mod=t.oAB({type:o});static#a=this.\u0275inj=t.cJS({imports:[h.Bz.forChild(F),h.Bz]})}return o})(),B=(()=>{class o{static#t=this.\u0275fac=function(e){return new(e||o)};static#e=this.\u0275mod=t.oAB({type:o});static#a=this.\u0275inj=t.cJS({imports:[r.ez,M,p.Ps]})}return o})(),N=(()=>{class o{static#t=this.\u0275fac=function(e){return new(e||o)};static#e=this.\u0275mod=t.oAB({type:o});static#a=this.\u0275inj=t.cJS({imports:[r.ez,R,J.O,U.N,u.Tx,p.Ps,v.ZX,B]})}return o})()}}]);